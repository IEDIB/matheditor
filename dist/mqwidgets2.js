/*! For license information please see mqwidgets2.js.LICENSE.txt */
!function(){"use strict";var e={161:function(e,t,n){Object.defineProperty(t,"__esModule",{value:!0}),t.I18n=void 0;var r=n(66),a={ca:{check:"Comprova",General:"General","Símbols":"Símbols",Geometria:"Geometria",Intervals:"Intervals",Funcions:"Funcions",right_answer:"Resposta correcta",close:"Tancar",open_editor:"Obrir l'editor",show_answer:"Mostra la solució",choose_option:"Tria una opció",next:"Següent",goal_reached:"Repte aconseguit!",wildcard:"Comodí",answer:"Solució",matheditor:"Editor matemàtic",accept:"Acceptar",cancel:"Cancel·lar"},es:{check:"Comprueba",General:"General","Símbols":"Símbolos",Geometria:"Geometria",Intervals:"Intervalos",Funcions:"Funciones",right_answer:"Respuesta correcta",close:"Cerrar",open_editor:"Abrir el editor",show_answer:"Muestra la solución",choose_option:"Elige una opción",next:"Siguiente",goal_reached:"¡Reto conseguido!",wildcard:"Comodín",answer:"Solución",matheditor:"Editor matemático",accept:"Aceptar",cancel:"Cancelar"},en:{check:"Check",General:"General","Símbols":"Symbols",Geometria:"Geometry",Intervals:"Intervals",Funcions:"Functions",right_answer:"Right answer",close:"Close",open_editor:"Open the editor",show_answer:"Show the answer",choose_option:"Choose an option",next:"Next",goal_reached:"Goal acomplished!",wildcard:"Wildcard",answer:"Answer",matheditor:"Math editor",accept:"Accept",cancel:"Cancel"}};var i=function(){if("undefined"==typeof window)return"en";var e=window.navigator,t=e.languages&&e.languages[0]||e.language||e.browserLanguage||e.userLanguage||e.systemLanguage||"en_US";return(t=t.toLowerCase().replace(/-/,"_")).toLowerCase().split("_")[0]}();console.error("SystemLang: ",i),t.I18n=function(e,t){var n=i;t&&r.sharedContext.gid&&r.sharedContext.gid.lang&&(n=r.sharedContext.gid.lang);var o=a[n];return o||(o=a.en),o[e]||e||""}},800:function(e,t,n){Object.defineProperty(t,"__esModule",{value:!0}),t.createSubmitButtonForGroup=t.bindSubmitActionButton=void 0;var r=n(247),a=n(66),i=n(161),o=n(830),s=(new Date).getTime();function l(e,t,n){var i=a.shared[e],l=Object.keys(i).map((function(e){return parseInt(e)}));t.off(),t.on("click",(function(e){e.preventDefault();var t=(new Date).getTime();if(s&&t-s<1e3)console.error("Too frequently checks are blocked!");else for(var c=0,u=l.length;c<u;c++){var p=l[c],f=i[p];if(f.getStatus()==a.cfg.STATUS.MODIFIED){var d=f.latex()||[];if(0===d.length||(0,r.has_empty_answers)(d))f.checkMsg(-1,"Falten respostes"),console.error("Editor contains empty answers");else if(1!=f.getStatus()&&d.length){if(f.getDefinition().right_answer&&f.getWrong_attemps()>a.cfg.MAX_ATTEMPTS&&!f.isPigen()){f.showAnswer();continue}if(f.getQType()==a.cfg.QTYPES.M||f.getQType()==a.cfg.QTYPES.Ms){var h=f.isComodiUsed()?5:10;f.getDefinition().ans==d[0]?f.checkMsg(1,"Molt bé!"):(h=0,f.increment_wrong(),f.checkMsg(0,"Incorrecte")),n&&n(h);continue}s=t;var y={latex:d,qid:p},v="";if((v=null!=f.getDefinition().anse?atob(f.getDefinition().anse||""):f.getDefinition().ans||"")&&1==d.length&&(0,o.isNumeric)(d[0])&&(0,o.isNumeric)(v)){var b=parseFloat(d[0]),m=(parseFloat(v),h=f.isComodiUsed()?5:10,parseFloat(v)-b),g=0;f.getDefinition().rules&&f.getDefinition().rules.precision&&(g=f.getDefinition().rules.precision),Math.abs(m)<=g?f.checkMsg(1,"Molt bé!"):(h=0,f.increment_wrong(),f.checkMsg(0,"Incorrecte")),n&&n(h);continue}(0,o.copyPropsFromTo)(f.getDefinition(),y),a.cfg.pageInfo&&(y.pageInfo=a.cfg.pageInfo,f.getHash()||f.setHash((0,o.MD5)(y.formulation+"_"+(y.pageInfo.bookId||0)+"_"+(y.pageInfo.chapterId||0))),y.hash=f.getHash()),$.ajax({type:"POST",url:a.cfg.CAS_URL,data:JSON.stringify(y),dataType:"json",success:function(e){var t=i[e.qid];0==e.correct&&t.increment_wrong(),t.checkMsg(e.correct,e.msg);var r=e.correct?t.isComodiUsed()?5:10:0;n&&n(r)},error:function(e){}})}}}}))}t.bindSubmitActionButton=l,t.createSubmitButtonForGroup=function(e){var t=$('<button class="btn btn-sm btn-primary pw-me-submitgroup"><i class="fas fa-check"></i> '.concat((0,i.I18n)("check",e),"</button>"));return l(e,t),t}},247:function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.has_empty_answers=t.extractMatrices=void 0;var n=/\\begin{pmatrix}(.*?)\\end{pmatrix}/g;function r(e){for(var t=[],r=null,a=function(){var e=[];r[1].split("\\\\").forEach((function(t){var n=t.split("&");e.push(n)})),t.push(e)};null!==(r=n.exec(e));)a();return t}t.extractMatrices=r;var a=function(e){for(var t=e.length,n=0;n<t;n++)for(var r=e[n],a=r.length,i=0;i<a;i++)if(!r[i])return!0;return!1};t.has_empty_answers=function(e){for(var t=0,n=e.length;t<n;t++){var i=e[t];if(""==i||i&&!i.trim())return!0;for(var o=r(i),s=0,l=o.length;s<l;s++)if(a(o[s]))return!0}return!1}},968:function(e,t){function n(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}Object.defineProperty(t,"__esModule",{value:!0}),t.LevelIndicator=void 0;var r=function(){function e(t){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.numLevels=t,this.container=$('<div style="display:inline-block;font-size:90%;" data-toggle="tooltip"></div>'),this.levelIcons=[];for(var n=0;n<t;n++){var r=$('<i class="fas fa-pepper-hot" style="color:lightgray;"></i>');this.container.append(r),this.levelIcons.push(r)}}var t,r,a;return t=e,(r=[{key:"$div",get:function(){return this.container}},{key:"setLevel",value:function(e){e<0?e=0:e>this.numLevels&&(e=this.numLevels);for(var t=0;t<this.numLevels;t++)t<e?this.levelIcons[t].css("color","darkred"):this.levelIcons[t].css("color","lightgray");this.container.attr("data-original-title","Nivell "+e),this.container.removeAttr("title")}},{key:"setVisible",value:function(e){this.container.css("display",e?"":"none")}}])&&n(t.prototype,r),a&&n(t,a),Object.defineProperty(t,"prototype",{writable:!1}),e}();t.LevelIndicator=r},281:function(e,t){function n(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}Object.defineProperty(t,"__esModule",{value:!0}),t.PwDialog=void 0;var r=function(){function e(t,n,r){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.id="pwdlg_"+Math.random().toString(32).substring(2),this.window=$('<div id="'+this.id+'" class="pw-me-dlg" style="width:'+n+"px;height:"+r+'px;display:none;"></div>');var a=$('<div class="pw-me-dlg-header"></div>');this.topBar=a;var i=$('<span class="pw-me-dlg-headertitle">'+t+"</span>");this.closeBtn=$('<button class="btn btn-sm pw-me-btn-dlgclose" title="Tancar"><i class="fas fa-times"></i></button>');var o=this;this.closeBtn.on("click",(function(e){e.preventDefault(),o.window.css("display","none")})),a.append(i),a.append(this.closeBtn),this.window.append(a),$("body").append(this.window);var s,l,c,u,p=!1,f=0,d=0;this.dragStart=function(e){"touchstart"===e.type?(c=e.touches[0].clientX-f,u=e.touches[0].clientY-d):(c=e.clientX-f,u=e.clientY-d),e.target===a[0]&&(p=!0)},this.dragEnd=function(e){c=s,u=l,p=!1},this.setTranslate=function(e,t,n){n.style.transform="translate3d("+e+"px, "+t+"px, 0)"},this.drag=function(e){p&&(e.preventDefault(),"touchmove"===e.type?(s=e.touches[0].clientX-c,l=e.touches[0].clientY-u):(s=e.clientX-c,l=e.clientY-u),f=s,d=l,o.setTranslate(s,l,o.window[0]))},a[0].addEventListener("touchstart",this.dragStart,!1),a[0].addEventListener("touchend",this.dragEnd,!1),a[0].addEventListener("touchmove",this.drag,!1),a[0].addEventListener("mousedown",this.dragStart,!1),a[0].addEventListener("mouseup",this.dragEnd,!1),a[0].addEventListener("mousemove",this.drag,!1)}var t,r,a;return t=e,(r=[{key:"append",value:function(e){this.window.append(e)}},{key:"show",value:function(){this.window.css("display","initial")}},{key:"close",value:function(){this.window.css("display","none")}},{key:"remove",value:function(){this.closeBtn.off(),this.window.remove(),this.topBar[0].removeEventListener("touchstart",this.dragStart),this.topBar[0].removeEventListener("touchend",this.dragEnd),this.topBar[0].removeEventListener("touchmove",this.drag),this.topBar[0].removeEventListener("mousedown",this.dragStart),this.topBar[0].removeEventListener("mouseup",this.dragEnd),this.topBar[0].removeEventListener("mousemove",this.drag)}},{key:"dispose",value:function(){this.remove()}}])&&n(t.prototype,r),a&&n(t,a),Object.defineProperty(t,"prototype",{writable:!1}),e}();t.PwDialog=r},541:function(e,t,n){function r(e){return r="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},r(e)}function a(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function i(e,t){return i=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(e,t){return e.__proto__=t,e},i(e,t)}function o(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=c(e);if(t){var a=c(this).constructor;n=Reflect.construct(r,arguments,a)}else n=r.apply(this,arguments);return s(this,n)}}function s(e,t){if(t&&("object"===r(t)||"function"==typeof t))return t;if(void 0!==t)throw new TypeError("Derived constructors may only return object or undefined");return l(e)}function l(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function c(e){return c=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(e){return e.__proto__||Object.getPrototypeOf(e)},c(e)}Object.defineProperty(t,"__esModule",{value:!0}),t.EditorDialog=void 0;var u=n(66),p=n(161),f=n(830),d=n(786),h=function(e){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&i(e,t)}(c,e);var t,n,r,s=o(c);function c(){var e;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,c);var t=l(e=s.call(this,'<i style="color:darkred;" class="fas fa-square-root-alt"></i> '+(0,p.I18n)("matheditor"),500,320)),n="gid_"+Math.random().toString(32).substring(2),r=u.cfg.QTYPES.P;e.editorPanel=new d.EditorPanel(e.window,n,{},r,!1);var a=$('<div class="pw-me-dlg-controls"></div>'),i=$('<button class="btn btn-sm btn-primary">'+(0,p.I18n)("accept")+"</button>"),o=$('<button class="btn btn-sm btn-outline-primary">'+(0,p.I18n)("cancel")+"</button>");return a.append(i),a.append(o),e.append(a),i.on("click",(function(e){e.preventDefault(),t.acceptFn&&t.acceptFn(t),t.close()})),o.on("click",(function(e){e.preventDefault(),t.cancelFn&&t.cancelFn(t),t.close()})),e}return t=c,(n=[{key:"latex",value:function(e){return null!=e?(this.editorPanel.latex(e),[""]):this.editorPanel.latex().map((function(e){return(0,f.sanitizeLaTeX)(e)}))}},{key:"show",value:function(){this.window.css("display",""),this.editorPanel.focus()}},{key:"dispose",value:function(){this.editorPanel.dispose(),this.window.find("button").off(),this.dispose()}},{key:"reflow",value:function(){this.editorPanel.reflow()}},{key:"setDefinition",value:function(e){this.editorPanel.setDefinition(e)}}])&&a(t.prototype,n),r&&a(t,r),Object.defineProperty(t,"prototype",{writable:!1}),c}(n(281).PwDialog);t.EditorDialog=h},44:function(e,t,n){function r(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}Object.defineProperty(t,"__esModule",{value:!0}),t.EditorBase=void 0;var a=n(66),i=function(){function e(t,n,r,i){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.parent=t,this.gid=n,this.status=a.cfg.STATUS.UNMODIFIED,this.wrong_attemps=0,this.isAnswerShown=!1,this.def=r,this.qtype=i,this.pigen=!1,this.comodi=!1,this.hash=""}var t,n,i;return t=e,(n=[{key:"get_gid",value:function(){return this.gid}},{key:"setDefinition",value:function(e){this.def=e,this.ansType=e.ansType}},{key:"getDefinition",value:function(){return this.def}},{key:"increment_wrong",value:function(){this.wrong_attemps+=1}},{key:"getWrong_attemps",value:function(){return this.wrong_attemps}},{key:"getStatus",value:function(){return this.status}},{key:"setStatus",value:function(e){this.status=e}},{key:"getQType",value:function(){return this.qtype}},{key:"setQType",value:function(e){this.qtype=e}},{key:"isPigen",value:function(){return this.pigen}},{key:"setPigen",value:function(e){this.pigen=e}},{key:"isComodiUsed",value:function(){return this.comodi}},{key:"setComodiUsed",value:function(e){this.comodi=e}},{key:"getHash",value:function(){return this.hash}},{key:"setHash",value:function(e){this.hash=e}}])&&r(t.prototype,n),i&&r(t,i),Object.defineProperty(t,"prototype",{writable:!1}),e}();t.EditorBase=i},437:function(e,t,n){function r(e){return r="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},r(e)}function a(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function i(e,t){return i=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(e,t){return e.__proto__=t,e},i(e,t)}function o(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=c(e);if(t){var a=c(this).constructor;n=Reflect.construct(r,arguments,a)}else n=r.apply(this,arguments);return s(this,n)}}function s(e,t){if(t&&("object"===r(t)||"function"==typeof t))return t;if(void 0!==t)throw new TypeError("Derived constructors may only return object or undefined");return l(e)}function l(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function c(e){return c=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(e){return e.__proto__||Object.getPrototypeOf(e)},c(e)}Object.defineProperty(t,"__esModule",{value:!0}),t.EditorCloze=void 0;var u=n(66),p=n(161),f=n(830),d=n(281),h=function(e){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&i(e,t)}(c,e);var t,n,r,s=o(c);function c(e,t,n,r,a){var i;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,c);var o=l(i=s.call(this,e,t,n,r));i.dlg_btn_el=null,i.quill_el_container=$('<div class="pw-me-editorinput"></div>');var p=$("<span>"+a+"</span>");return i.check_el=$('<div class="pw-me-check"></div>'),i.parent.append(i.quill_el_container),i.quill_el_container.append(p),i.mathInput=(0,u.StaticMath)(p[0]),i.mathInput.innerFields.forEach((function(e){e.__controller.textarea.on("keyup",(function(e){e.preventDefault(),o.status!=u.cfg.STATUS.MODIFIED&&(o.check_el.html(""),o.status=u.cfg.STATUS.MODIFIED,o.quill_el_container.removeClass("pw-me-right pw-me-wrong pw-me-alert"))}))})),i.quill_el_container.append(i.check_el),i}return t=c,(n=[{key:"clear",value:function(){this.mathInput.innerFields.forEach((function(e){return e.latex("")})),this.check_el.html(""),this.status=u.cfg.STATUS.UNMODIFIED,this.quill_el_container.removeClass("pw-me-right pw-me-wrong pw-me-alert")}},{key:"focus",value:function(){this.mathInput.focus()}},{key:"latex",value:function(e){if(null==e){var t=[];this.mathInput.innerFields;for(var n=this.mathInput.innerFields,r=0,a=n.length;r<a;r++)t.push(n[r].latex());return t}return this.mathInput.latex(e),this.status=u.cfg.STATUS.UNMODIFIED,[]}},{key:"checkMsg",value:function(e,t){this.status=e;var n="";1==e?(n='<span data-toggle="tooltip" title="'+t+'"><i class="fas fa-check"></i></span>',this.quill_el_container.addClass("pw-me-right")):0==e?(n='<span data-toggle="tooltip" title="'+t+'"><i class="fas fa-times"></i></span>',this.quill_el_container.addClass("pw-me-wrong")):(n='<span data-toggle="tooltip" title="'+t+'"><i class="fas fa-exclamation-triangle"></i></span>',this.quill_el_container.addClass("pw-me-alert")),this.check_el.html(n)}},{key:"get_qid",value:function(){return this.mathInput.id}},{key:"dispose",value:function(){this.mathInput.revert(),this.quill_el_container.find("button").off()}},{key:"reflow",value:function(){this.mathInput.reflow(),this.status=u.cfg.STATUS.UNMODIFIED}},{key:"showAnswer",value:function(){if(this.def)if(this.def.right_answer){var e=this;if(!u.sharedDlg.showAnswerDlg){var t=new d.PwDialog((0,p.I18n)("right_answer",this.gid),400,250);u.sharedDlg.showAnswerDlg=t;var n=$('<div class="pw-answer-holder"></div>');t.append(n);var r=$('<button class="btn btn-sm btn-primary" style="margin-left: 15px;">'+(0,p.I18n)("close",this.gid)+"</button>");t.append(r),r.on("click",(function(e){e.preventDefault(),t.close()}))}e.isAnswerShown||(e.isAnswerShown=!0,e.status=u.cfg.STATUS.UNMODIFIED,e.dlg_btn_el&&e.dlg_btn_el.prop("disabled",!0));var a=u.sharedDlg.showAnswerDlg,i=a.window.find(".pw-answer-holder");e.def&&(i.html(atob(e.def.right_answer)+"<p><br></p>"),(0,f.reflowLatex)(),a.show())}else console.error("Cannot show answer because, ",this.def.right_answer);else console.error("Cannot show answer because, def is null")}}])&&a(t.prototype,n),r&&a(t,r),Object.defineProperty(t,"prototype",{writable:!1}),c}(n(44).EditorBase);t.EditorCloze=h},980:function(e,t,n){function r(e){return r="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},r(e)}function a(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function i(e,t){return i=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(e,t){return e.__proto__=t,e},i(e,t)}function o(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=c(e);if(t){var a=c(this).constructor;n=Reflect.construct(r,arguments,a)}else n=r.apply(this,arguments);return s(this,n)}}function s(e,t){if(t&&("object"===r(t)||"function"==typeof t))return t;if(void 0!==t)throw new TypeError("Derived constructors may only return object or undefined");return l(e)}function l(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function c(e){return c=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(e){return e.__proto__||Object.getPrototypeOf(e)},c(e)}Object.defineProperty(t,"__esModule",{value:!0}),t.EditorInput=void 0;var u=n(66),p=n(161),f=n(830),d=n(281),h=n(541),y=function(e){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&i(e,t)}(c,e);var t,n,r,s=o(c);function c(e,t,n,r){var a;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,c);var i=l(a=s.call(this,e,t,n,r));a.quill_el_container=$('<div class="pw-me-editorinput"></div>'),a.quill_blocker=$("<div></div>");var o=$("<span></span>");a.quill_blocker.append(o),a.check_el=$('<div class="pw-me-check"></div>'),a.quill_el_container.append(a.quill_blocker);var f=r===u.cfg.QTYPES.S;return a.parent.append(a.quill_el_container),a.mathInput=(0,u.MathField)(o[0],{handlers:{edit:function(){i.mathInput.latex(),i.status!=u.cfg.STATUS.MODIFIED&&(i.check_el.html(""),i.status=u.cfg.STATUS.MODIFIED,i.quill_el_container.removeClass("pw-me-right pw-me-wrong pw-me-alert"))}}}),f&&(a.dlg_btn_el=$('<button class="btn btn-sm pw-me-btn-openeditor" title="'+(0,p.I18n)("open_editor",a.gid)+'"><i class="fas fa-square-root-alt"></i></button>'),a.quill_el_container.append(a.dlg_btn_el),a.dlg_btn_el.on("click",(function(e){e.preventDefault();var t=u.sharedDlg.editordlg;t||(t=new h.EditorDialog,u.sharedDlg.editordlg=t),t.acceptFn=function(e){i.mathInput.latex(e.latex())},t.setDefinition(i.def),t.show(),t.latex(i.mathInput.latex())}))),a.quill_el_container.append(a.check_el),a}return t=c,(n=[{key:"get_qid",value:function(){return this.mathInput.id}},{key:"clear",value:function(){this.mathInput.latex(""),this.check_el.html(""),this.status=u.cfg.STATUS.UNMODIFIED,this.quill_el_container.removeClass("pw-me-right pw-me-wrong pw-me-alert")}},{key:"focus",value:function(){this.mathInput.focus()}},{key:"latex",value:function(e){return null==e?[(0,f.sanitizeLaTeX)(this.mathInput.latex())]:(this.mathInput.latex(e),this.status=u.cfg.STATUS.UNMODIFIED,[])}},{key:"checkMsg",value:function(e,t){this.status=e;var n=null;1==e?(n='<span data-toggle="tooltip" title="'+t+'"><i class="'+u.cfg.RIGHT_ICON+'"></i></span>',this.quill_el_container.addClass("pw-me-right")):0==e?(n='<span data-toggle="tooltip" title="'+t+'"><i class="'+u.cfg.WRONG_ICON+'"></i></span>',this.quill_el_container.addClass("pw-me-wrong")):(n='<span data-toggle="tooltip" title="'+t+'"><i class="fas fa-exclamation-triangle"></i></span>',this.quill_el_container.addClass("pw-me-alert")),this.check_el.html(n)}},{key:"dispose",value:function(){this.mathInput.revert(),this.quill_el_container.find("button").off()}},{key:"showAnswer",value:function(){if(this.def.right_answer){var e=this;if(!u.sharedDlg.showAnswerDlg){var t=new d.PwDialog((0,p.I18n)("right_answer",this.gid),400,250);u.sharedDlg.showAnswerDlg=t;var n=$('<div class="pw-answer-holder"></div>');t.append(n);var r=$('<button class="btn btn-sm btn-primary" style="margin-left: 15px;">'+(0,p.I18n)("close",this.gid)+"</button>");t.append(r),r.on("click",(function(e){e.preventDefault(),t.close()}))}e.isAnswerShown||(e.isAnswerShown=!0,e.status=u.cfg.STATUS.UNMODIFIED,e.quill_blocker.addClass("pw-me-blocker"),e.dlg_btn_el&&e.dlg_btn_el.prop("disabled",!0)),n=(t=u.sharedDlg.showAnswerDlg).window.find(".pw-answer-holder"),e.def&&(n.html(atob(e.def.right_answer)+"<p><br></p>"),(0,f.reflowLatex)(),t.show())}else console.error("Cannot show answer because, ",this.def.right_answer)}},{key:"increment_wrong",value:function(){if(this.wrong_attemps,u.cfg.MAX_ATTEMPTS,this.pigen,this.wrong_attemps+=1,this.wrong_attemps==u.cfg.MAX_ATTEMPTS+1&&!this.pigen){this.def;var e=$('<button class="btn btn-sm" title="'+(0,p.I18n)("show_answer",this.gid)+'"><i class="far fa-question-circle"></i></button>'),t=this;e.on("click",(function(e){t.showAnswer()})),this.def.right_answer?this.quill_el_container.append(e):$.ajax({type:"POST",url:u.cfg.GETANSWER_URL,data:JSON.stringify(this.def),dataType:"json",success:function(n){n.right_answer&&t.def?(t.def.right_answer=n.right_answer,t.quill_el_container.append(e)):n.msg&&console.error(n.msg)}})}}},{key:"reflow",value:function(){this.mathInput.reflow(),this.status=u.cfg.STATUS.UNMODIFIED}}])&&a(t.prototype,n),r&&a(t,r),Object.defineProperty(t,"prototype",{writable:!1}),c}(n(44).EditorBase);t.EditorInput=y},203:function(e,t,n){function r(e){return r="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},r(e)}function a(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function i(e,t){return i=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(e,t){return e.__proto__=t,e},i(e,t)}function o(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=c(e);if(t){var a=c(this).constructor;n=Reflect.construct(r,arguments,a)}else n=r.apply(this,arguments);return s(this,n)}}function s(e,t){if(t&&("object"===r(t)||"function"==typeof t))return t;if(void 0!==t)throw new TypeError("Derived constructors may only return object or undefined");return l(e)}function l(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function c(e){return c=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(e){return e.__proto__||Object.getPrototypeOf(e)},c(e)}Object.defineProperty(t,"__esModule",{value:!0}),t.EditorMChoice=void 0;var u=n(66),p=n(161),f=n(830),d=function(e){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&i(e,t)}(c,e);var t,n,r,s=o(c);function c(e,t,n,r,a){var i;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,c),i=s.call(this,e,t,n,r),"string"==typeof a&&(a=a.split(";"));var o=l(i);i.selectedIndex="",i.gid=t,i.qid=Math.floor(1e4*Math.random())+1e4,i.options=a||[],i.status=u.cfg.STATUS.UNMODIFIED,i.parent=e,i.wrong_attemps=0,i.quill_el_container=$('<div class="pw-me-mchoice"></div>'),i.check_el=$('<div class="pw-me-check"></div>');var d=$('<div class="btn-group"></div>');i.btn_action=$('<button type="button" style="background:white;" class="btn btn-outline-primary dropdown-toggle" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">'+(0,p.I18n)("choose_option",i.gid)+"</button>");var h=$('<div class="dropdown-menu"></div>');return d.append(i.btn_action),a.forEach((function(e,t){var n=$('<a class="dropdown-item" href="#">'+e+"</a>");n.on("click",(function(e){e.preventDefault(),o.selectedIndex=t+"",o.btn_action.html(n.html()),o.status!=u.cfg.STATUS.MODIFIED&&(o.check_el.html(""),o.status=u.cfg.STATUS.MODIFIED,o.quill_el_container.removeClass("pw-me-right pw-me-wrong pw-me-alert"))})),h.append(n)})),d.append(h),i.quill_el_container.append(d),i.quill_el_container.append(i.check_el),i.parent.append(i.quill_el_container),(0,f.reflowLatex)(),i}return t=c,(n=[{key:"showAnswer",value:function(){}},{key:"clear",value:function(){this.selectedIndex="",this.btn_action.html(""),this.check_el.html(""),this.status=u.cfg.STATUS.UNMODIFIED,this.quill_el_container.removeClass("pw-me-right pw-me-wrong pw-me-alert")}},{key:"focus",value:function(){this.btn_action.focus()}},{key:"latex",value:function(e){return[this.selectedIndex]}},{key:"checkMsg",value:function(e,t){this.status=e;var n="";1==e?(n='<span data-toggle="tooltip" title="'+t+'"><i class="fas fa-check"></i></span>',this.quill_el_container.addClass("pw-me-right")):0==e?(n='<span data-toggle="tooltip" title="'+t+'"><i class="fas fa-times"></i></span>',this.quill_el_container.addClass("pw-me-wrong")):(n='<span data-toggle="tooltip" title="'+t+'"><i class="fas fa-exclamation-triangle"></i></span>',this.quill_el_container.addClass("pw-me-alert")),this.check_el.html(n)}},{key:"dispose",value:function(){this.quill_el_container.off()}},{key:"get_qid",value:function(){return this.qid}},{key:"reflow",value:function(){this.status=u.cfg.STATUS.UNMODIFIED}}])&&a(t.prototype,n),r&&a(t,r),Object.defineProperty(t,"prototype",{writable:!1}),c}(n(44).EditorBase);t.EditorMChoice=d},142:function(e,t,n){function r(e){return r="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},r(e)}function a(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function i(e,t){return i=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(e,t){return e.__proto__=t,e},i(e,t)}function o(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=c(e);if(t){var a=c(this).constructor;n=Reflect.construct(r,arguments,a)}else n=r.apply(this,arguments);return s(this,n)}}function s(e,t){if(t&&("object"===r(t)||"function"==typeof t))return t;if(void 0!==t)throw new TypeError("Derived constructors may only return object or undefined");return l(e)}function l(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function c(e){return c=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(e){return e.__proto__||Object.getPrototypeOf(e)},c(e)}Object.defineProperty(t,"__esModule",{value:!0}),t.EditorMChoiceCheckbox=void 0;var u=n(66),p=n(830),f=function(e){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&i(e,t)}(c,e);var t,n,r,s=o(c);function c(e,t,n,r,a){var i;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,c),(i=s.call(this,e,t,n,r)).multipleAnswers=a||!1;var o=n.symbols,f=l(i);i.selectedIndex="",i.gid=t,i.qid=Math.floor(1e4*Math.random())+1e4,i.options=o||[],i.status=u.cfg.STATUS.UNMODIFIED,i.parent=e,i.wrong_attemps=0,i.quill_el_container=$('<div class="pw-me-mchoice"></div>'),i.check_el=$('<div class="pw-me-check"></div>');var d=$("<div></div>"),h="rgid_"+Math.random().toString(32).substring(2),y=[];return o.forEach((function(e,t){var n="raid_"+Math.random().toString(32).substring(2),r=$('<div class="form-check"></div>'),a=null;a=f.multipleAnswers?$('<input class="form-check-input" type="checkbox" id="'+n+'" value="'+t+'"/>'):$('<input class="form-check-input" type="radio" name="'+h+'" id="'+n+'" value="'+t+'"/>'),y.push(a);var i=$('<label class="form-check-label" for="'+n+'">'+e+"</label>");a.on("change",(function(e){e.preventDefault();for(var t=[],n=0;n<y.length;n++)y[n].prop("checked")&&t.push(y[n].prop("value")+"");f.selectedIndex=t.join(","),f.status!=u.cfg.STATUS.MODIFIED&&(f.check_el.html(""),f.status=u.cfg.STATUS.MODIFIED,f.quill_el_container.removeClass("pw-me-right pw-me-wrong pw-me-alert"))})),r.append(a),r.append(i),d.append(r)})),i.quill_el_container.append(d),i.quill_el_container.append(i.check_el),i.parent.append(i.quill_el_container),(0,p.reflowLatex)(),i}return t=c,(n=[{key:"showAnswer",value:function(){}},{key:"clear",value:function(){this.selectedIndex="",this.btn_action.html(""),this.check_el.html(""),this.status=u.cfg.STATUS.UNMODIFIED,this.quill_el_container.removeClass("pw-me-right pw-me-wrong pw-me-alert")}},{key:"focus",value:function(){}},{key:"latex",value:function(e){return[this.selectedIndex]}},{key:"get_qid",value:function(){return this.qid}},{key:"checkMsg",value:function(e,t){this.status=e;var n="";1==e?(n='<span data-toggle="tooltip" title="'+t+'"><i class="fas fa-check"></i></span>',this.quill_el_container.addClass("pw-me-right")):0==e?(n='<span data-toggle="tooltip" title="'+t+'"><i class="fas fa-times"></i></span>',this.quill_el_container.addClass("pw-me-wrong")):(n='<span data-toggle="tooltip" title="'+t+'"><i class="fas fa-exclamation-triangle"></i></span>',this.quill_el_container.addClass("pw-me-alert")),this.check_el.html(n)}},{key:"dispose",value:function(){this.quill_el_container.off()}},{key:"reflow",value:function(){this.status=u.cfg.STATUS.UNMODIFIED}}])&&a(t.prototype,n),r&&a(t,r),Object.defineProperty(t,"prototype",{writable:!1}),c}(n(44).EditorBase);t.EditorMChoiceCheckbox=f},786:function(e,t,n){function r(e){return r="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},r(e)}function a(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function i(e,t){return i=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(e,t){return e.__proto__=t,e},i(e,t)}function o(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=c(e);if(t){var a=c(this).constructor;n=Reflect.construct(r,arguments,a)}else n=r.apply(this,arguments);return s(this,n)}}function s(e,t){if(t&&("object"===r(t)||"function"==typeof t))return t;if(void 0!==t)throw new TypeError("Derived constructors may only return object or undefined");return l(e)}function l(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function c(e){return c=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(e){return e.__proto__||Object.getPrototypeOf(e)},c(e)}var u=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.EditorPanel=void 0;var p=n(66),f=n(830),d=n(837),h=n(280),y=u(n(727)),v=function(e){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&i(e,t)}(c,e);var t,n,r,s=o(c);function c(e,t,n,r,a){var i;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,c);var o=l(i=s.call(this,e,t,n,r));return i.parent=e,i.gid=t,i.wrong_attemps=0,i.standalone=a||!1,i.status=p.cfg.STATUS.UNMODIFIED,i.panel=$('<div class="pw-me-editorpanel" style="position:relative"></div>'),i.parent.append(i.panel),i.palettes=new d.PwTabMenu(i.panel,i.gid),i.spanMathInput=$('<span class="pw-me-editorpanel-mathinput"></span>'),i.spanMathInput.on("click",(function(e){e.preventDefault(),$(".pw-me-btn-dropdownmenu").css("display","none")})),i.panel.append(i.spanMathInput),i.mathInput=(0,p.MathField)(i.spanMathInput[0],{handlers:{edit:function(){a&&o.status!=p.cfg.STATUS.MODIFIED&&(o.check_el&&o.check_el.html(""),o.status=p.cfg.STATUS.MODIFIED)}}}),i.standalone&&(i.check_el=$("<div></div>"),i.panel.append(i.check_el)),i.feedback_el=$('<div class="pw-mq-feedback" style="display:none;"></div>'),i.panel.append(i.feedback_el),(0,f.items)(y.default.button_meta,(function(e,t){var n=y.default.default_toolbar_tabs[t.tab-1];o.palettes.addTab(n);var r=(0,h.createToolbarButton)(o.panel,t,e,o.mathInput);o.palettes.addContentsToTab(n,r)})),i.setDefinition(n),i}return t=c,(n=[{key:"$div",get:function(){return this.panel}},{key:"clear",value:function(){this.mathInput.latex(""),this.check_el&&this.check_el.html(""),this.status=p.cfg.STATUS.UNMODIFIED}},{key:"focus",value:function(){this.mathInput.focus()}},{key:"latex",value:function(e){return null==e?[(0,f.sanitizeLaTeX)(this.mathInput.latex())]:(this.mathInput.latex(e),this.status=p.cfg.STATUS.UNMODIFIED,[""])}},{key:"checkMsg",value:function(e,t){if(this.standalone){this.status=e;var n="";n=1==e?'<span style="color:green;margin:5px;"><i class="fas fa-check"></i> '+t+"</span>":0==e?'<span style="color:darkred;margin:5px;"><i class="fas fa-times"></i> '+t+"</span>":'<span style="color:purple;margin:5px;"><i class="fas fa-exclamation-triangle"></i> '+t+"</span>",this.check_el&&this.check_el.html(n)}}},{key:"get_qid",value:function(){return this.mathInput.id}},{key:"showPalette",value:function(e,t){this.palettes.setVisible(e,t)}},{key:"dispose",value:function(){this.mathInput.revert(),this.panel.find("button").off(),this.palettes.dispose()}},{key:"reflow",value:function(){this.mathInput.reflow(),this.status=p.cfg.STATUS.UNMODIFIED}},{key:"setDefinition",value:function(e){this.def=e;var t=this;if(e.palettes&&e.palettes.indexOf("all")>=0)y.default.default_toolbar_tabs.forEach((function(e){t.palettes.setVisible(e,!0)})),this.palettes.setTab("General");else if(e.palettes&&e.palettes.length){var n=null,r=0;y.default.default_toolbar_tabs.forEach((function(a){for(var i=!1,o=0;!i&&o<e.palettes.length;)(i=e.palettes[o].toLowerCase().trim()==a.toLowerCase().trim())&&0==o&&(n=a),i&&(r+=1),o+=1;t.palettes.setVisible(a,i)})),0!=r&&n||this.palettes.setVisible("General",!0),this.palettes.setTab(n||"General")}else y.default.default_toolbar_tabs.forEach((function(e){t.palettes.setVisible(e,"General"==e)})),this.palettes.setTab("General")}},{key:"increment_wrong",value:function(){this.wrong_attemps+=1,this.wrong_attemps>p.cfg.MAX_ATTEMPTS&&this.showAnswer()}},{key:"showAnswer",value:function(){var e,t=this;this.def?this.def.right_answer?(null===(e=t.check_el)||void 0===e||e.css("display","none"),this.feedback_el.css("display",""),this.feedback_el.html(atob(this.def.right_answer)+"<p><br></p>"),(0,f.reflowLatex)(),this.isAnswerShown=!0,this.palettes.setEnabled(!1),this.spanMathInput.css("pointer-events","none"),this.panel.css("cursor","not-allowed")):$.ajax({type:"POST",url:p.cfg.GETANSWER_URL,data:JSON.stringify(this.def),dataType:"json",success:function(e){var n;e.right_answer?(null===(n=t.check_el)||void 0===n||n.css("display","none"),t.def.right_answer=e.right_answer,t.feedback_el.css("display",""),t.feedback_el.html(atob(t.def.right_answer)+"<p><br></p>"),(0,f.reflowLatex)(),t.isAnswerShown=!0,t.palettes.setEnabled(!1),t.spanMathInput.css("pointer-events","none"),t.panel.css("cursor","not-allowed")):e.msg&&console.error(e.msg)}}):console.error("Cannot show answer because def is null")}}])&&a(t.prototype,n),r&&a(t,r),Object.defineProperty(t,"prototype",{writable:!1}),c}(n(44).EditorBase);t.EditorPanel=v},280:function(e,t,n){Object.defineProperty(t,"__esModule",{value:!0}),t.createToolbarButton=void 0;var r=n(66);t.createToolbarButton=function(e,t,n,a){if("function"==typeof t.latex){var i=$('<div class="btn btn-sm pw-me-btn-toolbar pw-me-btn-dropdown" title="'+n.trim()+'"></div>'),o=$("<span>"+t.icon+"</span>");(0,r.StaticMath)(o[0]),i.append(o);var s=$('<div class="pw-me-btn-dropdownmenu"></div>');e.append(s);for(var l=[],c=0,u=t.vars.length;c<u;c++){var p=t.vars[c],f=p.name,d="";null!=p.min&&(d=' min="'+p.min+'" '),null!=p.max&&(d+=' max="'+p.max+'" ');var h=$('<input style="width:50px;margin-left:4px;grid-column:2;" type="'+p.type+'" value="'+p.val+'"'+d+"/>");l.push(h);var y=$('<span style="grid-column:1">'+f+"</span>");s.append(y),s.append(h)}var v=$('<button class="btn btn-sm" style="padding:4px;grid-row:3;grid-column:1 / 2;background:lightgray;">Ok</button>');s.append(v),v.on("click",(function(e){e.preventDefault();for(var n={},r=0,i=l.length;r<i;r++){var o=l[r],c=t.vars[r],u=c.name,p=o.val();"number"===c.type&&(p=parseInt(p)),n[u]=p}var f=t.latex(n);a.write(f),t.moveto&&a.keystroke(t.moveto),s.css("display","none"),a.focus()})),i.on("click",(function(e){e.preventDefault();var t=s.css("display");s.css("display","none"===t?"grid":"none")}))}else{i=$('<button class="btn btn-sm pw-me-btn-toolbar" title="'+n.trim()+'"></button>');o=$("<span>"+t.icon+"</span>");(0,r.StaticMath)(o[0]),i.append(o),i.on("click",(function(e){e.preventDefault(),a.write(t.latex),a.focus(),t.moveto&&a.keystroke(t.moveto),$(".pw-me-btn-dropdownmenu").css("display","none")}))}return i}},837:function(e,t,n){function r(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}Object.defineProperty(t,"__esModule",{value:!0}),t.PwTabMenu=void 0;var a=n(161),i=n(830),o=function(){function e(t,n){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.$panel=$('<div class="pw-me-tabmenu"></div>'),this.parent=t,this.tabs={},this.currentTab=null,this.tabsPanel=$('<div class="pw-me-tabspanel"></div>'),this.contentsPanel=$('<div class="pw-me-tabcontents"></div>'),this.$panel.append(this.tabsPanel),this.$panel.append(this.contentsPanel),this.parent&&this.parent.append(this.$panel),this.gid=n}var t,n,o;return t=e,(n=[{key:"$div",get:function(){return this.$panel}},{key:"addTab",value:function(e){if(!this.tabs[e]){var t=this,n=$('<button style="display:none;" class="btn btn-sm pw-me-btn-tab">'+(0,a.I18n)(e,this.gid)+"</button>"),r=$('<div style="display:none;" class="pw-me-tabcontainer"></div>');n.on("click",(function(n){n.preventDefault(),t.setTab(e)})),this.tabsPanel.append(n),this.contentsPanel.append(r),this.tabs[e]={tab:n,container:r},1===Object.keys(this.tabs).length&&this.setTab(e)}}},{key:"addContentsToTab",value:function(e,t){this.tabs[e]&&this.tabs[e].container.append(t)}},{key:"setVisible",value:function(e,t){this.tabs,this.tabs[e]&&(this.tabs[e].tab.css("display",t?"":"none"),this.tabs[e].container.css("display",t?"flex":"none"))}},{key:"setEnabled",value:function(e){e?(this.contentsPanel.css("pointer-events","initial"),this.$panel.css("cursor","initial")):(this.contentsPanel.css("pointer-events","none"),this.$panel.css("cursor","not-allowed"))}},{key:"setTab",value:function(e){(0,i.items)(this.tabs,(function(t,n){t==e?(n.tab.addClass("pw-me-btn-active"),n.tab.css("display","")):n.tab.removeClass("pw-me-btn-active"),n.container.css("display",t==e?"flex":"none")}))}},{key:"dispose",value:function(){this.tabsPanel.children().off(),this.tabsPanel.html(""),this.contentsPanel.html(""),this.tabs={}}}])&&r(t.prototype,n),o&&r(t,o),Object.defineProperty(t,"prototype",{writable:!1}),e}();t.PwTabMenu=o},727:function(e,t){Object.defineProperty(t,"__esModule",{value:!0});t.default={default_toolbar_buttons:["fraction","square_root","cube_root","root","superscript","subscript","multiplication","division","plus_minus","pi","degree","not_equal","greater_equal","less_equal","greater_than","less_than","angle","parallel_to","perpendicular","triangle","parallelogram","round_brackets","matrix2","matrix3"],default_toolbar_tabs:["General","Símbols","Geometria","Intervals","Funcions"],button_meta:{"Multiplicació":{latex:"\\times",tab:1,icon:"\\times"},"Fracció":{latex:"\\frac{}{}",moveto:"Up",movefor:1,tab:1,icon:"\\frac{\\square}{\\square}"},Exponent:{latex:"\\^{}",moveto:"Up",movefor:1,tab:1,icon:"\\square^2"},"Parèntesis":{latex:"\\left(\\right)",moveto:"Left",movefor:1,tab:1,icon:"\\left(\\square\\right)"},"Arrel quadrada":{latex:"\\sqrt{}",moveto:"Left",movefor:1,tab:1,icon:"\\sqrt{\\square}"},"Arrel cúbica":{latex:"\\sqrt[3]{}",moveto:"Left",movefor:1,tab:1,icon:"\\sqrt[3]{\\square}"},Radical:{latex:"\\sqrt[{}]{}",moveto:"Left",movefor:2,tab:1,icon:"\\sqrt[\\square]{\\square}"},"Matriu 2x2":{latex:"\\begin{pmatrix} & \\\\ & \\end{pmatrix}",tab:1,icon:"M_{2\\times 2}"},"Matriu 3x3":{latex:"\\begin{pmatrix} & & \\\\ & &  \\\\ & & \\end{pmatrix}",tab:1,icon:"M_{3\\times 3}"},"Matriu mxn":{latex:function(e){for(var t=[],n=0;n<e.n;n++){for(var r=[],a=0;a<e.m;a++)r.push(" ");t.push(r.join("&"))}return"\\begin{pmatrix} "+t.join("\\\\")+" \\end{pmatrix}"},tab:1,icon:"M_{n\\times m}",vars:[{name:"n",type:"number",min:1,val:2},{name:"m",type:"number",min:1,val:2}]},"Subíndex":{latex:"\\_{}",moveto:"Down",movefor:1,tab:1,icon:"\\square_{2}"},pi:{latex:"\\pi",tab:2,icon:"\\pi"},e:{latex:"\\e",tab:2,icon:"e"},infinit:{latex:"\\infty",tab:2,icon:"\\infty"},"Més menys":{latex:"\\pm",tab:2,icon:"\\pm"},Diferent:{latex:"\\neq",tab:2,icon:"\\neq"},"Major o igual":{latex:"\\geq",tab:2,icon:"\\geq"},"Menor o igual":{latex:"\\leq",tab:2,icon:"\\leq"},"Major que":{latex:"\\gt",tab:2,icon:"\\gt"},"Menor que":{latex:"\\lt",tab:2,icon:"\\lt"},Graus:{latex:"\\degree",tab:3,icon:"\\degree"},Angle:{latex:"\\angle",tab:3,icon:"\\angle"},"Paral·lel a":{latex:"\\parallel",tab:3,icon:"\\parallel"},"Perpendicular a":{latex:"\\perpendicular",tab:3,icon:"\\perpendicular"},Triangle:{latex:"\\triangle",tab:3,icon:"\\triangle"},"Paral·lelogram":{latex:"\\parallelogram",tab:3,icon:"\\parallelogram"},"Interval obert":{latex:"\\left( , \\right)",moveto:"Left",movefor:4,tab:4,icon:"\\left(\\square, \\square\\right)"},"Interval tancat":{latex:"\\left[ , \\right]",moveto:"Left",movefor:4,tab:4,icon:"\\left[\\square, \\square\\right]"},"Interval semi1":{latex:"\\left[ , \\right)",moveto:"Left",movefor:4,tab:4,icon:"\\left[\\square, \\square\\right)"},"Interval semi2":{latex:"\\left( , \\right]",moveto:"Left",movefor:4,tab:4,icon:"\\left(\\square, \\square\\right]"},Infinit:{latex:"\\infty",tab:4,icon:"\\infty"},"Conjunt dels reals":{latex:"\\mathbb{R}",tab:4,icon:"\\mathbb{R}"},Sinus:{latex:"\\sin()",moveto:"Left",movefor:1,tab:5,icon:"\\sin{\\square}"},Cosinus:{latex:"\\cos()",moveto:"Left",movefor:1,tab:5,icon:"\\cos{\\square}"},Tangent:{latex:"\\tan()",moveto:"Left",movefor:1,tab:5,icon:"\\tan{\\square}"},Arcsinus:{latex:"\\arcsin()",moveto:"Left",movefor:1,tab:5,icon:"\\arcsin{\\square}"},Arccosinus:{latex:"\\arccos()",moveto:"Left",movefor:1,tab:5,icon:"\\arccos{\\square}"},Arctangent:{latex:"\\arctan()",moveto:"Left",movefor:1,tab:5,icon:"\\arctan{\\square}"},"Logaritme Neperià":{latex:"\\ln()",moveto:"Left",movefor:1,tab:5,icon:"\\ln{\\square}"},"Logaritme en base b":{latex:"\\frac{\\log()}{\\log{b}}",moveto:"Left",movefor:4,tab:5,icon:"\\log_b{\\square}"}},keyboard_keys:{letters:[{value:"q",type:"write",class:"ks",display:"q",new_line:!1},{value:"w",type:"write",class:"ks",display:"w",new_line:!1},{value:"e",type:"write",class:"ks",display:"e",new_line:!1},{value:"r",type:"write",class:"ks",display:"r",new_line:!1},{value:"t",type:"write",class:"ks",display:"t",new_line:!1},{value:"y",type:"write",class:"ks",display:"y",new_line:!1},{value:"u",type:"write",class:"ks",display:"u",new_line:!1},{value:"i",type:"write",class:"ks",display:"i",new_line:!1},{value:"o",type:"write",class:"ks",display:"o",new_line:!1},{value:"p",type:"write",class:"ks",display:"p",new_line:!0},{value:"a",type:"write",class:"ks",display:"a",new_line:!1},{value:"s",type:"write",class:"ks",display:"s",new_line:!1},{value:"d",type:"write",class:"ks",display:"d",new_line:!1},{value:"f",type:"write",class:"ks",display:"f",new_line:!1},{value:"g",type:"write",class:"ks",display:"g",new_line:!1},{value:"h",type:"write",class:"ks",display:"h",new_line:!1},{value:"j",type:"write",class:"ks",display:"j",new_line:!1},{value:"k",type:"write",class:"ks",display:"k",new_line:!1},{value:"l",type:"write",class:"ks",display:"l",new_line:!0},{value:"CapsLock",type:"custom",class:"ks long icon",display:"&#8673;",new_line:!1},{value:"z",type:"write",class:"ks",display:"z",new_line:!1},{value:"x",type:"write",class:"ks",display:"x",new_line:!1},{value:"c",type:"write",class:"ks",display:"c",new_line:!1},{value:"v",type:"write",class:"ks",display:"v",new_line:!1},{value:"b",type:"write",class:"ks",display:"b",new_line:!1},{value:"n",type:"write",class:"ks",display:"n",new_line:!1},{value:"m",type:"write",class:"ks",display:"m",new_line:!1},{value:"Backspace",type:"keystroke",class:"ks long icon",display:"&#8678;",new_line:!0},{value:"numpad",type:"custom",class:"ks long",display:"123",new_line:!1},{value:",",type:"write",class:"ks",display:",",new_line:!1},{value:"\\ ",type:"write",class:"ks too_long",display:"Space",new_line:!1},{value:".",type:"write",class:"ks",display:".",new_line:!1},{value:"close",type:"custom",class:"ks long takeup",display:"X",new_line:!1}],numbers:[{value:"1",type:"write",class:"ks",display:"1",new_line:!1},{value:"2",type:"write",class:"ks",display:"2",new_line:!1},{value:"3",type:"write",class:"ks",display:"3",new_line:!1},{value:"+",type:"write",class:"ks",display:"+",new_line:!1},{value:"-",type:"write",class:"ks",display:"&#8315;",new_line:!0},{value:"4",type:"write",class:"ks",display:"4",new_line:!1},{value:"5",type:"write",class:"ks",display:"5",new_line:!1},{value:"6",type:"write",class:"ks",display:"6",new_line:!1},{value:"\\times",type:"write",class:"ks",display:"&times;",new_line:!1},{value:"/",type:"write",class:"ks",display:"&#247;",new_line:!0},{value:"7",type:"write",class:"ks",display:"7",new_line:!1},{value:"8",type:"write",class:"ks",display:"8",new_line:!1},{value:"9",type:"write",class:"ks",display:"9",new_line:!1},{value:"=",type:"write",class:"ks",display:"=",new_line:!1},{value:"Backspace",type:"keystroke",class:"ks long icon",display:"&#8678;",new_line:!0},{value:"letters",type:"custom",class:"ks long",display:"ABC",new_line:!1},{value:"0",type:"write",class:"ks",display:"0",new_line:!1},{value:"?",type:"write",class:"ks",display:"?",new_line:!1},{value:"%",type:"write",class:"ks",display:"%",new_line:!1},{value:"close",type:"custom",class:"ks long takeup",display:"X",new_line:!1}]}}},791:function(e,t,n){Object.defineProperty(t,"__esModule",{value:!0}),t.createQuillFromObject=void 0;var r=n(437),a=n(980),i=n(786),o=n(203),s=n(66),l=n(142),c=n(830);t.createQuillFromObject=function(e,t,n){var u=null,p=n.editor;if(n.formulation){var f="<span>"+n.formulation+"</span>";e.append(f),(0,c.reflowLatex)()}if(e.removeClass("pygen-cloze"),p==s.cfg.QTYPES.C)u=new r.EditorCloze(e,t,n,s.cfg.QTYPES.C,n.initial_latex),e.addClass("pygen-cloze");else if(p==s.cfg.QTYPES.P)u=new i.EditorPanel(e,t,n,s.cfg.QTYPES.P,!0);else if(p==s.cfg.QTYPES.M)n.symbols=n.symbols||[],u=new o.EditorMChoice(e,t,n,s.cfg.QTYPES.M,n.symbols);else if(p==s.cfg.QTYPES.Ms){n.symbols=n.symbols||[];var d=Array.isArray(n.ans);u=new l.EditorMChoiceCheckbox(e,t,n,s.cfg.QTYPES.Ms,d)}else u=p==s.cfg.QTYPES.B?new a.EditorInput(e,t,n,s.cfg.QTYPES.B):new a.EditorInput(e,t,n,s.cfg.QTYPES.S);var h=u.get_qid();return(s.shared[t]||{})[h]=u,u.setStatus(s.cfg.STATUS.UNMODIFIED),n.initial_latex&&p!=s.cfg.QTYPES.C&&(u.latex(n.initial_latex),u.setStatus(s.cfg.STATUS.MODIFIED)),h}},657:function(e,t,n){Object.defineProperty(t,"__esModule",{value:!0}),t.findPyGenerators=void 0;var r=n(800),a=n(968),i=n(791),o=n(66),s=n(969),l=n(161),c=n(713),u=n(316),p=n(970),f=n(831),d=n(830);t.findPyGenerators=function(){var e=window.IB||{};$("div[data-pygen]").each((function(t,n){var h=$(n);h.css({position:"relative","min-height":"300px","background-color":"#ffffff","background-image":'url("https://piworld.es/iedib/matheditor/backgrounds/triangles.svg")',"background-position":"center","background-size":"cover"}),h.html("");var y=h.attr("id")||"";y||(y="pyg_"+Math.random().toString(32).substring(2),h.attr("id",y)),o.shared[y]={};var v=$('<div style="display:flex;flex-direction:row-reverse;align-items:baseline;"></div>'),b=$("<div></div>"),m=$('<div style="display: flex; flex-direction: row; align-content: flex-start;margin:10px 0; flex-wrap: wrap; gap: 5px;margin-bottom:30px;"></div>'),g=$('<div style="position: absolute;left: 0;right: 0;bottom: 0;margin: 0;background-color: #9fa0ac; display: flex; flex-direction: row; align-content: flex-start; flex-wrap: wrap; gap: 5px;"></div>'),w=new a.LevelIndicator(4),_=h.attr("data-pygen-category")||"general";w.setVisible(o.cfg.HAS_IAPACE&&null!=h.attr("data-pygen-category")),v.append(w.container);var k=1;o.cfg.HAS_IAPACE&&(k=e.iapace.inference(_)),w.setLevel(k);var S=null;if(o.cfg.HAS_IAPACE&&null!=h.attr("data-pygen-goal")){var O=(h.attr("data-pygen-goal")||"").split(";").map((function(e){return e.split(",")}));(S=new s.GoalChecker(_,O)).accomplished()&&v.append($('<span class="pw-goal-reached">'+(0,l.I18n)("goal_reached",y)+" </span>"))}for(var x=(h.attr("data-pygen")||"").split(";"),I=[],P=0,T=x.length;P<T;P++){var E=x[P],M=null,q={};if(E.indexOf("[")>0){M=E.split("[")[0].trim();for(var j=E.split("[")[1].replace("]","").split(","),A=0,D=j.length;A<D;A++){var C=j[A];if(C.indexOf("=")>0){var R=C.split("="),F=R[0],L=R[1];L=L.indexOf("'")>=0?L.replace(/'/g,""):parseFloat(L),q[F]=L}}}else M=E.trim();Object.keys(q).length?I.push([M,q]):I.push([M])}var U=new u.SeqBasic(I);if(I.length>1){var N=(h.attr("data-pygen-order")||"random").trim().toLowerCase();N.startsWith("random")||N.startsWith("weighted")?U=new p.SeqRandomWeighted(I,N):N.startsWith("sequence")&&(U=new f.SeqSequence(I,N))}var B=$('<button class="btn btn-sm btn-primary"><i class="fas fa-check"></i> '+(0,l.I18n)("check",y)+"</button>"),G=$('<button class="btn btn-sm btn-warning" style="display:none;"><i class="far fa-life-ring"></i> '+(0,l.I18n)("wildcard",y)+" 50%</button>"),Q=null,Y=null,W=function(){B.prop("disabled",!0),z.prop("disabled",!0),H.prop("disabled",!0),G.css("display","none"),o.cfg.HAS_IAPACE&&(k=e.iapace.inference(_)),w.setLevel(k);var t=U.next();$.ajax({type:"POST",url:o.cfg.PYGEN_URL,data:JSON.stringify({activities:[t],level:k}),dataType:"json",success:function(t){if(t.msg)return Q=null,b.html('<p style="color:darkred">ERROR<br>'+JSON.stringify(t.msg)+"</p>"),console.error("ERROR: ",t),void z.prop("disabled",!1);b.html("");var n=$("<p><span>"+(h.attr("data-pygen-formulation")||"")+"</span> "+t.formulation+"</p>");b.append(n);var a=atob(t.mq64),s=JSON.parse(a);if(o.cfg.HAS_IAPACE){var u=e.iapace.findCreate(_);u&&(0,d.sum)(u.h)>=30&&G.css("display",null==s.comodi?"none":"")}s.category=_,s.palettes||(s.palettes="all"),s.editor==o.cfg.QTYPES.M&&(s.editor=o.cfg.QTYPES.Ms),Q=s,s.initial_latex&&(s.initial_latex=(0,c.processMqIni)(s.initial_latex));var p=[];if(s.symbols)for(var f=s.symbols.split(";"),m=0,g=f.length;m<g;m++){var w=f[m];w.trim()&&p.push(w.trim())}s.symbols=p;var k=[];s.rules&&(k=JSON.parse(s.rules)),s.rules=k;var O=(0,i.createQuillFromObject)(b,y,s);(Y=o.shared[y][O]).isPigen=!0,B.off();(0,r.bindSubmitActionButton)(y,B,(function(t){(z.prop("disabled",!1),H.prop("disabled",!1),o.cfg.HAS_IAPACE&&(e.iapace.addScore(_,t),e.iapace.save()),S&&S.reached())&&(0==v.find(".pw-goal-reached").length&&v.append($('<span class="pw-goal-reached">'+(0,l.I18n)("goal_reached",y)+" </span>")),"confetti"==h.attr("data-pygen-celebration")&&window.Confetti&&new window.Confetti(h[0]).play())})),o.shared[y],(0,d.reflowLatex)(),B.prop("disabled",!1)},error:function(e){Q=null,Y=null,b.html('<div><p style="color:darkred">ERROR<br>'+JSON.stringify(e)+"</p></div>"),z.prop("disabled",!1)}})},H=$('<button class="btn btn-sm btn-outline-info" title="Mostra la resposta"><i class="fas fa-question-circle"></i> '+(0,l.I18n)("answer",y)+"</button>");H.on("click",(function(e){e.preventDefault(),Y?Y.status!=o.cfg.STATUS.CORRECT&&Y.wrong_attemps<1||(B.prop("disabled",!0),H.prop("disabled",!0),Y.showAnswer&&Y.showAnswer()):console.error("Missing currentEditor here :-(")}));var z=$('<button class="btn btn-sm btn-outline-primary" title="Genera una nova pregunta"><i class="fas fa-arrow-circle-right"></i> '+(0,l.I18n)("next",y)+"</button>");if(z.on("click",(function(e){e.preventDefault();for(var t=Object.keys(o.shared[y]||{}),n=0,r=t.length;n<r;n++){var a=parseInt(t[n]);o.shared[y][a].dispose(),delete o.shared[y][a]}W()})),G.on("click",(function(e){e.preventDefault(),Y&&Q&&Q.comodi&&(Y.comodiUsed=!0,G.css("display","none"),Y.latex(Q.comodi),Y.status=o.cfg.STATUS.MODIFIED)})),m.append(B),m.append(z),m.append(H),m.append(G),h.append(v),h.append(b),h.append(m),"none"!=h.attr("data-copyright")){var J=$('<span style="padding:4px;font-size:70%;color:whitesmoke;"><em>pyQuizz</em> by Josep Mulet (c) 2021-22</span>');g.append(J),h.append(g)}W()}))}},66:function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.sharedContext=t.sharedDlg=t.shared=t.MathField=t.StaticMath=t.cfg=void 0;var n=function(e){for(var t={},n=e.substring(1).split("&"),r=0;r<n.length;r++){var a=n[r].trim().split("=");a[0]&&(1==a.length?t[a[0]]="1":t[a[0]]=a[1])}return t},r=function(){var e,t;if(!document.querySelector)return{};var r=-1,a="Usuari convidat",i=document.querySelector("[data-userid]");i&&(r=parseInt(i.getAttribute("data-userid")||"-1"));var o=document.querySelector(".usertext");o&&(a=o.innerText);var s={};location.search&&(s=n(location.search));var l=s.chapterid;if(!l){var c=document.querySelector('input[name="chapterid"]');c&&(l=c.value)}var u=s.id;if(!u){var p=document.querySelector('div.singlebutton > form > input[name="id"]');p&&(u=p.value)}var f=document.cookie||"",d=f.indexOf("="),h="";d>0&&(h=f.substr(d+1)),h&&h.indexOf(";")>0&&(h=h.split(";")[0]);var y,v="-1",b=document.querySelector(".homelink > a");if(b){y=b.innerText;var m="?"+(b.href.split("?")[1]||"");v=n(m).id}var g=null!=document.querySelector(".teacherdash.nav-item.nav-link")?1:0,w=(location.href.split("?")[0]||"").replace("/mod/book/view.php","");return{userId:r,userFullname:a,bookId:u,chapterId:l,assignNum:(null===(e=window.iedibAPI)||void 0===e?void 0:e.lliurament.id)||0,assignName:(null===(t=window.iedibAPI)||void 0===t?void 0:t.lliurament.title)||"",courseName:y,courseId:v,isTeacher:g,site:w,moodleSession:h}}(),a=window.IB&&window.IB.iapace;t.cfg={BASE_URL:"https://piworld.es/iedib/matheditor",pageInfo:r,STATUS:{UNMODIFIED:100,MODIFIED:200,CORRECT:1,WRONG:0},QTYPES:{S:"simple",B:"basic",C:"cloze",P:"panel",M:"mchoice",Ms:"mchoice*"},GETANSWER_URL:"https://piworld.es/pigen/api/getanswer",PYGEN_URL:"https://piworld.es/pigen/api/generate",CAS_URL:"https://piworld.es/pigen/api/compare",MAX_ATTEMPTS:2,HAS_IAPACE:a,RIGHT_ICON:"fas fa-check",WRONG_ICON:"fas fa-times"};var i={};t.StaticMath=function(e){return i.StaticMath||(i=window.MathQuill.getInterface(2)),i.StaticMath(e)},t.MathField=function(e,t){return i.MathField||(i=window.MathQuill.getInterface(2)),i.MathField(e,t)},t.shared={},t.sharedDlg={},t.sharedContext={}},969:function(e,t,n){function r(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}Object.defineProperty(t,"__esModule",{value:!0}),t.GoalChecker=void 0;var a=n(66),i=function(){function e(t,n){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.category=t,this.rules=n}var t,n,i;return t=e,(n=[{key:"accomplished",value:function(e){var t=window.IB||{};if(!a.cfg.HAS_IAPACE)return!1;if(!e){var n=t.iapace.find(this.category);return null!=n&&n.d}return t.iapace.findCreate(this.category).d=e,t.iapace.save(),e}},{key:"reached",value:function(){var e=window.IB||{};if(!a.cfg.HAS_IAPACE)return!1;if(this.accomplished())return!1;for(var t=e.iapace.findCreate(this.category),n=!1,r=this.rules.length,i=0;!n&&i<r;){var o=!0,s=this.rules[i],l=0;if(isNaN(s[0])?l+=1:o=o&&t.n>=parseInt(s[0]),isNaN(s[1]))l+=1;else{var c=0;t.n>0&&(c=t.s/(1*t.n)),o=o&&c>=parseFloat(s[1])}isNaN(s[2])?l+=1:o=o&&e.iapace.inference(this.category)>=parseInt(s[2]),l<3&&(n=o),i+=1}return n&&this.accomplished(!0),n}}])&&r(t.prototype,n),i&&r(t,i),Object.defineProperty(t,"prototype",{writable:!1}),e}();t.GoalChecker=i},713:function(e,t,n){Object.defineProperty(t,"__esModule",{value:!0}),t.createQuillFromDataAttr=t.processMqIni=void 0;var r=n(791),a=n(66);function i(e){return e=(e=(e=e||"").replace(/\?\d*?/g,"\\MathQuillMathField{}")).replace(/M\[(\d+)x(\d+)\]/g,(function(e,t,n){for(var r=parseInt(t),a=parseInt(n),i=[],o=new Array(a),s=0;s<r;s++)i.push(o.join(" & "));return"\\begin{pmatrix} "+i.join(" \\\\ ")+" \\end{pmatrix}"}))}t.processMqIni=i,t.createQuillFromDataAttr=function(e,t){var n=e.attr("data-mq")||"simple",o=e.attr("data-mq-ans"),s="ans";if(o||(s="anse",o=e.attr("data-mq-anse"))){if((o=o.trim()).startsWith("[")&&o.endsWith("]"))for(var l=0,c=(o=JSON.parse(o)).length;l<c;l++)o[l]=""+o[l];var u=i(e.attr("data-mq-ini")),p=e.attr("data-mq-symbols");if(n!==a.cfg.QTYPES.C||u){var f="";e.attr("data-mq-ra")&&(f=atob(e.attr("data-mq-ra")||""));var d=[];if(p)for(var h=p.split(";"),y=0,v=h.length;y<v;y++){var b=h[y];b.trim()&&d.push(b.trim())}var m=e.attr("data-mq-rules"),g=[];m&&(g=JSON.parse(m));var w=[],_=e.attr("data-mq-palettes");if(_)_.split(",").forEach((function(e){w.push(e.trim())}));var k={editor:n,symbols:d,right_answer:f,initial_latex:u,rules:g,palettes:w,ans:o,ansType:s};e.attr("data-mq-formulation")&&(k.formulation=e.attr("data-mq-formulation")),(0,r.createQuillFromObject)(e,t,k)}else console.error("> MQ ",e," is of type cloze but it has no data-mq-ini!")}else console.error("> MQ has no data-mq-ans/e!")}},216:function(e,t,n){Object.defineProperty(t,"__esModule",{value:!0}),t.findQuillGroups=void 0;var r=n(800),a=n(791),i=n(66),o=n(713),s=n(830);t.findQuillGroups=function(e){(e=e||$("body")).find(".pw-mq-group").each((function(t,n){var l=$(n);if(!l.hasClass("pw-mq-done")){l.addClass("pw-mq-done");var c=l.attr("id");c||(c="g_"+Math.random().toString(32).substring(2),l.attr("id",c)),i.shared[c]={},function(e,t){var n={};e.prop("data-lang")&&(n.lang=e.prop("data-lang")),i.sharedContext[t]=n}(l,c),function(e,t){e.find("[data-mq]").each((function(e,n){var r=$(n),l=$(n).attr("data-mq")||"simple";if((0,s.hasValue)(i.cfg.QTYPES,l))console.error("Definition via data-attributes in deprecated since version 2.0. Please encode the definition in a single data-mq field."),(0,o.createQuillFromDataAttr)(r,t);else try{var c=atob(l),u=JSON.parse(c);u.initial_latex=(0,o.processMqIni)(u.initial_latex||""),(0,a.createQuillFromObject)(r,t,u)}catch(e){console.error("Invalid or corrupted MQ definition:: ",l),console.error(e)}}))}(l,c);var u=(0,r.createSubmitButtonForGroup)(c);l.append(u),null==e&&window.setTimeout((function(){(0,s.items)(i.shared,(function(e,t){(0,s.items)(t,(function(e,t){t.reflow&&t.reflow()}))}))}),800)}}))}},452:function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.applyPolyfills=void 0,t.applyPolyfills=function(){Array.prototype.forEach||(Array.prototype.forEach=function(e,t){if("function"!=typeof e)throw new TypeError(e+" is not a function");var n=this;t=t||this;for(var r=0,a=n.length;r!==a;++r)e.call(t,n[r],r,n)}),Array.prototype.map||(Array.prototype.map=function(e){if("function"!=typeof e)throw new TypeError(e+" is not a function");for(var t=[],n=0;n<this.length;n++)t.push(e(this[n],n,this));return t}),Array.prototype.filter||(Array.prototype.filter=function(e){if("function"!=typeof e)throw new TypeError(e+" is not a function");for(var t=[],n=0;n<this.length;n++)e.call(this,this[n],n,this)&&t.push(this[n]);return t}),Array.isArray||(Array.isArray=function(e){return"[object Array]"===Object.prototype.toString.call(e)}),"function"!=typeof Number.isNaN||(Number.isNaN=function(e){return null!==e&&(e!=e||+e!=e)})}},316:function(e,t){function n(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}Object.defineProperty(t,"__esModule",{value:!0}),t.SeqBasic=void 0;var r=function(){function e(t){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.lpygens=t}var t,r,a;return t=e,(r=[{key:"next",value:function(){return this.lpygens[0]}}])&&n(t.prototype,r),a&&n(t,a),Object.defineProperty(t,"prototype",{writable:!1}),e}();t.SeqBasic=r},970:function(e,t,n){function r(e){return r="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},r(e)}function a(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function i(e,t){return i=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(e,t){return e.__proto__=t,e},i(e,t)}function o(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=l(e);if(t){var a=l(this).constructor;n=Reflect.construct(r,arguments,a)}else n=r.apply(this,arguments);return s(this,n)}}function s(e,t){if(t&&("object"===r(t)||"function"==typeof t))return t;if(void 0!==t)throw new TypeError("Derived constructors may only return object or undefined");return function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e)}function l(e){return l=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(e){return e.__proto__||Object.getPrototypeOf(e)},l(e)}Object.defineProperty(t,"__esModule",{value:!0}),t.SeqRandomWeighted=void 0;var c=n(830),u=function(e){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&i(e,t)}(l,e);var t,n,r,s=o(l);function l(e,t){var n;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,l),n=s.call(this,e),t=(t||"random").trim().toLowerCase(),n.definition=t;var r=[];if(t.startsWith("weighted:")){var a=(t=t.replace("weighted:","")).split(",");r=a.map((function(e){return parseFloat(e)}))}else for(var i=1/e.length,o=0,u=e.length;o<u;o++)r.push(i);if(n.lpygens=e,n.lpygens.length>r.length)for(;n.lpygens!=r.length;)r.push(1);for(;r.length>e.length;)r.pop();var p=(0,c.sum)(r),f=0;return r.forEach((function(e,t){f=(e/=p)+f,r[t]=f})),n.weights=r,n}return t=l,(n=[{key:"next",value:function(){if("random"==this.definition){var e=Math.floor(Math.random()*this.lpygens.length);return this.lpygens[e]}for(var t=Math.random(),n=0,r=this.weights[n];r<t;)n+=1,r=this.weights[n];return this.lpygens[n]}}])&&a(t.prototype,n),r&&a(t,r),Object.defineProperty(t,"prototype",{writable:!1}),l}(n(316).SeqBasic);t.SeqRandomWeighted=u},831:function(e,t,n){function r(e){return r="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},r(e)}function a(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function i(e,t){return i=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(e,t){return e.__proto__=t,e},i(e,t)}function o(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=c(e);if(t){var a=c(this).constructor;n=Reflect.construct(r,arguments,a)}else n=r.apply(this,arguments);return s(this,n)}}function s(e,t){if(t&&("object"===r(t)||"function"==typeof t))return t;if(void 0!==t)throw new TypeError("Derived constructors may only return object or undefined");return l(e)}function l(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function c(e){return c=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(e){return e.__proto__||Object.getPrototypeOf(e)},c(e)}Object.defineProperty(t,"__esModule",{value:!0}),t.SeqSequence=void 0;var u=n(830),p=n(316),f=n(970),d=function(e){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&i(e,t)}(c,e);var t,n,r,s=o(c);function c(e,t){var n;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,c),(n=s.call(this,e)).lpygens=e,t=t.replace("sequence:","").trim().toLowerCase(),n.positions=[],n.terminalGen=void 0;var r=t.split(","),a=l(n);return r.forEach((function(t,n){if((0,u.isNumeric)(t)&&null==a.terminalGen)for(var i=parseInt(t),o=0;o<i;o++)a.positions.push(n);else if(t.startsWith("*")&&null==a.terminalGen){for(var s=e.slice(n),l=[],c=!1,p=n;p<r.length;p++){var d=r[p];d.indexOf("*")>=0&&d.indexOf("(")>0?(d=d.replace("*","").replace("(","").replace(")",""),l.push(parseFloat(d)),c=!0):l.push(1)}var h="random";c&&(h="weighted: "+l.join(",")),a.terminalGen=new f.SeqRandomWeighted(s,h)}})),n.pointer=0,n}return t=c,(n=[{key:"next",value:function(){if(this.pointer>=this.positions.length&&this.terminalGen)return this.terminalGen.next();this.pointer=this.pointer%this.positions.length;var e=this.positions[this.pointer];return this.pointer+=1,this.lpygens[e]}}])&&a(t.prototype,n),r&&a(t,r),Object.defineProperty(t,"prototype",{writable:!1}),c}(p.SeqBasic);t.SeqSequence=d},830:function(e,t){function n(e,t,n,r,a,i){return s(function(e,t){return e<<t|e>>>32-t}(s(s(t,e),s(r,i)),a),n)}function r(e,t,r,a,i,o,s){return n(t&r|~t&a,e,t,i,o,s)}function a(e,t,r,a,i,o,s){return n(t&a|r&~a,e,t,i,o,s)}function i(e,t,r,a,i,o,s){return n(t^r^a,e,t,i,o,s)}function o(e,t,r,a,i,o,s){return n(r^(t|~a),e,t,i,o,s)}function s(e,t){var n=(65535&e)+(65535&t);return(e>>16)+(t>>16)+(n>>16)<<16|65535&n}Object.defineProperty(t,"__esModule",{value:!0}),t.isNumeric=t.createLinkSheet=t.createStyleSheet=t.insertScript=t.MD5=t.copyPropsFromTo=t.hasValue=t.items=t.sum=t.sanitizeLaTeX=t.reflowLatex=void 0,t.reflowLatex=function(){window.MathJax&&(window.MathJax.typesetPromise&&window.MathJax.typesetPromise(),window.MathJax.Hub&&window.MathJax.Hub.Queue&&window.MathJax.Hub.Queue(["Typeset",MathJax.Hub]))},t.sanitizeLaTeX=function(e){return e.replace(/·/g,"*")},t.sum=function(e){for(var t=0,n=0,r=e.length;n<r;n++)t+=e[n];return t},t.items=function(e,t){if(Array.isArray(e))for(var n=0,r=e.length;n<r;n++)t(n,e[n]);else{var a=Object.keys(e);for(n=0,r=a.length;n<r;n++){var i=a[n];t(i,e[i])}}},t.hasValue=function(e,t){for(var n=!1,r=Object.keys(e),a=0;!n&&a<r.length;){n=e[r[a]]==t,a++}return n},t.copyPropsFromTo=function(e,t){for(var n=Object.keys(e),r=0,a=n.length;r<a;r++){var i=n[r];t[i]=e[i]}},t.MD5=function(e){var t=function(e){for(var t,n="0123456789ABCDEF",r="",a=0;a<e.length;a++)t=e.charCodeAt(a),r+=n.charAt(t>>>4&15)+n.charAt(15&t);return r}(function(e){for(var t="",n=0;n<32*e.length;n+=8)t+=String.fromCharCode(e[n>>5]>>>n%32&255);return t}(function(e,t){e[t>>5]|=128<<t%32,e[14+(t+64>>>9<<4)]=t;for(var n=1732584193,l=-271733879,c=-1732584194,u=271733878,p=0;p<e.length;p+=16){var f=n,d=l,h=c,y=u;l=o(l=o(l=o(l=o(l=i(l=i(l=i(l=i(l=a(l=a(l=a(l=a(l=r(l=r(l=r(l=r(l,c=r(c,u=r(u,n=r(n,l,c,u,e[p+0],7,-680876936),l,c,e[p+1],12,-389564586),n,l,e[p+2],17,606105819),u,n,e[p+3],22,-1044525330),c=r(c,u=r(u,n=r(n,l,c,u,e[p+4],7,-176418897),l,c,e[p+5],12,1200080426),n,l,e[p+6],17,-1473231341),u,n,e[p+7],22,-45705983),c=r(c,u=r(u,n=r(n,l,c,u,e[p+8],7,1770035416),l,c,e[p+9],12,-1958414417),n,l,e[p+10],17,-42063),u,n,e[p+11],22,-1990404162),c=r(c,u=r(u,n=r(n,l,c,u,e[p+12],7,1804603682),l,c,e[p+13],12,-40341101),n,l,e[p+14],17,-1502002290),u,n,e[p+15],22,1236535329),c=a(c,u=a(u,n=a(n,l,c,u,e[p+1],5,-165796510),l,c,e[p+6],9,-1069501632),n,l,e[p+11],14,643717713),u,n,e[p+0],20,-373897302),c=a(c,u=a(u,n=a(n,l,c,u,e[p+5],5,-701558691),l,c,e[p+10],9,38016083),n,l,e[p+15],14,-660478335),u,n,e[p+4],20,-405537848),c=a(c,u=a(u,n=a(n,l,c,u,e[p+9],5,568446438),l,c,e[p+14],9,-1019803690),n,l,e[p+3],14,-187363961),u,n,e[p+8],20,1163531501),c=a(c,u=a(u,n=a(n,l,c,u,e[p+13],5,-1444681467),l,c,e[p+2],9,-51403784),n,l,e[p+7],14,1735328473),u,n,e[p+12],20,-1926607734),c=i(c,u=i(u,n=i(n,l,c,u,e[p+5],4,-378558),l,c,e[p+8],11,-2022574463),n,l,e[p+11],16,1839030562),u,n,e[p+14],23,-35309556),c=i(c,u=i(u,n=i(n,l,c,u,e[p+1],4,-1530992060),l,c,e[p+4],11,1272893353),n,l,e[p+7],16,-155497632),u,n,e[p+10],23,-1094730640),c=i(c,u=i(u,n=i(n,l,c,u,e[p+13],4,681279174),l,c,e[p+0],11,-358537222),n,l,e[p+3],16,-722521979),u,n,e[p+6],23,76029189),c=i(c,u=i(u,n=i(n,l,c,u,e[p+9],4,-640364487),l,c,e[p+12],11,-421815835),n,l,e[p+15],16,530742520),u,n,e[p+2],23,-995338651),c=o(c,u=o(u,n=o(n,l,c,u,e[p+0],6,-198630844),l,c,e[p+7],10,1126891415),n,l,e[p+14],15,-1416354905),u,n,e[p+5],21,-57434055),c=o(c,u=o(u,n=o(n,l,c,u,e[p+12],6,1700485571),l,c,e[p+3],10,-1894986606),n,l,e[p+10],15,-1051523),u,n,e[p+1],21,-2054922799),c=o(c,u=o(u,n=o(n,l,c,u,e[p+8],6,1873313359),l,c,e[p+15],10,-30611744),n,l,e[p+6],15,-1560198380),u,n,e[p+13],21,1309151649),c=o(c,u=o(u,n=o(n,l,c,u,e[p+4],6,-145523070),l,c,e[p+11],10,-1120210379),n,l,e[p+2],15,718787259),u,n,e[p+9],21,-343485551),n=s(n,f),l=s(l,d),c=s(c,h),u=s(u,y)}return Array(n,l,c,u)}(function(e){for(var t=Array(e.length>>2),n=0;n<t.length;n++)t[n]=0;for(n=0;n<8*e.length;n+=8)t[n>>5]|=(255&e.charCodeAt(n/8))<<n%32;return t}(e),8*e.length)));return t.toLowerCase()},t.insertScript=function(e,t){var n=document.createElement("script");n.src=e,n.type="text/javascript",n.async=!0,document.head.appendChild(n),t&&(n.async=!0,n.onload=function(){t()})},t.createStyleSheet=function(e,t){if(!t||!document.getElementById(t)){var n=document.createElement("style");n.innerHTML=e,t&&(n.id=t),document.getElementsByTagName("head")[0].appendChild(n)}},t.createLinkSheet=function(e,t){var n=document.createElement("link");n.rel="stylesheet",n.type="text/css",n.href=e,document.getElementsByTagName("head")[0].appendChild(n)},t.isNumeric=function(e){return null!=(e||"").replace(/\s+/g,"").match(/^[+\-]?[0-9]+\.?[0-9]*$/)}}},t={};function n(r){var a=t[r];if(void 0!==a)return a.exports;var i=t[r]={exports:{}};return e[r].call(i.exports,i,i.exports,n),i.exports}!function(){var e=n(452),t=n(66),r=n(830),a=n(216),i=n(657);(0,e.applyPolyfills)(),window.MQWidgets={reflow:function(){(0,a.findQuillGroups)(),(0,i.findPyGenerators)()}};var o=function(){window.MQWidgets.reflow()};$((function(){(0,r.createLinkSheet)(t.cfg.BASE_URL+"/mqwidgets2.css"),(0,r.insertScript)(t.cfg.BASE_URL+"/lib/mathquill.matrix.min.js",o)}))}()}();
//# sourceMappingURL=mqwidgets2.js.map