{"version":3,"file":"mqwidgets2.js","mappings":"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","sources":["webpack:///./src/I18n.ts","webpack:///./src/actions.ts","webpack:///./src/checking.ts","webpack:///./src/components/LevelIndicator.ts","webpack:///./src/components/dialogs/dialog.ts","webpack:///./src/components/dialogs/editorDialog.ts","webpack:///./src/components/editorBase.ts","webpack:///./src/components/editorCloze.ts","webpack:///./src/components/editorInput.ts","webpack:///./src/components/editorMChoice.ts","webpack:///./src/components/editorMChoiceCheckbox.ts","webpack:///./src/components/editorPanel.ts","webpack:///./src/components/toolbar/createToolbarButton.ts","webpack:///./src/components/toolbar/pwTabMenu.ts","webpack:///./src/components/toolbar/toolbar-config.ts","webpack:///./src/createQuill.ts","webpack:///./src/engines/engineCAS.ts","webpack:///./src/engines/nerdamerCAS.ts","webpack:///./src/engines/parseLatex.ts","webpack:///./src/engines/sympyCAS.ts","webpack:///./src/findPyGenerators.ts","webpack:///./src/globals.ts","webpack:///./src/goalChecker.ts","webpack:///./src/mq-parsing.ts","webpack:///./src/mqfy.ts","webpack:///./src/polyfills.ts","webpack:///./src/sequences/seqBasic.ts","webpack:///./src/sequences/seqRandomWeighted.ts","webpack:///./src/sequences/seqSequence.ts","webpack:///./src/utils.ts","webpack:///webpack/bootstrap","webpack:///./src/index.ts"],"sourcesContent":["\"use strict\";\nObject.defineProperty(exports, \"__esModule\", { value: true });\nexports.I18n = void 0;\nconst globals_1 = require(\"./globals\");\nconst TRANSLATIONS = {\n    ca: {\n        'check': 'Comprova',\n        \"General\": 'General',\n        \"Símbols\": \"Símbols\",\n        \"Geometria\": \"Geometria\",\n        \"Intervals\": \"Intervals\",\n        \"Funcions\": \"Funcions\",\n        \"right_answer\": \"Resposta correcta\",\n        \"close\": \"Tancar\",\n        \"open_editor\": \"Obrir l'editor\",\n        \"show_answer\": \"Mostra la solució\",\n        \"choose_option\": \"Tria una opció\",\n        \"next\": \"Següent\",\n        \"goal_reached\": \"Repte aconseguit!\",\n        \"wildcard\": \"Comodí\",\n        \"answer\": \"Solució\",\n        \"matheditor\": \"Editor matemàtic\",\n        \"accept\": \"Acceptar\",\n        \"cancel\": \"Cancel·lar\",\n        \"expected_ans\": \"S'esperava la resposta\",\n        \"error_verifying\": \"Ho sentim però hi ha hagut un problema a l'hora de verificar la resposta.\",\n        \"wrong_answer\": \"Resposta incorrecta. Intentau de nou.\",\n        \"sym_notallowed\": \"No es permet el símbol <b>${1}</b> en la resposta.\",\n        \"sym_once\": \"El símbol <b>${1}</b> només es pot emprar com a màxim una vegada en la resposta.\",\n        \"error_cantprocess\": \"Error: Hi ha respostes donades que no es poden processar. Provau d'eliminar els espais en blanc.\",\n        \"ans_missing\": \"Falten respostes\"\n    },\n    es: {\n        'check': 'Comprueba',\n        \"General\": 'General',\n        \"Símbols\": \"Símbolos\",\n        \"Geometria\": \"Geometria\",\n        \"Intervals\": \"Intervalos\",\n        \"Funcions\": \"Funciones\",\n        \"right_answer\": \"Respuesta correcta\",\n        \"close\": \"Cerrar\",\n        \"open_editor\": \"Abrir el editor\",\n        \"show_answer\": \"Muestra la solución\",\n        \"choose_option\": \"Elige una opción\",\n        \"next\": \"Siguiente\",\n        \"goal_reached\": \"¡Reto conseguido!\",\n        \"wildcard\": \"Comodín\",\n        \"answer\": \"Solución\",\n        \"matheditor\": \"Editor matemático\",\n        \"accept\": \"Aceptar\",\n        \"cancel\": \"Cancelar\",\n        \"expected_ans\": \"Se esperaba la respuesta\",\n        \"error_verifying\": \"Lo sentimos, ha habido un problema cuando se verificaba la respuesta.\",\n        \"wrong_answer\": \"Respuesta incorrecta. Inténtalo de nuevo.\",\n        \"sym_notallowed\": \"No se permite el símbolo <b>${1}</b> en la respuesta.\",\n        \"sym_once\": \"El símbolo <b>${1}</b> solo es puede emplear una vez como máximo en la respuesta.\",\n        \"error_cantprocess\": \"Error: Hay respuestas que no se pueden procesar. Intente eliminar los espacios en blanco.\",\n        \"ans_missing\": \"Faltan respuestas\"\n    },\n    en: {\n        'check': 'Check',\n        \"General\": 'General',\n        \"Símbols\": \"Symbols\",\n        \"Geometria\": \"Geometry\",\n        \"Intervals\": \"Intervals\",\n        \"Funcions\": \"Functions\",\n        \"right_answer\": \"Right answer\",\n        \"close\": \"Close\",\n        \"open_editor\": \"Open the editor\",\n        \"show_answer\": \"Show the answer\",\n        \"choose_option\": \"Choose an option\",\n        \"next\": \"Next\",\n        \"goal_reached\": \"Goal acomplished!\",\n        \"wildcard\": \"Wildcard\",\n        \"answer\": \"Answer\",\n        \"matheditor\": \"Math editor\",\n        \"accept\": \"Accept\",\n        \"cancel\": \"Cancel\",\n        \"expected_ans\": \"The expected answer is\",\n        \"error_verifying\": \"We are sorry. There has been a problem while verifying the answer.\",\n        \"wrong_answer\": \"Wrong answer. Try it again.\",\n        \"sym_notallowed\": \"The symbol <b>${1}</b> is not allowed in the answer.\",\n        \"sym_once\": \"The symbol <b>${1}</b> can only be used once in the answer.\",\n        \"error_cantprocess\": \"Error: There are some answers that can't be processed. Try removing white spaces.\",\n        \"ans_missing\": \"There are some blank answers\"\n    }\n};\n// https://raw.githubusercontent.com/wiziple/browser-lang/master/src/index.js\nfunction getBrowserLang() {\n    if (typeof window === \"undefined\") {\n        return 'en';\n    }\n    const navigator = window.navigator;\n    let lang = (navigator.languages && navigator.languages[0]) ||\n        navigator.language ||\n        navigator.browserLanguage ||\n        navigator.userLanguage ||\n        navigator.systemLanguage ||\n        'en_US';\n    lang = lang.toLowerCase().replace(/-/, \"_\");\n    return lang.toLowerCase().split(\"_\")[0];\n}\nconst BROWSER_LANG = getBrowserLang();\nfunction I18n(key, ...args) {\n    const lang = globals_1.cfg.LANG || BROWSER_LANG;\n    let langPack = TRANSLATIONS[lang];\n    if (!langPack) {\n        //Unknown language - use fallback english\n        console.error(\"Cannot find translations in \", lang, \". Using fallback [en]\");\n        langPack = TRANSLATIONS['en'];\n    }\n    // check if it must interpolate some var\n    let out = langPack[key] || key || '';\n    for (let i = 0; i < args.length; i++) {\n        out = out.replace('${' + (i + 1) + '}', args[i]);\n    }\n    return out;\n}\nexports.I18n = I18n;\n","\"use strict\";\nObject.defineProperty(exports, \"__esModule\", { value: true });\nexports.createSubmitButtonForGroup = exports.bindSubmitActionButton = void 0;\nconst checking_1 = require(\"./checking\");\nconst globals_1 = require(\"./globals\");\nconst I18n_1 = require(\"./I18n\");\nconst engineCAS_1 = require(\"./engines/engineCAS\");\nconst utils_1 = require(\"./utils\");\nlet LAST_AJAX = new Date().getTime();\n/**\n * Binds the submit button for all the editors within a group\n * @param gid\n * @param check_btn\n * @param extraActions\n */\nfunction bindSubmitActionButton(gid, check_btn, extraActions) {\n    var groupContainer = globals_1.shared[gid];\n    var qids = Object.keys(groupContainer).map((e) => parseInt(e));\n    check_btn.off();\n    check_btn.on('click', function (ev) {\n        ev.preventDefault();\n        var now = (new Date()).getTime();\n        if (LAST_AJAX && (now - LAST_AJAX) < 1000) {\n            console.error(\"Too frequently checks are blocked!\");\n            return;\n        }\n        console.log(\"gid\", gid, \"qids\", qids);\n        for (var k = 0, len = qids.length; k < len; k++) {\n            var qid = qids[k];\n            var editor = groupContainer[qid];\n            if (editor.getStatus() != globals_1.cfg.STATUS.MODIFIED) {\n                // no changes to check\n                console.log('Unmodified, nothing to check');\n                continue;\n            }\n            var ual = editor.latex() || [];\n            if (ual.length === 0 || (0, checking_1.has_empty_answers)(ual)) {\n                // contains empty answers\n                editor.checkMsg(-1, (0, I18n_1.I18n)('ans_missing'));\n                console.error('Editor contains empty answers');\n                continue;\n            }\n            if (editor.getStatus() != 1 && ual.length) {\n                console.log(editor);\n                if (editor.getDefinition().right_answer && editor.getWrong_attemps() > globals_1.cfg.MAX_ATTEMPTS) {\n                    console.log(\"TODO:: Must show right answer and disable quill\");\n                    if (!editor.isPigen()) {\n                        // showAnswer must disable quill on its editor\n                        // Disable on panel which is not standalone\n                        editor.showAnswer();\n                        continue;\n                    }\n                }\n                // If the widget is a multiplechoice combo\n                // TODO: support multiple answers, ans is an array and ual too!\n                if (editor.getQType() == globals_1.cfg.QTYPES.M || editor.getQType() == globals_1.cfg.QTYPES.Ms) {\n                    var score10 = editor.isComodiUsed() ? 5 : 10;\n                    if (editor.getDefinition().ans == ual[0]) {\n                        editor.checkMsg(1, 'Molt bé!');\n                    }\n                    else {\n                        score10 = 0;\n                        editor.increment_wrong();\n                        editor.checkMsg(0, 'Incorrecte');\n                    }\n                    extraActions && extraActions(score10);\n                    continue;\n                }\n                LAST_AJAX = now;\n                const postObj = { latex: ual, qid: qid };\n                // Optimitzation (numeric answers can be checked locally)\n                // console.log(\"Locally? \", editor.getDefinition(), ual);\n                let ans = '';\n                if (editor.getDefinition().anse != null) {\n                    ans = atob(editor.getDefinition().anse || \"\");\n                }\n                else {\n                    ans = editor.getDefinition().ans || '';\n                }\n                if (ans && ual.length == 1) {\n                    //User answer list of one item\n                    if ((0, utils_1.isNumeric)(ual[0]) && (0, utils_1.isNumeric)(ans)) {\n                        const pfual = parseFloat(ual[0]);\n                        const pans = parseFloat(ans);\n                        console.log(\"Numeric answer can be checked locally\");\n                        var score10 = editor.isComodiUsed() ? 5 : 10;\n                        var difference = parseFloat(ans) - pfual;\n                        //TODO:: Check for precisions\n                        var maxError = 0.0;\n                        if (editor.getDefinition().rules && editor.getDefinition().rules.precision) {\n                            maxError = editor.getDefinition().rules.precision;\n                        }\n                        if (Math.abs(difference) <= maxError) {\n                            editor.checkMsg(1, 'Molt bé!');\n                        }\n                        else {\n                            score10 = 0;\n                            editor.increment_wrong();\n                            editor.checkMsg(0, 'Incorrecte');\n                        }\n                        extraActions && extraActions(score10);\n                        continue;\n                    }\n                }\n                //copy properties from object definition\n                (0, utils_1.copyPropsFromTo)(editor.getDefinition(), postObj);\n                if (globals_1.cfg.pageInfo) {\n                    postObj.pageInfo = globals_1.cfg.pageInfo;\n                    if (!editor.getHash()) {\n                        editor.setHash((0, utils_1.MD5)(postObj.formulation + '_' + (postObj.pageInfo.bookId || 0) + '_' + (postObj.pageInfo.chapterId || 0)));\n                    }\n                    postObj.hash = editor.getHash();\n                }\n                //Decide which engine to use based on the payload\n                engineCAS_1.engineCAS.compare(postObj).then((datos) => {\n                    console.log(\"success\", datos);\n                    var editor = groupContainer[datos.qid];\n                    if (datos.correct == 0) {\n                        editor.increment_wrong();\n                    }\n                    editor.checkMsg(datos.correct, datos.msg);\n                    var score10 = datos.correct ? (editor.isComodiUsed() ? 5 : 10) : 0;\n                    extraActions && extraActions(score10);\n                }, (errors) => {\n                    console.error(\"Error\", errors);\n                });\n            }\n        } // end loop\n    });\n}\nexports.bindSubmitActionButton = bindSubmitActionButton;\n;\nfunction createSubmitButtonForGroup(gid) {\n    var check_btn = $(`<button class=\"btn btn-sm btn-primary pw-me-submitgroup\"><i class=\"fas fa-check\"></i> ${(0, I18n_1.I18n)('check')}</button>`);\n    bindSubmitActionButton(gid, check_btn);\n    return check_btn;\n}\nexports.createSubmitButtonForGroup = createSubmitButtonForGroup;\n;\n","\"use strict\";\nObject.defineProperty(exports, \"__esModule\", { value: true });\nexports.has_empty_answers = exports.extractMatrices = void 0;\nconst regexMatrices = /\\\\begin{pmatrix}(.*?)\\\\end{pmatrix}/g;\nfunction extractMatrices(tex) {\n    const matrices = [];\n    let m = null;\n    while ((m = regexMatrices.exec(tex)) !== null) {\n        const mat = [];\n        const linies = m[1].split('\\\\\\\\');\n        linies.forEach(function (alinia) {\n            const linia = alinia.split('&');\n            mat.push(linia);\n        });\n        matrices.push(mat);\n    }\n    return matrices;\n}\nexports.extractMatrices = extractMatrices;\n;\nconst has_empty_elements = function (matrix) {\n    const rows = matrix.length;\n    for (let i = 0; i < rows; i++) {\n        const arow = matrix[i];\n        const cols = arow.length;\n        for (let j = 0; j < cols; j++) {\n            if (!arow[j]) {\n                return true;\n            }\n        }\n    }\n    return false;\n};\nfunction has_empty_answers(v) {\n    for (let i = 0, len = v.length; i < len; i++) {\n        const tex = v[i];\n        if (tex == '' || (tex && !tex.trim())) {\n            return true;\n        }\n        // a matrix with empty answers\n        const matrices = extractMatrices(tex);\n        for (let j = 0, lenmat = matrices.length; j < lenmat; j++) {\n            if (has_empty_elements(matrices[j])) {\n                return true;\n            }\n        }\n    }\n    return false;\n}\nexports.has_empty_answers = has_empty_answers;\n;\n","\"use strict\";\nObject.defineProperty(exports, \"__esModule\", { value: true });\nexports.LevelIndicator = void 0;\nclass LevelIndicator {\n    constructor(numLevels) {\n        this.numLevels = numLevels;\n        this.container = $('<div style=\"display:inline-block;font-size:90%;\" data-toggle=\"tooltip\"></div>');\n        this.levelIcons = [];\n        for (let i = 0; i < numLevels; i++) {\n            const elem = $('<i class=\"fas fa-pepper-hot\" style=\"color:lightgray;\"></i>');\n            this.container.append(elem);\n            this.levelIcons.push(elem);\n        }\n    }\n    get $div() {\n        return this.container;\n    }\n    setLevel(n) {\n        if (n < 0) {\n            n = 0;\n        }\n        else if (n > this.numLevels) {\n            n = this.numLevels;\n        }\n        for (let i = 0; i < this.numLevels; i++) {\n            if (i < n) {\n                this.levelIcons[i].css(\"color\", \"darkred\");\n            }\n            else {\n                this.levelIcons[i].css(\"color\", \"lightgray\");\n            }\n        }\n        this.container.attr(\"data-original-title\", \"Nivell \" + n);\n        this.container.removeAttr(\"title\");\n    }\n    setVisible(visible) {\n        this.container.css(\"display\", visible ? \"\" : \"none\");\n    }\n}\nexports.LevelIndicator = LevelIndicator;\n","\"use strict\";\n/**\n     * Creates a basic dialog which can be extended for further functionality\n     * @param {*} title\n     * @param {*} width\n     * @param {*} height\n*/\nObject.defineProperty(exports, \"__esModule\", { value: true });\nexports.PwDialog = void 0;\nclass PwDialog {\n    constructor(title, width, height) {\n        this.id = \"pwdlg_\" + Math.random().toString(32).substring(2);\n        this.window = $('<div id=\"' + this.id + '\" class=\"pw-me-dlg\" style=\"width:' + width + 'px;height:' + height + 'px;display:none;\"></div>');\n        const topBar = $('<div class=\"pw-me-dlg-header\"></div>');\n        this.topBar = topBar;\n        const headerTitle = $('<span class=\"pw-me-dlg-headertitle\">' + title + '</span>');\n        this.closeBtn = $('<button class=\"btn btn-sm pw-me-btn-dlgclose\" title=\"Tancar\"><i class=\"fas fa-times\"></i></button>');\n        const self = this;\n        this.closeBtn.on(\"click\", function (ev) {\n            ev.preventDefault();\n            self.window.css(\"display\", \"none\");\n        });\n        topBar.append(headerTitle);\n        topBar.append(this.closeBtn);\n        this.window.append(topBar);\n        //Add dialog to body\n        $('body').append(this.window);\n        // Make this dialog draggable\n        let active = false;\n        let currentX;\n        let currentY;\n        let initialX;\n        let initialY;\n        let xOffset = 0;\n        let yOffset = 0;\n        this.dragStart = function (e) {\n            if (e.type === \"touchstart\") {\n                initialX = e.touches[0].clientX - xOffset;\n                initialY = e.touches[0].clientY - yOffset;\n            }\n            else {\n                initialX = e.clientX - xOffset;\n                initialY = e.clientY - yOffset;\n            }\n            if (e.target === topBar[0]) {\n                active = true;\n            }\n        };\n        this.dragEnd = function (e) {\n            initialX = currentX;\n            initialY = currentY;\n            active = false;\n        };\n        this.setTranslate = function (xPos, yPos, el) {\n            el.style.transform = \"translate3d(\" + xPos + \"px, \" + yPos + \"px, 0)\";\n        };\n        this.drag = function (e) {\n            if (active) {\n                e.preventDefault();\n                if (e.type === \"touchmove\") {\n                    currentX = e.touches[0].clientX - initialX;\n                    currentY = e.touches[0].clientY - initialY;\n                }\n                else {\n                    currentX = e.clientX - initialX;\n                    currentY = e.clientY - initialY;\n                }\n                xOffset = currentX;\n                yOffset = currentY;\n                self.setTranslate(currentX, currentY, self.window[0]);\n            }\n        };\n        topBar[0].addEventListener(\"touchstart\", this.dragStart, false);\n        topBar[0].addEventListener(\"touchend\", this.dragEnd, false);\n        topBar[0].addEventListener(\"touchmove\", this.drag, false);\n        topBar[0].addEventListener(\"mousedown\", this.dragStart, false);\n        topBar[0].addEventListener(\"mouseup\", this.dragEnd, false);\n        topBar[0].addEventListener(\"mousemove\", this.drag, false);\n    }\n    append(element) {\n        this.window.append(element);\n    }\n    show() {\n        this.window.css(\"display\", \"initial\");\n    }\n    close() {\n        this.window.css(\"display\", \"none\");\n    }\n    remove() {\n        this.closeBtn.off();\n        this.window.remove();\n        this.topBar[0].removeEventListener(\"touchstart\", this.dragStart);\n        this.topBar[0].removeEventListener(\"touchend\", this.dragEnd);\n        this.topBar[0].removeEventListener(\"touchmove\", this.drag);\n        this.topBar[0].removeEventListener(\"mousedown\", this.dragStart);\n        this.topBar[0].removeEventListener(\"mouseup\", this.dragEnd);\n        this.topBar[0].removeEventListener(\"mousemove\", this.drag);\n    }\n    dispose() {\n        this.remove();\n    }\n}\nexports.PwDialog = PwDialog;\n;\n","\"use strict\";\n// Editor panel (embeded in dialog)\n// Extends Dialog\nObject.defineProperty(exports, \"__esModule\", { value: true });\nexports.EditorDialog = void 0;\nconst globals_1 = require(\"../../globals\");\nconst I18n_1 = require(\"../../I18n\");\nconst utils_1 = require(\"../../utils\");\nconst editorPanel_1 = require(\"../editorPanel\");\nconst dialog_1 = require(\"./dialog\");\n// Composes EditorPanel\nclass EditorDialog extends dialog_1.PwDialog {\n    constructor() {\n        super('<i style=\"color:darkred;\" class=\"fas fa-square-root-alt\"></i> ' + (0, I18n_1.I18n)('matheditor'), 500, 320);\n        const self = this;\n        const gid = 'gid_' + Math.random().toString(32).substring(2);\n        const qtype = globals_1.cfg.QTYPES.P;\n        const def = {};\n        this.editorPanel = new editorPanel_1.EditorPanel(this.window, gid, def, qtype, false);\n        var controlButtons = $('<div class=\"pw-me-dlg-controls\"></div>');\n        var acceptBtn = $('<button class=\"btn btn-sm btn-primary\">' + (0, I18n_1.I18n)('accept') + '</button>');\n        var cancelBtn = $('<button class=\"btn btn-sm btn-outline-primary\">' + (0, I18n_1.I18n)('cancel') + '</button>');\n        controlButtons.append(acceptBtn);\n        controlButtons.append(cancelBtn);\n        this.append(controlButtons);\n        acceptBtn.on('click', function (ev) {\n            ev.preventDefault();\n            if (self.acceptFn) {\n                self.acceptFn(self);\n            }\n            self.close();\n        });\n        cancelBtn.on('click', function (ev) {\n            ev.preventDefault();\n            if (self.cancelFn) {\n                self.cancelFn(self);\n            }\n            self.close();\n        });\n    }\n    latex(tex) {\n        if (tex != null) {\n            this.editorPanel.latex(tex);\n            return [''];\n        }\n        else {\n            return this.editorPanel.latex().map((e) => (0, utils_1.sanitizeLaTeX)(e));\n        }\n    }\n    //@override\n    show() {\n        this.window.css(\"display\", \"\");\n        this.editorPanel.focus();\n    }\n    //@override\n    dispose() {\n        this.editorPanel.dispose();\n        this.window.find('button').off();\n        this.dispose();\n    }\n    reflow() {\n        this.editorPanel.reflow();\n    }\n    setDefinition(def) {\n        this.editorPanel.setDefinition(def);\n    }\n}\nexports.EditorDialog = EditorDialog;\n","\"use strict\";\nObject.defineProperty(exports, \"__esModule\", { value: true });\nexports.EditorBase = void 0;\nconst globals_1 = require(\"../globals\");\nclass EditorBase {\n    constructor(parent, gid, def, qtype) {\n        this.parent = parent;\n        this.gid = gid;\n        this.status = globals_1.cfg.STATUS.UNMODIFIED;\n        this.wrong_attemps = 0;\n        this.isAnswerShown = false;\n        this.def = def;\n        this.qtype = qtype;\n        this.pigen = false;\n        this.comodi = false;\n        this.hash = '';\n    }\n    get_gid() {\n        return this.gid;\n    }\n    setDefinition(def) {\n        this.def = def;\n        this.ansType = def.ansType;\n    }\n    getDefinition() {\n        return this.def;\n    }\n    increment_wrong() {\n        this.wrong_attemps += 1;\n    }\n    getWrong_attemps() {\n        return this.wrong_attemps;\n    }\n    getStatus() {\n        return this.status;\n    }\n    setStatus(status) {\n        this.status = status;\n    }\n    getQType() {\n        return this.qtype;\n    }\n    setQType(qtype) {\n        this.qtype = qtype;\n    }\n    isPigen() {\n        return this.pigen;\n    }\n    setPigen(pigen) {\n        this.pigen = pigen;\n    }\n    isComodiUsed() {\n        return this.comodi;\n    }\n    setComodiUsed(comodi) {\n        this.comodi = comodi;\n    }\n    getHash() {\n        return this.hash;\n    }\n    setHash(hash) {\n        this.hash = hash;\n    }\n}\nexports.EditorBase = EditorBase;\n","\"use strict\";\nObject.defineProperty(exports, \"__esModule\", { value: true });\nexports.EditorCloze = void 0;\nconst globals_1 = require(\"../globals\");\nconst I18n_1 = require(\"../I18n\");\nconst utils_1 = require(\"../utils\");\nconst dialog_1 = require(\"./dialogs/dialog\");\nconst editorBase_1 = require(\"./editorBase\");\nclass EditorCloze extends editorBase_1.EditorBase {\n    constructor(parent, gid, def, qtype, ini) {\n        super(parent, gid, def, qtype);\n        const self = this;\n        this.dlg_btn_el = null;\n        this.quill_el_container = $('<div class=\"pw-me-editorinput\"></div>');\n        const quill_el = $('<span>' + ini + '</span>');\n        this.check_el = $('<div class=\"pw-me-check\"></div>');\n        this.parent.append(this.quill_el_container);\n        this.quill_el_container.append(quill_el);\n        this.mathInput = (0, globals_1.StaticMath)(quill_el[0]);\n        // TODO: listen to changes to set status to unmodified\n        this.mathInput.innerFields.forEach(function (e) {\n            e.__controller.textarea.on('keyup', function (ev) {\n                ev.preventDefault();\n                if (self.status != globals_1.cfg.STATUS.MODIFIED) {\n                    self.check_el.html('');\n                    self.status = globals_1.cfg.STATUS.MODIFIED;\n                    self.quill_el_container.removeClass('pw-me-right pw-me-wrong pw-me-alert');\n                }\n            });\n        });\n        this.quill_el_container.append(this.check_el);\n    }\n    clear() {\n        this.mathInput.innerFields.forEach((v) => v.latex(''));\n        this.check_el.html('');\n        this.status = globals_1.cfg.STATUS.UNMODIFIED;\n        this.quill_el_container.removeClass('pw-me-right pw-me-wrong pw-me-alert');\n    }\n    focus() {\n        this.mathInput.focus();\n    }\n    latex(tex) {\n        if (tex != null) {\n            this.mathInput.latex(tex);\n            this.status = globals_1.cfg.STATUS.UNMODIFIED;\n        }\n        else {\n            const parts = [];\n            console.log(this.mathInput.innerFields);\n            const v = this.mathInput.innerFields;\n            for (let i = 0, lenv = v.length; i < lenv; i++) {\n                parts.push(v[i].latex());\n            }\n            return parts;\n        }\n        return [];\n    }\n    checkMsg(status, msg) {\n        this.status = status;\n        let msg2 = '';\n        if (status == 1) {\n            msg2 = '<span data-toggle=\"tooltip\" title=\"' + msg + '\"><i class=\"fas fa-check\"></i></span>';\n            this.quill_el_container.addClass('pw-me-right');\n        }\n        else if (status == 0) {\n            msg2 = '<span data-toggle=\"tooltip\" title=\"' + msg + '\"><i class=\"fas fa-times\"></i></span>';\n            this.quill_el_container.addClass('pw-me-wrong');\n        }\n        else {\n            msg2 = '<span data-toggle=\"tooltip\" title=\"' + msg + '\"><i class=\"fas fa-exclamation-triangle\"></i></span>';\n            this.quill_el_container.addClass('pw-me-alert');\n        }\n        this.check_el.html(msg2);\n    }\n    get_qid() {\n        return this.mathInput.id;\n    }\n    dispose() {\n        this.mathInput.revert();\n        this.quill_el_container.find(\"button\").off();\n    }\n    reflow() {\n        this.mathInput.reflow();\n        this.status = globals_1.cfg.STATUS.UNMODIFIED;\n    }\n    showAnswer() {\n        if (!this.def) {\n            console.error(\"Cannot show answer because, def is null\");\n            return;\n        }\n        if (!this.def.right_answer) {\n            console.error(\"Cannot show answer because, \", this.def.right_answer);\n            return;\n        }\n        const self = this;\n        //this.showAnswerBtn = $('<button class=\"btn btn pw-me-btn-showanswer\" data-toggle=\"tooltip\" title=\"Mostrar la solució\"><i class=\"fas fa-question-circle\"></i></button>');\n        //this.quill_el_container.append(this.showAnswerBtn);\n        // Must create a global dialog\n        if (!globals_1.sharedDlg[\"showAnswerDlg\"]) {\n            const dlg = new dialog_1.PwDialog((0, I18n_1.I18n)('right_answer'), 400, 250);\n            globals_1.sharedDlg[\"showAnswerDlg\"] = dlg;\n            const answerHolder = $('<div class=\"pw-answer-holder\"></div>');\n            dlg.append(answerHolder);\n            const closeBtn = $('<button class=\"btn btn-sm btn-primary\" style=\"margin-left: 15px;\">' + (0, I18n_1.I18n)('close') + '</button>');\n            dlg.append(closeBtn);\n            closeBtn.on('click', function (ev) {\n                ev.preventDefault();\n                dlg.close();\n            });\n        }\n        // this.showAnswerBtn.on('click', function(ev){\n        // ev.preventDefault();\n        if (!self.isAnswerShown) {\n            self.isAnswerShown = true;\n            self.status = globals_1.cfg.STATUS.UNMODIFIED;\n            //Disable mathquill\n            //self.quill_blocker.addClass('pw-me-blocker');\n            //Disable edit buttton\n            if (self.dlg_btn_el) {\n                self.dlg_btn_el.prop(\"disabled\", true);\n            }\n        }\n        const dlg = globals_1.sharedDlg[\"showAnswerDlg\"];\n        const answerHolder = dlg.window.find(\".pw-answer-holder\");\n        if (self.def) {\n            answerHolder.html(atob(self.def.right_answer) + '<p><br></p>');\n            (0, utils_1.reflowLatex)();\n            dlg.show();\n        }\n    }\n}\nexports.EditorCloze = EditorCloze;\n","\"use strict\";\nObject.defineProperty(exports, \"__esModule\", { value: true });\nexports.EditorInput = void 0;\nconst engineCAS_1 = require(\"../engines/engineCAS\");\nconst globals_1 = require(\"../globals\");\nconst I18n_1 = require(\"../I18n\");\nconst utils_1 = require(\"../utils\");\nconst dialog_1 = require(\"./dialogs/dialog\");\nconst editorDialog_1 = require(\"./dialogs/editorDialog\");\nconst editorBase_1 = require(\"./editorBase\");\nclass EditorInput extends editorBase_1.EditorBase {\n    constructor(parent, gid, def, qtype) {\n        super(parent, gid, def, qtype);\n        var self = this;\n        this.quill_el_container = $('<div class=\"pw-me-editorinput\"></div>');\n        this.quill_blocker = $('<div></div>');\n        var quill_el = $('<span></span>');\n        this.quill_blocker.append(quill_el);\n        this.check_el = $('<div class=\"pw-me-check\"></div>');\n        this.quill_el_container.append(this.quill_blocker);\n        var isBtn = (qtype === globals_1.cfg.QTYPES.S);\n        this.parent.append(this.quill_el_container);\n        this.mathInput = (0, globals_1.MathField)(quill_el[0], {\n            handlers: {\n                edit: function () {\n                    console.log(\"Edit ev on mathquill \", self.mathInput.latex());\n                    if (self.status != globals_1.cfg.STATUS.MODIFIED) {\n                        self.check_el.html('');\n                        self.status = globals_1.cfg.STATUS.MODIFIED;\n                        self.quill_el_container.removeClass('pw-me-right pw-me-wrong pw-me-alert');\n                    }\n                }\n            }\n        });\n        if (isBtn) {\n            this.dlg_btn_el = $('<button class=\"btn btn-sm pw-me-btn-openeditor\" title=\"' + (0, I18n_1.I18n)('open_editor') + '\"><i class=\"fas fa-square-root-alt\"></i></button>');\n            this.quill_el_container.append(this.dlg_btn_el);\n            this.dlg_btn_el.on(\"click\", function (ev) {\n                ev.preventDefault();\n                // open a editordlg\n                // must do the binding when closing\n                var dlg = globals_1.sharedDlg['editordlg'];\n                if (!dlg) {\n                    dlg = new editorDialog_1.EditorDialog();\n                    globals_1.sharedDlg['editordlg'] = dlg;\n                }\n                dlg.acceptFn = function (self2) {\n                    self.mathInput.latex(self2.latex());\n                };\n                dlg.setDefinition(self.def);\n                dlg.show();\n                dlg.latex(self.mathInput.latex());\n            });\n        }\n        this.quill_el_container.append(this.check_el);\n    }\n    get_qid() {\n        return this.mathInput.id;\n    }\n    clear() {\n        this.mathInput.latex('');\n        this.check_el.html('');\n        this.status = globals_1.cfg.STATUS.UNMODIFIED;\n        this.quill_el_container.removeClass('pw-me-right pw-me-wrong pw-me-alert');\n    }\n    focus() {\n        this.mathInput.focus();\n    }\n    latex(tex) {\n        if (tex != null) {\n            console.log(\"Setting latex \", tex);\n            this.mathInput.latex(tex);\n            this.status = globals_1.cfg.STATUS.UNMODIFIED;\n        }\n        else {\n            return [(0, utils_1.sanitizeLaTeX)(this.mathInput.latex())];\n        }\n        return [];\n    }\n    checkMsg(status, msg) {\n        this.status = status;\n        var msg2 = null;\n        if (status == 1) {\n            msg2 = '<span data-toggle=\"tooltip\" title=\"' + msg + '\"><i class=\"' + globals_1.cfg.RIGHT_ICON + '\"></i></span>';\n            this.quill_el_container.addClass('pw-me-right');\n        }\n        else if (status == 0) {\n            msg2 = '<span data-toggle=\"tooltip\" title=\"' + msg + '\"><i class=\"' + globals_1.cfg.WRONG_ICON + '\"></i></span>';\n            this.quill_el_container.addClass('pw-me-wrong');\n        }\n        else {\n            msg2 = '<span data-toggle=\"tooltip\" title=\"' + msg + '\"><i class=\"fas fa-exclamation-triangle\"></i></span>';\n            this.quill_el_container.addClass('pw-me-alert');\n        }\n        this.check_el.html(msg2);\n    }\n    dispose() {\n        this.mathInput.revert();\n        this.quill_el_container.find(\"button\").off();\n    }\n    showAnswer() {\n        if (!this.def.right_answer) {\n            console.error(\"Cannot show answer because, \", this.def.right_answer);\n            return;\n        }\n        var self = this;\n        //const showAnswerBtn = $('<button class=\"btn btn pw-me-btn-showanswer\" data-toggle=\"tooltip\" title=\"Mostrar la solució\"><i class=\"fas fa-question-circle\"></i></button>') as JQuery<HTMLButtonElement>;\n        //this.quill_el_container.append(showAnswerBtn);\n        // Must create a global dialog\n        if (!globals_1.sharedDlg[\"showAnswerDlg\"]) {\n            var dlg = new dialog_1.PwDialog((0, I18n_1.I18n)('right_answer'), 400, 250);\n            globals_1.sharedDlg[\"showAnswerDlg\"] = dlg;\n            var answerHolder = $('<div class=\"pw-answer-holder\"></div>');\n            dlg.append(answerHolder);\n            var closeBtn = $('<button class=\"btn btn-sm btn-primary\" style=\"margin-left: 15px;\">' + (0, I18n_1.I18n)('close') + '</button>');\n            dlg.append(closeBtn);\n            closeBtn.on('click', function (ev) {\n                ev.preventDefault();\n                dlg.close();\n            });\n        }\n        // showAnswerBtn.on('click', function(ev){\n        //     ev.preventDefault();\n        if (!self.isAnswerShown) {\n            self.isAnswerShown = true;\n            self.status = globals_1.cfg.STATUS.UNMODIFIED;\n            // Disable mathquill\n            self.quill_blocker.addClass('pw-me-blocker');\n            // Disable edit buttton\n            if (self.dlg_btn_el) {\n                self.dlg_btn_el.prop(\"disabled\", true);\n            }\n        }\n        var dlg = globals_1.sharedDlg[\"showAnswerDlg\"];\n        var answerHolder = dlg.window.find(\".pw-answer-holder\");\n        if (self.def) {\n            answerHolder.html(atob(self.def.right_answer) + '<p><br></p>');\n            (0, utils_1.reflowLatex)();\n            dlg.show();\n        }\n        // });\n    }\n    increment_wrong() {\n        console.log(\"increment wrong\", this.wrong_attemps == globals_1.cfg.MAX_ATTEMPTS + 1, !this.pigen);\n        this.wrong_attemps += 1;\n        if (this.wrong_attemps == globals_1.cfg.MAX_ATTEMPTS + 1 && !this.pigen) {\n            console.log(\"creating a rescue\", this.def);\n            // create a button to display answer\n            var rescueBtn = $('<button class=\"btn btn-sm\" title=\"' + (0, I18n_1.I18n)('show_answer') + '\"><i class=\"far fa-question-circle\"></i></button>');\n            var self = this;\n            rescueBtn.on(\"click\", function (evt) {\n                self.showAnswer();\n            });\n            if (!this.def.right_answer) {\n                // Must ask the server to generate a right_answer for us by sending the def object\n                engineCAS_1.engineCAS.getAnswer(this.def).then((datos) => {\n                    if (datos.right_answer && self.def) {\n                        self.def.right_answer = datos.right_answer;\n                        self.quill_el_container.append(rescueBtn);\n                    }\n                    else if (datos.msg) {\n                        console.error(datos.msg);\n                    }\n                }, (errors) => {\n                    console.error(errors);\n                });\n            }\n            else {\n                this.quill_el_container.append(rescueBtn);\n            }\n        }\n    }\n    reflow() {\n        this.mathInput.reflow();\n        this.status = globals_1.cfg.STATUS.UNMODIFIED;\n    }\n}\nexports.EditorInput = EditorInput;\n","\"use strict\";\nObject.defineProperty(exports, \"__esModule\", { value: true });\nexports.EditorMChoice = void 0;\nconst globals_1 = require(\"../globals\");\nconst I18n_1 = require(\"../I18n\");\nconst utils_1 = require(\"../utils\");\nconst editorBase_1 = require(\"./editorBase\");\nclass EditorMChoice extends editorBase_1.EditorBase {\n    constructor(parent, gid, def, qtype, options) {\n        super(parent, gid, def, qtype);\n        if (typeof (options) == 'string') {\n            options = options.split(\";\");\n        }\n        const self = this;\n        this.selectedIndex = '';\n        this.gid = gid;\n        this.qid = Math.floor(Math.random() * 10000) + 10000;\n        this.options = options || [];\n        // status = 0 incorrecte, status = 1 correcte, status < 0 errors \n        this.status = globals_1.cfg.STATUS.UNMODIFIED;\n        this.parent = parent;\n        this.wrong_attemps = 0;\n        this.quill_el_container = $('<div class=\"pw-me-mchoice\"></div>');\n        this.check_el = $('<div class=\"pw-me-check\"></div>');\n        const btn_group = $('<div class=\"btn-group\"></div>');\n        this.btn_action = $('<button type=\"button\" style=\"background:white;\" class=\"btn btn-outline-primary dropdown-toggle\" data-toggle=\"dropdown\" aria-haspopup=\"true\" aria-expanded=\"false\">' + (0, I18n_1.I18n)('choose_option') + '</button>');\n        const dropdown_menu = $('<div class=\"dropdown-menu\"></div>');\n        btn_group.append(this.btn_action);\n        options.forEach((opt, i) => {\n            const dropdown_item = $('<a class=\"dropdown-item\" href=\"#\">' + opt + '</a>');\n            dropdown_item.on('click', function (evt) {\n                evt.preventDefault();\n                self.selectedIndex = i + '';\n                self.btn_action.html(dropdown_item.html());\n                if (self.status != globals_1.cfg.STATUS.MODIFIED) {\n                    self.check_el.html('');\n                    self.status = globals_1.cfg.STATUS.MODIFIED;\n                    self.quill_el_container.removeClass('pw-me-right pw-me-wrong pw-me-alert');\n                }\n            });\n            dropdown_menu.append(dropdown_item);\n        });\n        btn_group.append(dropdown_menu);\n        this.quill_el_container.append(btn_group);\n        this.quill_el_container.append(this.check_el);\n        this.parent.append(this.quill_el_container);\n        (0, utils_1.reflowLatex)();\n    }\n    showAnswer() {\n    }\n    clear() {\n        this.selectedIndex = '';\n        this.btn_action.html('');\n        this.check_el.html('');\n        this.status = globals_1.cfg.STATUS.UNMODIFIED;\n        this.quill_el_container.removeClass('pw-me-right pw-me-wrong pw-me-alert');\n    }\n    focus() {\n        this.btn_action.focus();\n    }\n    latex(tex) {\n        return [this.selectedIndex];\n    }\n    checkMsg(status, msg) {\n        this.status = status;\n        let msg2 = '';\n        if (status == 1) {\n            msg2 = '<span data-toggle=\"tooltip\" title=\"' + msg + '\"><i class=\"fas fa-check\"></i></span>';\n            this.quill_el_container.addClass('pw-me-right');\n        }\n        else if (status == 0) {\n            msg2 = '<span data-toggle=\"tooltip\" title=\"' + msg + '\"><i class=\"fas fa-times\"></i></span>';\n            this.quill_el_container.addClass('pw-me-wrong');\n        }\n        else {\n            msg2 = '<span data-toggle=\"tooltip\" title=\"' + msg + '\"><i class=\"fas fa-exclamation-triangle\"></i></span>';\n            this.quill_el_container.addClass('pw-me-alert');\n        }\n        this.check_el.html(msg2);\n    }\n    dispose() {\n        this.quill_el_container.off();\n    }\n    get_qid() {\n        return this.qid;\n    }\n    reflow() {\n        this.status = globals_1.cfg.STATUS.UNMODIFIED;\n    }\n}\nexports.EditorMChoice = EditorMChoice;\n","\"use strict\";\nObject.defineProperty(exports, \"__esModule\", { value: true });\nexports.EditorMChoiceCheckbox = void 0;\nconst globals_1 = require(\"../globals\");\nconst utils_1 = require(\"../utils\");\nconst editorBase_1 = require(\"./editorBase\");\n/**\n     * Multiple options with checkboxes\n     * @param {*} parent\n     * @param {*} gid\n     * @param {*} options\n     * @param {*} multipleAnswers\n*/\nclass EditorMChoiceCheckbox extends editorBase_1.EditorBase {\n    constructor(parent, gid, def, qtype, multipleAnswers) {\n        super(parent, gid, def, qtype);\n        this.multipleAnswers = multipleAnswers || false;\n        let options = def.symbols;\n        const self = this;\n        this.selectedIndex = '';\n        this.gid = gid;\n        this.qid = Math.floor(Math.random() * 10000) + 10000;\n        this.options = options || [];\n        // cfg.STATUS = 0 incorrecte, cfg.STATUS = 1 correcte, cfg.STATUS < 0 errors \n        this.status = globals_1.cfg.STATUS.UNMODIFIED;\n        this.parent = parent;\n        this.wrong_attemps = 0;\n        this.quill_el_container = $('<div class=\"pw-me-mchoice\"></div>');\n        this.check_el = $('<div class=\"pw-me-check\"></div>');\n        const radios_group = $('<div></div>');\n        const radiosGroupId = \"rgid_\" + Math.random().toString(32).substring(2);\n        const allRadios = [];\n        options.forEach(function (opt, i) {\n            const radioId = \"raid_\" + Math.random().toString(32).substring(2);\n            const radio_wrapper = $('<div class=\"form-check\"></div>');\n            let radio_item = null;\n            if (self.multipleAnswers) {\n                radio_item = $('<input class=\"form-check-input\" type=\"checkbox\" id=\"' + radioId + '\" value=\"' + i + '\"/>');\n            }\n            else {\n                radio_item = $('<input class=\"form-check-input\" type=\"radio\" name=\"' + radiosGroupId + '\" id=\"' + radioId + '\" value=\"' + i + '\"/>');\n            }\n            allRadios.push(radio_item);\n            const radio_label = $('<label class=\"form-check-label\" for=\"' + radioId + '\">' + opt + '</label>');\n            radio_item.on('change', function (evt) {\n                evt.preventDefault();\n                //Determine which are selected\n                const wsel = [];\n                for (let k = 0; k < allRadios.length; k++) {\n                    if (allRadios[k].prop('checked')) {\n                        wsel.push(allRadios[k].prop('value') + '');\n                    }\n                }\n                self.selectedIndex = wsel.join(',');\n                if (self.status != globals_1.cfg.STATUS.MODIFIED) {\n                    self.check_el.html('');\n                    self.status = globals_1.cfg.STATUS.MODIFIED;\n                    self.quill_el_container.removeClass('pw-me-right pw-me-wrong pw-me-alert');\n                }\n            });\n            radio_wrapper.append(radio_item);\n            radio_wrapper.append(radio_label);\n            radios_group.append(radio_wrapper);\n        });\n        this.quill_el_container.append(radios_group);\n        this.quill_el_container.append(this.check_el);\n        this.parent.append(this.quill_el_container);\n        (0, utils_1.reflowLatex)();\n    }\n    showAnswer() {\n    }\n    clear() {\n        this.selectedIndex = '';\n        this.btn_action.html('');\n        this.check_el.html('');\n        this.status = globals_1.cfg.STATUS.UNMODIFIED;\n        this.quill_el_container.removeClass('pw-me-right pw-me-wrong pw-me-alert');\n    }\n    focus() {\n    }\n    latex(tex) {\n        return [this.selectedIndex];\n    }\n    get_qid() {\n        return this.qid;\n    }\n    checkMsg(status, msg) {\n        this.status = status;\n        let msg2 = '';\n        if (status == 1) {\n            msg2 = '<span data-toggle=\"tooltip\" title=\"' + msg + '\"><i class=\"fas fa-check\"></i></span>';\n            this.quill_el_container.addClass('pw-me-right');\n        }\n        else if (status == 0) {\n            msg2 = '<span data-toggle=\"tooltip\" title=\"' + msg + '\"><i class=\"fas fa-times\"></i></span>';\n            this.quill_el_container.addClass('pw-me-wrong');\n        }\n        else {\n            msg2 = '<span data-toggle=\"tooltip\" title=\"' + msg + '\"><i class=\"fas fa-exclamation-triangle\"></i></span>';\n            this.quill_el_container.addClass('pw-me-alert');\n        }\n        this.check_el.html(msg2);\n    }\n    dispose() {\n        this.quill_el_container.off();\n    }\n    reflow() {\n        this.status = globals_1.cfg.STATUS.UNMODIFIED;\n    }\n}\nexports.EditorMChoiceCheckbox = EditorMChoiceCheckbox;\n","\"use strict\";\nvar __importDefault = (this && this.__importDefault) || function (mod) {\n    return (mod && mod.__esModule) ? mod : { \"default\": mod };\n};\nObject.defineProperty(exports, \"__esModule\", { value: true });\nexports.EditorPanel = void 0;\nconst globals_1 = require(\"../globals\");\nconst utils_1 = require(\"../utils\");\nconst pwTabMenu_1 = require(\"./toolbar/pwTabMenu\");\nconst createToolbarButton_1 = require(\"./toolbar/createToolbarButton\");\nconst toolbar_config_1 = __importDefault(require(\"./toolbar/toolbar-config\"));\nconst editorBase_1 = require(\"./editorBase\");\nconst engineCAS_1 = require(\"../engines/engineCAS\");\n// Editor panel\nclass EditorPanel extends editorBase_1.EditorBase {\n    constructor(parent, gid, def, qtype, standalone) {\n        super(parent, gid, def, qtype);\n        const self = this;\n        this.parent = parent;\n        this.gid = gid;\n        this.wrong_attemps = 0;\n        this.standalone = standalone || false;\n        this.status = globals_1.cfg.STATUS.UNMODIFIED;\n        this.panel = $('<div class=\"pw-me-editorpanel\" style=\"position:relative\"></div>');\n        this.parent.append(this.panel);\n        this.palettes = new pwTabMenu_1.PwTabMenu(this.panel, this.gid);\n        this.spanMathInput = $('<span class=\"pw-me-editorpanel-mathinput\"></span>');\n        this.spanMathInput.on(\"click\", function (ev) {\n            ev.preventDefault();\n            $('.pw-me-btn-dropdownmenu').css(\"display\", \"none\");\n        });\n        this.panel.append(this.spanMathInput);\n        this.mathInput = (0, globals_1.MathField)(this.spanMathInput[0], {\n            handlers: {\n                edit() {\n                    if (standalone && self.status != globals_1.cfg.STATUS.MODIFIED) {\n                        self.check_el && self.check_el.html('');\n                        self.status = globals_1.cfg.STATUS.MODIFIED;\n                    }\n                }\n            }\n        });\n        if (this.standalone) {\n            this.check_el = $('<div></div>');\n            this.panel.append(this.check_el);\n        }\n        this.feedback_el = $('<div class=\"pw-mq-feedback\" style=\"display:none;\"></div>');\n        this.panel.append(this.feedback_el);\n        //Add button to palettes\n        (0, utils_1.items)(toolbar_config_1.default.button_meta, function (name, btnInfo) {\n            const tabName = toolbar_config_1.default.default_toolbar_tabs[btnInfo.tab - 1];\n            self.palettes.addTab(tabName);\n            // create and add button to palette  \n            const aButton = (0, createToolbarButton_1.createToolbarButton)(self.panel, btnInfo, name, self.mathInput);\n            self.palettes.addContentsToTab(tabName, aButton);\n        });\n        this.setDefinition(def);\n    }\n    get $div() {\n        return this.panel;\n    }\n    clear() {\n        this.mathInput.latex('');\n        this.check_el && this.check_el.html('');\n        this.status = globals_1.cfg.STATUS.UNMODIFIED;\n    }\n    focus() {\n        this.mathInput.focus();\n    }\n    latex(tex) {\n        if (tex != null) {\n            this.mathInput.latex(tex);\n            this.status = globals_1.cfg.STATUS.UNMODIFIED;\n        }\n        else {\n            return [(0, utils_1.sanitizeLaTeX)(this.mathInput.latex())];\n        }\n        return [''];\n    }\n    checkMsg(status, msg) {\n        if (this.standalone) {\n            this.status = status;\n            let msg2 = '';\n            if (status == 1) {\n                msg2 = '<span style=\"color:green;margin:5px;\"><i class=\"fas fa-check\"></i> ' + msg + '</span>';\n            }\n            else if (status == 0) {\n                msg2 = '<span style=\"color:darkred;margin:5px;\"><i class=\"fas fa-times\"></i> ' + msg + '</span>';\n            }\n            else {\n                msg2 = '<span style=\"color:purple;margin:5px;\"><i class=\"fas fa-exclamation-triangle\"></i> ' + msg + '</span>';\n            }\n            this.check_el && this.check_el.html(msg2);\n        }\n    }\n    get_qid() {\n        return this.mathInput.id;\n    }\n    showPalette(name, visible) {\n        this.palettes.setVisible(name, visible);\n    }\n    dispose() {\n        this.mathInput.revert();\n        this.panel.find(\"button\").off();\n        this.palettes.dispose();\n    }\n    reflow() {\n        this.mathInput.reflow();\n        this.status = globals_1.cfg.STATUS.UNMODIFIED;\n    }\n    setDefinition(def) {\n        this.def = def;\n        const self = this;\n        if (def.palettes && def.palettes.indexOf('all') >= 0) {\n            // Show all palettes\n            // enable general palette\n            toolbar_config_1.default.default_toolbar_tabs.forEach(function (name) {\n                self.palettes.setVisible(name, true);\n            });\n            this.palettes.setTab('General');\n        }\n        // According to definition.palettes prepare the correct palettes\n        else if (def.palettes && def.palettes.length) {\n            // show this palettes\n            // set to first palette\n            let firstSelected = null;\n            let num_visible = 0;\n            toolbar_config_1.default.default_toolbar_tabs.forEach(function (name) {\n                let found = false;\n                let j = 0;\n                while (!found && j < def.palettes.length) {\n                    found = def.palettes[j].toLowerCase().trim() == name.toLowerCase().trim();\n                    if (found && j == 0) {\n                        firstSelected = name;\n                    }\n                    if (found) {\n                        num_visible += 1;\n                    }\n                    j += 1;\n                }\n                self.palettes.setVisible(name, found);\n            });\n            if (num_visible == 0 || !firstSelected) {\n                this.palettes.setVisible('General', true);\n            }\n            this.palettes.setTab(firstSelected || 'General');\n        }\n        else {\n            // Only show the general palette\n            // enable general palette\n            toolbar_config_1.default.default_toolbar_tabs.forEach(function (name) {\n                self.palettes.setVisible(name, name == 'General');\n            });\n            this.palettes.setTab('General');\n        }\n    }\n    increment_wrong() {\n        this.wrong_attemps += 1;\n        if (this.wrong_attemps > globals_1.cfg.MAX_ATTEMPTS) {\n            this.showAnswer();\n        }\n    }\n    showAnswer() {\n        var _a;\n        var self = this;\n        if (!this.def) {\n            console.error(\"Cannot show answer because def is null\");\n            return;\n        }\n        if (!this.def.right_answer) {\n            // Try to ask the server to generate the answer\n            engineCAS_1.engineCAS.getAnswer(this.def).then((datos) => {\n                var _a;\n                if (datos.right_answer) {\n                    (_a = self.check_el) === null || _a === void 0 ? void 0 : _a.css(\"display\", \"none\");\n                    self.def.right_answer = datos.right_answer;\n                    self.feedback_el.css(\"display\", \"\");\n                    self.feedback_el.html(atob(self.def.right_answer) + '<p><br></p>');\n                    (0, utils_1.reflowLatex)();\n                    self.isAnswerShown = true;\n                    self.palettes.setEnabled(false);\n                    self.spanMathInput.css(\"pointer-events\", \"none\");\n                    self.panel.css(\"cursor\", \"not-allowed\");\n                }\n                else if (datos.msg) {\n                    console.error(datos.msg);\n                }\n            }, (errors) => {\n                console.error(errors);\n            });\n        }\n        else {\n            (_a = self.check_el) === null || _a === void 0 ? void 0 : _a.css(\"display\", \"none\");\n            this.feedback_el.css(\"display\", \"\");\n            this.feedback_el.html(atob(this.def.right_answer) + '<p><br></p>');\n            (0, utils_1.reflowLatex)();\n            this.isAnswerShown = true;\n            this.palettes.setEnabled(false);\n            this.spanMathInput.css(\"pointer-events\", \"none\");\n            this.panel.css(\"cursor\", \"not-allowed\");\n        }\n    }\n}\nexports.EditorPanel = EditorPanel;\n;\n","\"use strict\";\nObject.defineProperty(exports, \"__esModule\", { value: true });\nexports.createToolbarButton = void 0;\nconst globals_1 = require(\"../../globals\");\n// Create a button for toolbar tab\nfunction createToolbarButton(parent, btn_meta, key, mathInput) {\n    if (typeof (btn_meta.latex) === \"function\") {\n        var btn = $('<div class=\"btn btn-sm pw-me-btn-toolbar pw-me-btn-dropdown\" title=\"' + key.trim() + '\"></div>');\n        var icon = $('<span>' + btn_meta.icon + '</span>');\n        (0, globals_1.StaticMath)(icon[0]);\n        btn.append(icon);\n        var panell = $('<div class=\"pw-me-btn-dropdownmenu\"></div>');\n        parent.append(panell);\n        var controls = [];\n        for (var k = 0, lenk = btn_meta.vars.length; k < lenk; k++) {\n            var varObj = btn_meta.vars[k];\n            var name = varObj.name;\n            //TODO check number or text values\n            var minmax = \"\";\n            if (varObj.min != null) {\n                minmax = ' min=\"' + varObj.min + '\" ';\n            }\n            if (varObj.max != null) {\n                minmax += ' max=\"' + varObj.max + '\" ';\n            }\n            var control = $('<input style=\"width:50px;margin-left:4px;grid-column:2;\" type=\"' + varObj.type + '\" value=\"' + varObj.val + '\"' + minmax + '/>');\n            controls.push(control);\n            var alab = $('<span style=\"grid-column:1\">' + name + '</span>');\n            panell.append(alab);\n            panell.append(control);\n        }\n        var okButtton = $('<button class=\"btn btn-sm\" style=\"padding:4px;grid-row:3;grid-column:1 / 2;background:lightgray;\">Ok</button>');\n        panell.append(okButtton);\n        okButtton.on(\"click\", function (evt) {\n            evt.preventDefault();\n            //recupera mapa de valors\n            var varsmap = {};\n            for (var k = 0, lenk = controls.length; k < lenk; k++) {\n                var $c = controls[k];\n                var varObj = btn_meta.vars[k];\n                var name = varObj.name;\n                var value = $c.val();\n                if (varObj.type === 'number') {\n                    value = parseInt(value);\n                }\n                varsmap[name] = value;\n            }\n            var real_latex = btn_meta.latex(varsmap);\n            mathInput.write(real_latex);\n            if (btn_meta.moveto) {\n                mathInput.keystroke(btn_meta.moveto);\n            }\n            panell.css(\"display\", \"none\");\n            mathInput.focus();\n        });\n        // requires a dialog to ask for parameters in btn_meta.vars array\n        btn.on('click', function (ev) {\n            ev.preventDefault();\n            // open a dialog with inputs\n            var panell_shown = panell.css(\"display\");\n            panell.css(\"display\", panell_shown === 'none' ? \"grid\" : \"none\");\n        });\n    }\n    else {\n        btn = $('<button class=\"btn btn-sm pw-me-btn-toolbar\" title=\"' + key.trim() + '\"></button>');\n        var icon = $('<span>' + btn_meta.icon + '</span>');\n        (0, globals_1.StaticMath)(icon[0]);\n        btn.append(icon);\n        // simple button\n        btn.on('click', function (ev) {\n            ev.preventDefault();\n            mathInput.write(btn_meta.latex);\n            mathInput.focus();\n            if (btn_meta.moveto) {\n                mathInput.keystroke(btn_meta.moveto);\n            }\n            $('.pw-me-btn-dropdownmenu').css(\"display\", \"none\");\n        });\n    }\n    return btn;\n}\nexports.createToolbarButton = createToolbarButton;\n;\n","\"use strict\";\nObject.defineProperty(exports, \"__esModule\", { value: true });\nexports.PwTabMenu = void 0;\nconst I18n_1 = require(\"../../I18n\");\nconst utils_1 = require(\"../../utils\");\n// TabMenu\nclass PwTabMenu {\n    constructor(parent, gid) {\n        this.$panel = $('<div class=\"pw-me-tabmenu\"></div>');\n        this.parent = parent;\n        this.tabs = {};\n        this.currentTab = null;\n        this.tabsPanel = $('<div class=\"pw-me-tabspanel\"></div>');\n        this.contentsPanel = $('<div class=\"pw-me-tabcontents\"></div>');\n        this.$panel.append(this.tabsPanel);\n        this.$panel.append(this.contentsPanel);\n        if (this.parent) {\n            this.parent.append(this.$panel);\n        }\n        this.gid = gid;\n    }\n    get $div() {\n        return this.$panel;\n    }\n    addTab(name) {\n        if (this.tabs[name]) {\n            //already exists\n            return;\n        }\n        var self = this;\n        var tab = $('<button style=\"display:none;\" class=\"btn btn-sm pw-me-btn-tab\">' + (0, I18n_1.I18n)(name) + '</button>');\n        var container = $('<div style=\"display:none;\" class=\"pw-me-tabcontainer\"></div>');\n        tab.on('click', function (ev) {\n            ev.preventDefault();\n            self.setTab(name);\n        });\n        this.tabsPanel.append(tab);\n        this.contentsPanel.append(container);\n        this.tabs[name] = {\n            tab: tab,\n            container: container\n        };\n        if (Object.keys(this.tabs).length === 1) {\n            this.setTab(name);\n        }\n    }\n    addContentsToTab(name, contents) {\n        if (this.tabs[name]) {\n            this.tabs[name].container.append(contents);\n        }\n    }\n    setVisible(name, visibility) {\n        console.log(name, this.tabs);\n        if (this.tabs[name]) {\n            this.tabs[name].tab.css('display', visibility ? '' : 'none');\n            this.tabs[name].container.css('display', visibility ? 'flex' : 'none');\n        }\n    }\n    setEnabled(enabled) {\n        if (enabled) {\n            this.contentsPanel.css(\"pointer-events\", \"initial\");\n            this.$panel.css(\"cursor\", \"initial\");\n        }\n        else {\n            this.contentsPanel.css(\"pointer-events\", \"none\");\n            this.$panel.css(\"cursor\", \"not-allowed\");\n        }\n    }\n    setTab(name) {\n        (0, utils_1.items)(this.tabs, function (key, value) {\n            if (key == name) {\n                value.tab.addClass('pw-me-btn-active');\n                value.tab.css('display', '');\n            }\n            else {\n                value.tab.removeClass('pw-me-btn-active');\n            }\n            value.container.css('display', key == name ? 'flex' : 'none');\n        });\n    }\n    dispose() {\n        this.tabsPanel.children().off();\n        this.tabsPanel.html('');\n        this.contentsPanel.html('');\n        this.tabs = {};\n    }\n}\nexports.PwTabMenu = PwTabMenu;\n;\n","\"use strict\";\nObject.defineProperty(exports, \"__esModule\", { value: true });\nconst default_toolbar_buttons = ['fraction', 'square_root', 'cube_root', 'root', 'superscript', 'subscript', 'multiplication', 'division', 'plus_minus', 'pi', 'degree', 'not_equal', 'greater_equal', 'less_equal', 'greater_than', 'less_than', 'angle', 'parallel_to', 'perpendicular', 'triangle', 'parallelogram', 'round_brackets', 'matrix2', 'matrix3'];\nconst default_toolbar_tabs = [\"General\", \"Símbols\", \"Geometria\", \"Intervals\", \"Funcions\"];\nconst button_meta = {\n    //TAB1\n    \"Multiplicació\": { latex: \"\\\\times\", tab: 1, icon: '\\\\times' },\n    \"Fracció\": { latex: \"\\\\frac{}{}\", moveto: \"Up\", movefor: 1, tab: 1, icon: '\\\\frac{\\\\square}{\\\\square}' },\n    \"Exponent\": { latex: \"\\\\^{}\", moveto: \"Up\", movefor: 1, tab: 1, icon: '\\\\square^2' },\n    \"Parèntesis\": { latex: \"\\\\left(\\\\right)\", moveto: \"Left\", movefor: 1, tab: 1, icon: '\\\\left(\\\\square\\\\right)' },\n    \"Arrel quadrada\": { latex: \"\\\\sqrt{}\", moveto: \"Left\", movefor: 1, tab: 1, icon: '\\\\sqrt{\\\\square}' },\n    \"Arrel cúbica\": { latex: \"\\\\sqrt[3]{}\", moveto: \"Left\", movefor: 1, tab: 1, icon: '\\\\sqrt[3]{\\\\square}' },\n    \"Radical\": { latex: \"\\\\sqrt[{}]{}\", moveto: \"Left\", movefor: 2, tab: 1, icon: '\\\\sqrt[\\\\square]{\\\\square}' },\n    \"Matriu 2x2\": { latex: \"\\\\begin{pmatrix} & \\\\\\\\ & \\\\end{pmatrix}\", tab: 1, icon: 'M_{2\\\\times 2}' },\n    \"Matriu 3x3\": { latex: \"\\\\begin{pmatrix} & & \\\\\\\\ & &  \\\\\\\\ & & \\\\end{pmatrix}\", tab: 1, icon: 'M_{3\\\\times 3}' },\n    \"Matriu mxn\": {\n        latex: function (vars) {\n            const lat = [];\n            for (let i = 0; i < vars.n; i++) {\n                const latrow = [];\n                for (let j = 0; j < vars.m; j++) {\n                    latrow.push(\" \");\n                }\n                lat.push(latrow.join(\"&\"));\n            }\n            return \"\\\\begin{pmatrix} \" + lat.join(\"\\\\\\\\\") + \" \\\\end{pmatrix}\";\n        }, tab: 1, icon: 'M_{n\\\\times m}', vars: [{ name: 'n', type: 'number', min: 1, val: 2 }, { name: 'm', type: 'number', min: 1, val: 2 }]\n    },\n    \"Subíndex\": { latex: \"\\\\_{}\", moveto: \"Down\", movefor: 1, tab: 1, icon: '\\\\square_{2}' },\n    //TAB2 - símbols i constants\n    \"pi\": { latex: \"\\\\pi\", tab: 2, icon: '\\\\pi' },\n    \"e\": { latex: \"\\\\e\", tab: 2, icon: 'e' },\n    \"infinit\": { latex: \"\\\\infty\", tab: 2, icon: '\\\\infty' },\n    \"Més menys\": { latex: \"\\\\pm\", tab: 2, icon: '\\\\pm' },\n    \"Diferent\": { latex: \"\\\\neq\", tab: 2, icon: '\\\\neq' },\n    \"Major o igual\": { latex: \"\\\\geq\", tab: 2, icon: '\\\\geq' },\n    \"Menor o igual\": { latex: \"\\\\leq\", tab: 2, icon: '\\\\leq' },\n    \"Major que\": { latex: \"\\\\gt\", tab: 2, icon: '\\\\gt' },\n    \"Menor que\": { latex: \"\\\\lt\", tab: 2, icon: '\\\\lt' },\n    //TAB3 - geometria\n    \"Graus\": { latex: \"\\\\degree\", tab: 3, icon: '\\\\degree' },\n    \"Angle\": { latex: \"\\\\angle\", tab: 3, icon: '\\\\angle' },\n    \"Paral·lel a\": { latex: \"\\\\parallel\", tab: 3, icon: '\\\\parallel' },\n    \"Perpendicular a\": { latex: \"\\\\perpendicular\", tab: 3, icon: '\\\\perpendicular' },\n    \"Triangle\": { latex: \"\\\\triangle\", tab: 3, icon: '\\\\triangle' },\n    \"Paral·lelogram\": { latex: \"\\\\parallelogram\", tab: 3, icon: '\\\\parallelogram' },\n    //TAB4 - intervals\n    \"Interval obert\": { latex: \"\\\\left( , \\\\right)\", moveto: \"Left\", movefor: 4, tab: 4, icon: '\\\\left(\\\\square, \\\\square\\\\right)' },\n    \"Interval tancat\": { latex: \"\\\\left[ , \\\\right]\", moveto: \"Left\", movefor: 4, tab: 4, icon: '\\\\left[\\\\square, \\\\square\\\\right]' },\n    \"Interval semi1\": { latex: \"\\\\left[ , \\\\right)\", moveto: \"Left\", movefor: 4, tab: 4, icon: '\\\\left[\\\\square, \\\\square\\\\right)' },\n    \"Interval semi2\": { latex: \"\\\\left( , \\\\right]\", moveto: \"Left\", movefor: 4, tab: 4, icon: '\\\\left(\\\\square, \\\\square\\\\right]' },\n    \"Infinit\": { latex: \"\\\\infty\", tab: 4, icon: '\\\\infty' },\n    \"Conjunt dels reals\": { latex: \"\\\\mathbb{R}\", tab: 4, icon: '\\\\mathbb{R}' },\n    //TAB5- Funcions\n    \"Sinus\": { latex: \"\\\\sin()\", moveto: \"Left\", movefor: 1, tab: 5, icon: '\\\\sin{\\\\square}' },\n    \"Cosinus\": { latex: \"\\\\cos()\", moveto: \"Left\", movefor: 1, tab: 5, icon: '\\\\cos{\\\\square}' },\n    \"Tangent\": { latex: \"\\\\tan()\", moveto: \"Left\", movefor: 1, tab: 5, icon: '\\\\tan{\\\\square}' },\n    \"Arcsinus\": { latex: \"\\\\arcsin()\", moveto: \"Left\", movefor: 1, tab: 5, icon: '\\\\arcsin{\\\\square}' },\n    \"Arccosinus\": { latex: \"\\\\arccos()\", moveto: \"Left\", movefor: 1, tab: 5, icon: '\\\\arccos{\\\\square}' },\n    \"Arctangent\": { latex: \"\\\\arctan()\", moveto: \"Left\", movefor: 1, tab: 5, icon: '\\\\arctan{\\\\square}' },\n    \"Logaritme Neperià\": { latex: \"\\\\ln()\", moveto: \"Left\", movefor: 1, tab: 5, icon: '\\\\ln{\\\\square}' },\n    \"Logaritme en base b\": { latex: \"\\\\frac{\\\\log()}{\\\\log{b}}\", moveto: \"Left\", movefor: 4, tab: 5, icon: '\\\\log_b{\\\\square}' },\n};\nconst keyboard_keys = {\n    'letters': [{ 'value': 'q', 'type': 'write', 'class': 'ks', 'display': 'q', 'new_line': false }, { 'value': 'w', 'type': 'write', 'class': 'ks', 'display': 'w', 'new_line': false }, { 'value': 'e', 'type': 'write', 'class': 'ks', 'display': 'e', 'new_line': false }, { 'value': 'r', 'type': 'write', 'class': 'ks', 'display': 'r', 'new_line': false }, { 'value': 't', 'type': 'write', 'class': 'ks', 'display': 't', 'new_line': false }, { 'value': 'y', 'type': 'write', 'class': 'ks', 'display': 'y', 'new_line': false }, { 'value': 'u', 'type': 'write', 'class': 'ks', 'display': 'u', 'new_line': false }, { 'value': 'i', 'type': 'write', 'class': 'ks', 'display': 'i', 'new_line': false }, { 'value': 'o', 'type': 'write', 'class': 'ks', 'display': 'o', 'new_line': false }, { 'value': 'p', 'type': 'write', 'class': 'ks', 'display': 'p', 'new_line': true }, { 'value': 'a', 'type': 'write', 'class': 'ks', 'display': 'a', 'new_line': false }, { 'value': 's', 'type': 'write', 'class': 'ks', 'display': 's', 'new_line': false }, { 'value': 'd', 'type': 'write', 'class': 'ks', 'display': 'd', 'new_line': false }, { 'value': 'f', 'type': 'write', 'class': 'ks', 'display': 'f', 'new_line': false }, { 'value': 'g', 'type': 'write', 'class': 'ks', 'display': 'g', 'new_line': false }, { 'value': 'h', 'type': 'write', 'class': 'ks', 'display': 'h', 'new_line': false }, { 'value': 'j', 'type': 'write', 'class': 'ks', 'display': 'j', 'new_line': false }, {\n            'value': 'k', 'type': 'write', 'class': 'ks', 'display': 'k', 'new_line': false\n        }, { 'value': 'l', 'type': 'write', 'class': 'ks', 'display': 'l', 'new_line': true }, { 'value': 'CapsLock', 'type': 'custom', 'class': 'ks long icon', 'display': '&#8673;', 'new_line': false }, { 'value': 'z', 'type': 'write', 'class': 'ks', 'display': 'z', 'new_line': false }, { 'value': 'x', 'type': 'write', 'class': 'ks', 'display': 'x', 'new_line': false }, { 'value': 'c', 'type': 'write', 'class': 'ks', 'display': 'c', 'new_line': false }, { 'value': 'v', 'type': 'write', 'class': 'ks', 'display': 'v', 'new_line': false }, { 'value': 'b', 'type': 'write', 'class': 'ks', 'display': 'b', 'new_line': false }, { 'value': 'n', 'type': 'write', 'class': 'ks', 'display': 'n', 'new_line': false }, { 'value': 'm', 'type': 'write', 'class': 'ks', 'display': 'm', 'new_line': false }, { 'value': 'Backspace', 'type': 'keystroke', 'class': 'ks long icon', 'display': '&#8678;', 'new_line': true }, { 'value': 'numpad', 'type': 'custom', 'class': 'ks long', 'display': '123', 'new_line': false }, { 'value': ',', 'type': 'write', 'class': 'ks', 'display': ',', 'new_line': false }, { 'value': '\\\\ ', 'type': 'write', 'class': 'ks too_long', 'display': 'Space', 'new_line': false }, { 'value': '.', 'type': 'write', 'class': 'ks', 'display': '.', 'new_line': false }, { 'value': 'close', 'type': 'custom', 'class': 'ks long takeup', 'display': 'X', 'new_line': false }], 'numbers': [{ 'value': '1', 'type': 'write', 'class': 'ks', 'display': '1', 'new_line': false }, { 'value': '2', 'type': 'write', 'class': 'ks', 'display': '2', 'new_line': false }, { 'value': '3', 'type': 'write', 'class': 'ks', 'display': '3', 'new_line': false }, { 'value': '+', 'type': 'write', 'class': 'ks', 'display': '+', 'new_line': false }, { 'value': '-', 'type': 'write', 'class': 'ks', 'display': '&#8315;', 'new_line': true }, { 'value': '4', 'type': 'write', 'class': 'ks', 'display': '4', 'new_line': false }, { 'value': '5', 'type': 'write', 'class': 'ks', 'display': '5', 'new_line': false }, {\n            'value': '6', 'type': 'write',\n            'class': 'ks', 'display': '6', 'new_line': false\n        }, { 'value': '\\\\times', 'type': 'write', 'class': 'ks', 'display': '&times;', 'new_line': false }, { 'value': '/', 'type': 'write', 'class': 'ks', 'display': '&#247;', 'new_line': true }, { 'value': '7', 'type': 'write', 'class': 'ks', 'display': '7', 'new_line': false }, { 'value': '8', 'type': 'write', 'class': 'ks', 'display': '8', 'new_line': false }, { 'value': '9', 'type': 'write', 'class': 'ks', 'display': '9', 'new_line': false }, { 'value': '=', 'type': 'write', 'class': 'ks', 'display': '=', 'new_line': false }, { 'value': 'Backspace', 'type': 'keystroke', 'class': 'ks long icon', 'display': '&#8678;', 'new_line': true }, { 'value': 'letters', 'type': 'custom', 'class': 'ks long', 'display': 'ABC', 'new_line': false }, { 'value': '0', 'type': 'write', 'class': 'ks', 'display': '0', 'new_line': false }, { 'value': '?', 'type': 'write', 'class': 'ks', 'display': '?', 'new_line': false }, {\n            'value': '%', 'type': 'write', 'class': 'ks', 'display': '%',\n            'new_line': false\n        }, { 'value': 'close', 'type': 'custom', 'class': 'ks long takeup', 'display': 'X', 'new_line': false }]\n};\nexports.default = {\n    default_toolbar_buttons,\n    default_toolbar_tabs,\n    button_meta,\n    keyboard_keys\n};\n","\"use strict\";\nObject.defineProperty(exports, \"__esModule\", { value: true });\nexports.createQuillFromObject = void 0;\nconst editorCloze_1 = require(\"./components/editorCloze\");\nconst editorInput_1 = require(\"./components/editorInput\");\nconst editorPanel_1 = require(\"./components/editorPanel\");\nconst editorMChoice_1 = require(\"./components/editorMChoice\");\nconst globals_1 = require(\"./globals\");\nconst editorMChoiceCheckbox_1 = require(\"./components/editorMChoiceCheckbox\");\nconst utils_1 = require(\"./utils\");\nfunction createQuillFromObject($el, gid, obj) {\n    let created = null;\n    const qtype = obj.editor;\n    if (obj.formulation) {\n        const spanEl = \"<span>\" + obj.formulation + \"</span>\";\n        $el.append(spanEl);\n        // Probably will have to process mathjax\n        (0, utils_1.reflowLatex)();\n    }\n    $el.removeClass(\"pygen-cloze\");\n    if (qtype == globals_1.cfg.QTYPES.C) {\n        // clozed input (replace ini with boxes) \n        created = new editorCloze_1.EditorCloze($el, gid, obj, globals_1.cfg.QTYPES.C, obj.initial_latex);\n        $el.addClass(\"pygen-cloze\");\n    }\n    else if (qtype == globals_1.cfg.QTYPES.P) {\n        // Full panel\n        created = new editorPanel_1.EditorPanel($el, gid, obj, globals_1.cfg.QTYPES.P, true);\n    }\n    else if (qtype == globals_1.cfg.QTYPES.M) {\n        obj.symbols = obj.symbols || [];\n        // Multiple choice combo \n        created = new editorMChoice_1.EditorMChoice($el, gid, obj, globals_1.cfg.QTYPES.M, obj.symbols);\n    }\n    else if (qtype == globals_1.cfg.QTYPES.Ms) {\n        obj.symbols = obj.symbols || [];\n        // Multiple choice radio and checkbox\n        // TODO support multiple answers\n        const multipleAnswers = Array.isArray(obj.ans);\n        //created = new MultipleChoiceCombo($el, gid, obj.symbols);\n        created = new editorMChoiceCheckbox_1.EditorMChoiceCheckbox($el, gid, obj, globals_1.cfg.QTYPES.Ms, multipleAnswers);\n    }\n    else if (qtype == globals_1.cfg.QTYPES.B) {\n        // basic quill\n        created = new editorInput_1.EditorInput($el, gid, obj, globals_1.cfg.QTYPES.B);\n    }\n    else {\n        // Simple quill input\n        created = new editorInput_1.EditorInput($el, gid, obj, globals_1.cfg.QTYPES.S);\n    }\n    const qid = created.get_qid();\n    const groupContainer = globals_1.shared[gid] || {};\n    groupContainer[qid] = created;\n    created.setStatus(globals_1.cfg.STATUS.UNMODIFIED);\n    if (obj.initial_latex && qtype != globals_1.cfg.QTYPES.C) {\n        //console.log(\"Setting initial_latex\", obj.initial_latex);\n        created.latex(obj.initial_latex);\n        created.setStatus(globals_1.cfg.STATUS.MODIFIED);\n    }\n    return qid;\n}\nexports.createQuillFromObject = createQuillFromObject;\n;\n","\"use strict\";\nObject.defineProperty(exports, \"__esModule\", { value: true });\nexports.engineCAS = void 0;\nconst globals_1 = require(\"../globals\");\nconst nerdamerCAS_1 = require(\"./nerdamerCAS\");\nconst sympyCAS_1 = require(\"./sympyCAS\");\n// Decide which engine to use based on global cfg and the current payload\nexports.engineCAS = {\n    compare(payload) {\n        const engine = payload.engine || globals_1.cfg.DEFAULT_ENGINE;\n        if (engine === 'sympy') {\n            return sympyCAS_1.sympyCAS.compare(payload);\n        }\n        return nerdamerCAS_1.nerdamerCAS.compare(payload);\n    },\n    getAnswer(payload) {\n        const engine = payload.engine || globals_1.cfg.DEFAULT_ENGINE;\n        if (engine === 'sympy') {\n            return sympyCAS_1.sympyCAS.getAnswer(payload);\n        }\n        return nerdamerCAS_1.nerdamerCAS.getAnswer(payload);\n    }\n};\n","\"use strict\";\nObject.defineProperty(exports, \"__esModule\", { value: true });\nexports.nerdamerCAS = void 0;\nconst I18n_1 = require(\"../I18n\");\nconst utils_1 = require(\"../utils\");\nconst parseLatex_1 = require(\"./parseLatex\");\nfunction is_set(expr) {\n    var _a;\n    if (Array.isArray((_a = expr === null || expr === void 0 ? void 0 : expr.symbols) === null || _a === void 0 ? void 0 : _a.elements)) {\n        const mat = expr.symbols.elements;\n        const firstElem = mat[0];\n        if (!Array.isArray(firstElem)) {\n            return true;\n        }\n    }\n    return false;\n}\nfunction is_interval(expr) {\n    // Intervals not implemented in Nerdamer\n    return false;\n}\nfunction is_matrix(expr) {\n    const txt = expr.text();\n    if (txt.startsWith('matrix')) {\n        return window.nerdamer('size(' + txt + ')');\n    }\n    return null;\n}\nfunction is_zero_matrix(expr) {\n    let isZero = true;\n    expr.each((e) => { isZero = isZero && (e.text() == '0'); });\n    return isZero;\n}\nclass NerdamerCAS {\n    static clone(obj) {\n        return JSON.parse(JSON.stringify(obj));\n    }\n    static decrypt(str) {\n        return atob(str);\n    }\n    static checkRules(p) {\n        //Before parsing and evaluation, do checks directly based on latex answers\n        const rules_checks = [];\n        let rules = p.rules || {};\n        if (typeof rules === 'string') {\n            console.log(\"Converting rules to json\");\n            rules = JSON.parse(rules);\n        }\n        const latex_code = p.latex.join(' ');\n        // comma as tuple\n        if (rules['comma_as_decimal']) {\n            console.log('Consider comma as decimal');\n            // by default, consider comma as decimal separator\n            p['latex'] = p['latex'].map((e) => e.replace(',', '.'));\n        }\n        // do not allow sympy keywords in latex code\n        // TODO\n        if (rules['forbidden']) {\n            // symbols or expressions that are forbidden\n            rules[\"forbidden\"].forEach((fo_symb) => {\n                if (latex_code[fo_symb]) {\n                    rules_checks.push((0, I18n_1.I18n)('sym_notallowed', fo_symb));\n                }\n            });\n        }\n        if (rules[\"unique\"]) {\n            // Symbols that can only appear once\n            rules[\"unique\"].forEach((un_sym) => {\n                if ((latex_code.match(new RegExp(un_sym, 'g')) || []).length > 1) {\n                    rules_checks.push((0, I18n_1.I18n)('sym_once', un_sym));\n                }\n            });\n        }\n        return rules_checks;\n    }\n    compare(p) {\n        const cas = window.nerdamer;\n        console.log(\"The payload: \", p);\n        p = NerdamerCAS.clone(p);\n        if (typeof (p['latex']) === 'string') {\n            p['latex'] = [p['latex']];\n        }\n        return new Promise((resolve, reject) => {\n            //Remove all stores expressions\n            cas.flush();\n            cas.clearVars();\n            const core = window.nerdamer.getCore();\n            const Symbol = core.Symbol;\n            const scope = { 'x': cas('x'), 'y': cas('y'), 'z': cas('z'), 't': cas('t'), 'e': cas('exp(1)') };\n            const rules_checks = NerdamerCAS.checkRules(p);\n            if (rules_checks.length) {\n                resolve({ \"qid\": p.qid, \"msg\": rules_checks.join(' '), \"correct\": 0 });\n                return;\n            }\n            // Parses user input latex --> nerdamer\n            let user_sympy = [];\n            try {\n                user_sympy = p['latex'].map((e) => (0, parseLatex_1.parseLatex)(e));\n                if (user_sympy.filter((x) => x == null).length > 0) {\n                    return resolve({ \"qid\": p['qid'], \"correct\": -4, \"msg\": (0, I18n_1.I18n)('error_cantprocess') });\n                }\n            }\n            catch (ex) {\n                console.error(ex);\n                return resolve({ \"qid\": p['qid'], \"correct\": -4, \"msg\": \"Error: No es poden processar les respostes donades: \" + ex });\n            }\n            // Adds user answer to scope for checking evaluation and user defined symbols\n            user_sympy.forEach((v, i) => {\n                cas.setVar('ua_' + i, v);\n            });\n            //Prepares local scope for evaluation\n            try {\n                (p['symbols'] || []).forEach((symb) => {\n                    if (symb.indexOf(':=') > 0) {\n                        const pos = symb.indexOf(\":=\");\n                        const symb_name = symb.substring(0, pos);\n                        const symb_raw = symb.substring(pos + 2);\n                        cas.setVar(symb_name, symb_raw);\n                    }\n                    else {\n                        cas.setVar(symb, symb);\n                    }\n                });\n            }\n            catch (ex) {\n                console.error(ex);\n                resolve({ \"qid\": p[\"qid\"], \"correct\": -2, \"msg\": \"Error: no es poden processar els símbols: \" + ex });\n                return;\n            }\n            console.log(\"The scope:: \");\n            (0, utils_1.items)(scope, function (k, v) {\n                console.log(k + \": \", v.text());\n            });\n            let ans_sympy = [];\n            try {\n                //print('decrypting.....')\n                if (p['anse']) {\n                    p['ans'] = NerdamerCAS.decrypt(p['anse']);\n                }\n                console.log('ans decrypted ', p['anse'], p['ans']);\n                if (typeof p['ans'] === 'string') {\n                    p['ans'] = [p['ans']];\n                }\n                ans_sympy = p['ans'].map((e) => cas(e, scope));\n                if (ans_sympy.filter((e) => e == null).length > 0) {\n                    resolve({ \"qid\": p['qid'], \"correct\": -3, \"msg\": \"Error: Hi ha respostes 'ans' que no es poden processar\" });\n                    return;\n                }\n            }\n            catch (ex) {\n                console.error(ex);\n                resolve({ \"qid\": p['qid'], \"correct\": -3, \"msg\": \"Error: No es poden processar les respostes 'ans': \" + ex });\n                return;\n            }\n            //TODO case of logical check condition as answer\n            // Before performing math difference to check equality, check types\n            try {\n                const msgs = [];\n                (0, utils_1.zip)(ans_sympy, user_sympy).forEach((pair) => {\n                    const [ans_obj, parsed_input] = pair;\n                    if (is_set(ans_obj) && !is_set(parsed_input)) {\n                        msgs.push(\"S'espera un conjunt per resposta. Per exemple \\\\(\\\\{\\\\sqrt{2},\\\\, \\\\pi\\\\}\\\\)\");\n                    }\n                    else if (is_matrix(ans_obj) && !is_matrix(parsed_input)) {\n                        msgs.push(\"S'espera una matriu per resposta.\");\n                    }\n                    else if (is_interval(ans_obj) && !is_interval(parsed_input)) {\n                        msgs.push(\"S'espera un interval per resposta.\");\n                    }\n                    else if (!is_matrix(ans_obj) && is_matrix(parsed_input)) {\n                        msgs.push(\"S'espera una expressió per resposta.\");\n                    }\n                    const dims1 = is_matrix(ans_obj);\n                    const dims2 = is_matrix(parsed_input);\n                    if (dims1 && dims2) {\n                        // check if both have the same dimensions\n                        if ((dims1[0] != dims2[0]) || (dims1[1] != dims2[1])) {\n                            msgs.push(\"La matriu resposta no té la dimensió correcta.\");\n                        }\n                    }\n                });\n                if (msgs.length > 0) {\n                    resolve({ \"qid\": p['qid'], \"correct\": 0, \"msg\": msgs.join(' ') });\n                    return;\n                }\n            }\n            catch (ex) {\n                console.error(ex);\n                resolve({ \"qid\": p['qid'], \"correct\": -4, \"msg\": \"Error: S'ha produït un error comprovant els tipus \" + ex });\n                return;\n            }\n            // Check for mathematical equivalence\n            // This produces an errorr because rules passes as a list not a dict!!!!\n            //check_method = rules.get(\"method\", \"meqv\")  #support other methods numeric[0.01]\n            // TODO as_vector is not supported here\n            // Treat every element in array of answers indepently \n            let correct = 0;\n            let msg = '';\n            try {\n                (0, utils_1.zip)(ans_sympy, user_sympy).forEach((pair) => {\n                    const [ans_obj, parsed_input] = pair;\n                    console.log('Compare:: ', ans_obj.text(), parsed_input.text());\n                    // Cannot compare list and FineSet so, convert list to FiniteSet\n                    // console.log(ans_obj, parsed_input, type(ans_obj), type(parsed_input))\n                    //print('starting to compare', ans_obj, parsed_input)\n                    let expr = null;\n                    const rules = p[\"rules\"] || {};\n                    // decide if precision is set\n                    if (rules['precision']) {\n                        // Numerical equivalence within precision\n                        expr = Math.abs(ans_obj.toDecimal() - parsed_input.toDecimal()) < rules['precision'];\n                        console.log('epsilon', expr);\n                    }\n                    else {\n                        if (is_matrix(ans_obj)) {\n                            const delta = ans_obj.subtract(parsed_input);\n                            console.log('debug ', ans_obj.text(), parsed_input.text(), delta.text());\n                            expr = is_zero_matrix(delta);\n                        }\n                        else if (rules['factor'] || rules['expand']) {\n                            //This condition takes into account if expanded or not\n                            expr = ans_obj.eq(parsed_input);\n                        }\n                        else {\n                            //expr = ans_obj.eq(parsed_input)    \n                            //Check for subtraction eq 0?\n                            expr = ans_obj.subtract(parsed_input).simplify();\n                            expr = expr.text() == '0';\n                        }\n                        console.log('remainder', expr);\n                    }\n                    if (typeof expr === 'boolean' && expr === true) {\n                        // Sabem que és matemàticament equivalent\n                        correct = 1;\n                        msg = (0, I18n_1.I18n)('right_answer');\n                        /*\n                        if ('factor' in rules) and (rules['factor']==True) and (not (isinstance(parsed_input, Mul) or isinstance(parsed_input, Pow)) ):\n                            correct = 0\n                            msg = \"La resposta ha estar factoritzada.\"\n                        elif ('factor' in rules) and (rules['factor']==False) and (not isinstance(parsed_input, Add)):\n                            correct = 0\n                            msg = \"La resposta ha d'estar desenvolupada.\"\n                        */\n                    }\n                    else {\n                        msg = (0, I18n_1.I18n)('wrong_answer');\n                        correct = 0;\n                        /*\n                        if is_matrix(expr):\n                            msg = find_not_zero_element(expr)\n                        */\n                    }\n                    if (correct == 0) {\n                        return true;\n                    }\n                    // Once equality is checked, then treat the number of terms and factors as second check\n                    // Apply only for expressions of polynomial type\n                    if (rules[\"num_terms\"] && parsed_input.isPolynomial()) {\n                        const unt = parsed_input.symbols.coeffs().length;\n                        const nexpect = ans_obj.symbols.expand().coeffs().length;\n                        const nterms_diff = nexpect - unt;\n                        if (rules[\"num_terms\"] == \"equal\" && nterms_diff != 0) {\n                            msg = \"La resposta hauria de tenir \" + nexpect + \" termes sumats o restats.\";\n                            correct = 0;\n                        }\n                    }\n                    /*\n                        elif type(ans_obj) == Mul or type(ans_obj) == Pow:\n                            #Si només té un terme, comprova si està ben factoritzat\n                            # TODO: Allow arbitrary number of numeric factors. Filter only those with symbols\n                            tmp1 = list(filter(lambda e: is_symbolic(e), ans_obj.as_ordered_factors()))\n                            tmp2 = list(filter(lambda e: is_symbolic(e), parsed_input.as_ordered_factors()))\n                            nexpect =  len(tmp1)\n                            nterms_diff = nexpect - len(tmp2)\n                            if nterms_diff != 0:\n                                print(str(tmp1), str([type(e) for e in tmp1]))\n                                print(str(tmp2), str([type(e) for e in tmp2]))\n                                msg = \"La resposta hauria de contenir \"+str(nexpect)+\" factors simbòlics.\"\n                                correct = 0\n        \n                        if correct == 0:\n                            break\n                */\n                }); //end zip foreach\n            }\n            catch (err) {\n                console.error(\"Exception comparing \", err);\n                msg = (0, I18n_1.I18n)('error_verifying');\n                correct = -1;\n            }\n            console.log(\"Response:: \", correct, msg);\n            resolve({ \"qid\": p['qid'], \"correct\": correct, \"msg\": msg });\n        });\n    }\n    getAnswer(p) {\n        const cas = window.nerdamer;\n        p = NerdamerCAS.clone(p);\n        return new Promise((resolve, reject) => {\n            // Prepares local scope for evaluation\n            const scope = { 'x': cas('x'), 'y': cas('y'), 'z': cas('z'), 't': cas('t'), 'e': cas('exp(1)') };\n            //Prepares local scope for evaluation\n            try {\n                (p['symbols'] || []).forEach((symb) => {\n                    if (symb.indexOf(':=') > 0) {\n                        const pos = symb.indexOf(\":=\");\n                        const symb_name = symb.substring(0, pos);\n                        const symb_raw = symb.substring(pos + 2);\n                        cas.setVar(symb_name, symb_raw);\n                    }\n                    else {\n                        cas.setVar(symb, symb);\n                    }\n                });\n            }\n            catch (ex) {\n                console.error(ex);\n                resolve({ \"msg\": \"Error: no es poden processar els símbols: \" + ex });\n                return;\n            }\n            //TODO assume ans is str\n            if (typeof p['ans'] === 'string') {\n                const ans_sympy = cas(p['ans'], scope);\n                const ra = `${(0, I18n_1.I18n)('expected_ans')}<br> \\\\(${ans_sympy.latex()}\\\\)`;\n                resolve({ \"right_answer\": btoa(ra) });\n                return;\n            }\n            resolve({ \"msg\": \"Vector ans is not supported yet!\" });\n        });\n    }\n}\nexports.nerdamerCAS = new NerdamerCAS();\n","\"use strict\";\nObject.defineProperty(exports, \"__esModule\", { value: true });\nexports.parseLatex = void 0;\nconst pmatrix_re = /\\\\begin\\{pmatrix\\}(.*?)\\\\end\\{pmatrix\\}/gm;\nlet mcount = 0;\n// Convert a \\begin{pmatrix} a & b \\\\ c & d \\end{pmatrix} in to nermader matrix([a,b],[c,d]) \nfunction parse_pmatrix(latex) {\n    latex = latex.replace(\"\\\\begin{pmatrix}\", \"\").replace(\"\\\\end{pmatrix}\", \"\");\n    const rows = latex.split(\"\\\\\\\\\").map((row) => {\n        const cols = row.split(\"&\").map((col) => col.trim());\n        return '[' + cols.join(',') + ']';\n    });\n    const out = 'matrix(' + rows.join(',') + ')';\n    const varName = 'M_' + mcount;\n    window.nerdamer.setVar(varName, out);\n    mcount++;\n    return varName;\n}\nfunction parseLatex(tex) {\n    // Treat matrices\n    tex = tex.replace(pmatrix_re, function ($0, $1) {\n        return parse_pmatrix($0);\n    });\n    return window.nerdamer.convertFromLaTeX(tex);\n}\nexports.parseLatex = parseLatex;\n","\"use strict\";\nObject.defineProperty(exports, \"__esModule\", { value: true });\nexports.sympyCAS = void 0;\nconst globals_1 = require(\"../globals\");\nclass SympyCAS {\n    compare(payload) {\n        return new Promise((resolve, reject) => {\n            $.ajax({\n                type: \"POST\",\n                url: globals_1.cfg.CAS_URL,\n                data: JSON.stringify(payload),\n                dataType: 'json',\n                success: function (datos) {\n                    resolve(datos);\n                },\n                error: function (datos) {\n                    reject(datos);\n                }\n            });\n        });\n    }\n    getAnswer(payload) {\n        return new Promise((resolve, reject) => {\n            $.ajax({\n                type: \"POST\",\n                url: globals_1.cfg.GETANSWER_URL,\n                data: JSON.stringify(payload),\n                dataType: 'json',\n                success: function (datos) {\n                    resolve(datos);\n                },\n                error: function (datos) {\n                    reject(datos);\n                }\n            });\n        });\n    }\n}\nexports.sympyCAS = new SympyCAS();\n","\"use strict\";\nObject.defineProperty(exports, \"__esModule\", { value: true });\nexports.findPyGenerators = void 0;\nconst actions_1 = require(\"./actions\");\nconst LevelIndicator_1 = require(\"./components/LevelIndicator\");\nconst createQuill_1 = require(\"./createQuill\");\nconst globals_1 = require(\"./globals\");\nconst goalChecker_1 = require(\"./goalChecker\");\nconst I18n_1 = require(\"./I18n\");\nconst mq_parsing_1 = require(\"./mq-parsing\");\nconst seqBasic_1 = require(\"./sequences/seqBasic\");\nconst seqRandomWeighted_1 = require(\"./sequences/seqRandomWeighted\");\nconst seqSequence_1 = require(\"./sequences/seqSequence\");\nconst utils_1 = require(\"./utils\");\nfunction findPyGenerators() {\n    const IB = window['IB'] || {};\n    $(\"div[data-pygen]\").each(function (j, eg) {\n        const $eg = $(eg);\n        $eg.css({\n            \"position\": \"relative\",\n            \"min-height\": \"300px\",\n            \"background-color\": \"#ffffff\",\n            \"background-image\": 'url(\"https://piworld.es/iedib/matheditor/backgrounds/triangles.svg\")',\n            \"background-position\": \"center\",\n            \"background-size\": \"cover\"\n        });\n        $eg.html(''); //clear the container  \n        let gid = $eg.attr(\"id\") || '';\n        if (!gid) {\n            gid = 'pyg_' + Math.random().toString(32).substring(2);\n            $eg.attr(\"id\", gid);\n        }\n        globals_1.shared[gid] = {}; //This container will contain the instance of the qid in every screen\n        // Create the layout of this container\n        // Shoud have a top banner for level and message\n        // central panel for qüestion and displaying the mathinput\n        // bottom panel for control buttons\n        const topPanel = $('<div style=\"display:flex;flex-direction:row-reverse;align-items:baseline;\"></div>');\n        const centralPanel = $(\"<div></div>\");\n        const bottomPanel = $('<div style=\"display: flex; flex-direction: row; align-content: flex-start;margin:10px 0; flex-wrap: wrap; gap: 5px;margin-bottom:30px;\"></div>');\n        const copyrightPanel = $('<div style=\"position: absolute;left: 0;right: 0;bottom: 0;margin: 0;background-color: #9fa0ac; display: flex; flex-direction: row; align-content: flex-start; flex-wrap: wrap; gap: 5px;\"></div>');\n        const levelIndicator = new LevelIndicator_1.LevelIndicator(4);\n        const category = $eg.attr(\"data-pygen-category\") || \"general\"; //category to check the level of the student\n        //Only show the indicator if data-category is set\n        levelIndicator.setVisible(globals_1.cfg.HAS_IAPACE && $eg.attr(\"data-pygen-category\") != null);\n        topPanel.append(levelIndicator.container);\n        //try to find the category in iapace (only if available)\n        let currentLevel = 1;\n        if (globals_1.cfg.HAS_IAPACE) {\n            currentLevel = IB.iapace.inference(category);\n        }\n        levelIndicator.setLevel(currentLevel);\n        //Goal checker\n        let goalChecker = null;\n        if (globals_1.cfg.HAS_IAPACE && $eg.attr(\"data-pygen-goal\") != null) {\n            const goalRulesRaw = ($eg.attr(\"data-pygen-goal\") || '').split(\";\");\n            const goalRules = goalRulesRaw.map(function (e) { return e.split(\",\"); });\n            goalChecker = new goalChecker_1.GoalChecker(category, goalRules);\n            if (goalChecker.accomplished()) {\n                //Indicator that the goal is already reached\n                topPanel.append($('<span class=\"pw-goal-reached\">' + (0, I18n_1.I18n)('goal_reached') + ' </span>'));\n            }\n        }\n        // Format \"name.of.generador.function1;name.of.generator.function2[param1=a, param2='b', param3='c'];···\"\n        const rawDataPygens = ($eg.attr('data-pygen') || '').split(';');\n        const dataPygen = [];\n        for (let z = 0, lenz = rawDataPygens.length; z < lenz; z++) {\n            const genpart = rawDataPygens[z];\n            let genname = null;\n            const genparams = {};\n            if (genpart.indexOf('[') > 0) {\n                genname = genpart.split('[')[0].trim();\n                const paramspart = genpart.split('[')[1].replace(']', '').split(',');\n                for (let t = 0, lent = paramspart.length; t < lent; t++) {\n                    const aparm = paramspart[t];\n                    if (aparm.indexOf(\"=\") > 0) {\n                        const param_parts = aparm.split(\"=\");\n                        const key = param_parts[0];\n                        let value = param_parts[1];\n                        if (value.indexOf(\"'\") >= 0) {\n                            // As string\n                            value = value.replace(/'/g, '');\n                        }\n                        else {\n                            // As float\n                            value = parseFloat(value);\n                        }\n                        genparams[key] = value;\n                    }\n                }\n            }\n            else {\n                genname = genpart.trim();\n            }\n            if (Object.keys(genparams).length) {\n                dataPygen.push([genname, genparams]);\n            }\n            else {\n                dataPygen.push([genname]);\n            }\n        }\n        // Decide if to use a sequenciador?\n        let sequenciador = new seqBasic_1.SeqBasic(dataPygen);\n        if (dataPygen.length > 1) {\n            // Yes\n            const order = ($eg.attr(\"data-pygen-order\") || \"random\").trim().toLowerCase();\n            if (order.startsWith(\"random\") || order.startsWith(\"weighted\")) {\n                sequenciador = new seqRandomWeighted_1.SeqRandomWeighted(dataPygen, order);\n            }\n            else if (order.startsWith(\"sequence\")) {\n                sequenciador = new seqSequence_1.SeqSequence(dataPygen, order);\n            }\n        }\n        // Check this question\n        const checkBtn = $('<button class=\"btn btn-sm btn-primary\"><i class=\"fas fa-check\"></i> ' + (0, I18n_1.I18n)('check') + '</button>');\n        const comodiBtn = $('<button class=\"btn btn-sm btn-warning\" style=\"display:none;\"><i class=\"far fa-life-ring\"></i> ' + (0, I18n_1.I18n)('wildcard') + ' 50%</button>');\n        let currentDatos = null;\n        let currentEditor = null;\n        const createDynamicMathquill = function () {\n            checkBtn.prop(\"disabled\", true);\n            nextButton.prop(\"disabled\", true);\n            showmeBtn.prop(\"disabled\", true);\n            comodiBtn.css(\"display\", \"none\");\n            // Dynamically generate the level here!\n            if (globals_1.cfg.HAS_IAPACE) {\n                currentLevel = IB.iapace.inference(category);\n            }\n            else {\n                //TODO\n            }\n            console.log(\"xivat\", category, currentLevel);\n            levelIndicator.setLevel(currentLevel);\n            const nextGenerator = sequenciador.next();\n            $.ajax({\n                type: \"POST\",\n                url: globals_1.cfg.PYGEN_URL,\n                data: JSON.stringify({ \"activities\": [nextGenerator], \"level\": currentLevel }),\n                dataType: 'json',\n                success: function (datos) {\n                    console.log(\"xivato\", datos);\n                    if (datos.msg) {\n                        currentDatos = null;\n                        //Show error message\n                        centralPanel.html('<p style=\"color:darkred\">ERROR<br>' + JSON.stringify(datos.msg) + '</p>');\n                        console.error(\"ERROR: \", datos);\n                        nextButton.prop(\"disabled\", false);\n                        return;\n                    }\n                    //remove contents central panel\n                    centralPanel.html('');\n                    // TODO: create the dynamic element\n                    const pregunta = $('<p><span>' + ($eg.attr('data-pygen-formulation') || '') + '</span> ' + datos.formulation + '</p>');\n                    centralPanel.append(pregunta);\n                    //TODO: How to create the input widget eficienty \n                    //const dynEl = $('<span data-mq=\"'+ datos.mq64 +'\"></span>');\n                    //$eg.append(dynEl);\n                    const json_raw = atob(datos.mq64);\n                    const json_obj = JSON.parse(json_raw);\n                    //check if contains a comodi \n                    //TODO: decide if can use the comodi based on performance\n                    if (globals_1.cfg.HAS_IAPACE) {\n                        const frame = IB.iapace.findCreate(category);\n                        if (frame) {\n                            if ((0, utils_1.sum)(frame.h) >= 30) {\n                                console.log(\"Super! Has conseguit un comodí\");\n                                comodiBtn.css(\"display\", json_obj.comodi == null ? \"none\" : \"\");\n                            }\n                        }\n                    }\n                    json_obj.category = category;\n                    if (!json_obj.palettes) {\n                        //use all palettes if not defined\n                        json_obj.palettes = 'all';\n                    }\n                    // convert qtype.M (combo) to qtype.Ms (radios)\n                    if (json_obj.editor == globals_1.cfg.QTYPES.M) {\n                        json_obj.editor = globals_1.cfg.QTYPES.Ms;\n                    }\n                    currentDatos = json_obj;\n                    if (json_obj.initial_latex) {\n                        json_obj.initial_latex = (0, mq_parsing_1.processMqIni)(json_obj.initial_latex);\n                    }\n                    const symbols = [];\n                    if (json_obj.symbols) {\n                        const parts = json_obj.symbols.split(\";\");\n                        for (let r = 0, lenr = parts.length; r < lenr; r++) {\n                            const epart = parts[r];\n                            if (epart.trim()) {\n                                symbols.push(epart.trim());\n                            }\n                        }\n                    }\n                    json_obj.symbols = symbols;\n                    let rules = [];\n                    if (json_obj.rules) {\n                        rules = JSON.parse(json_obj.rules);\n                    }\n                    json_obj.rules = rules;\n                    // It should obtain category from here?\n                    console.log(json_obj);\n                    const qid = (0, createQuill_1.createQuillFromObject)(centralPanel, gid, json_obj);\n                    currentEditor = globals_1.shared[gid][qid];\n                    currentEditor.isPigen = true; //Marker that is dynamically generated for pigen\n                    //TODO can support many quills\n                    checkBtn.off();\n                    const extraActions = function (score10) {\n                        nextButton.prop(\"disabled\", false);\n                        showmeBtn.prop(\"disabled\", false);\n                        if (globals_1.cfg.HAS_IAPACE) {\n                            IB.iapace.addScore(category, score10);\n                            IB.iapace.save(); //Persistent storage\n                        }\n                        //TODO lunch confetti if succeded\n                        if (goalChecker && goalChecker.reached()) {\n                            if (topPanel.find(\".pw-goal-reached\").length == 0) {\n                                topPanel.append($('<span class=\"pw-goal-reached\">' + (0, I18n_1.I18n)('goal_reached') + ' </span>'));\n                            }\n                            //celebration?\n                            if ($eg.attr(\"data-pygen-celebration\") == 'confetti' && window.Confetti) {\n                                const c = new window.Confetti($eg[0]);\n                                c.play();\n                            }\n                        }\n                    };\n                    (0, actions_1.bindSubmitActionButton)(gid, checkBtn, extraActions);\n                    console.log(globals_1.shared[gid]);\n                    (0, utils_1.reflowLatex)();\n                    checkBtn.prop(\"disabled\", false);\n                    // Create the same element as a group\n                    //$eg.addClass(\"pw-mq-group\");\n                    //findQuillGroups($eg.parent());\n                },\n                error: function (datos) {\n                    currentDatos = null;\n                    currentEditor = null;\n                    console.log(\"error\", datos);\n                    centralPanel.html('<div><p style=\"color:darkred\">ERROR<br>' + JSON.stringify(datos) + '</p></div>');\n                    nextButton.prop(\"disabled\", false);\n                }\n            });\n        };\n        // Reveal answer to this question\n        const showmeBtn = $('<button class=\"btn btn-sm btn-outline-info\" title=\"Mostra la resposta\"><i class=\"fas fa-question-circle\"></i> ' + (0, I18n_1.I18n)('answer') + '</button>');\n        showmeBtn.on('click', function (ev) {\n            ev.preventDefault();\n            if (!currentEditor) {\n                console.error(\"Missing currentEditor here :-(\");\n                return;\n            }\n            if (currentEditor.status != globals_1.cfg.STATUS.CORRECT && currentEditor.wrong_attemps < 1) {\n                console.log(\"can't show answer yet\", currentEditor);\n                return;\n            }\n            checkBtn.prop(\"disabled\", true);\n            showmeBtn.prop(\"disabled\", true);\n            console.log(currentEditor);\n            currentEditor.showAnswer && currentEditor.showAnswer();\n        });\n        // Skip this question\n        const nextButton = $('<button class=\"btn btn-sm btn-outline-primary\" title=\"Genera una nova pregunta\"><i class=\"fas fa-arrow-circle-right\"></i> ' + (0, I18n_1.I18n)('next') + '</button>');\n        nextButton.on('click', function (ev) {\n            ev.preventDefault();\n            // Remove existing widgets from this gid\n            const keys = Object.keys(globals_1.shared[gid] || {});\n            for (let i = 0, lin = keys.length; i < lin; i++) {\n                const qid = parseInt(keys[i]);\n                globals_1.shared[gid][qid].dispose();\n                delete globals_1.shared[gid][qid];\n            }\n            createDynamicMathquill();\n        });\n        comodiBtn.on('click', function (ev) {\n            ev.preventDefault();\n            if (!currentEditor || !currentDatos || !currentDatos.comodi) {\n                return;\n            }\n            currentEditor.comodiUsed = true;\n            comodiBtn.css(\"display\", \"none\");\n            currentEditor.latex(currentDatos.comodi);\n            // Mark editor as changed to enable evaluation\n            currentEditor.status = globals_1.cfg.STATUS.MODIFIED;\n        });\n        bottomPanel.append(checkBtn);\n        bottomPanel.append(nextButton);\n        bottomPanel.append(showmeBtn);\n        bottomPanel.append(comodiBtn);\n        $eg.append(topPanel);\n        $eg.append(centralPanel);\n        $eg.append(bottomPanel);\n        if ($eg.attr(\"data-copyright\") != \"none\") {\n            // Mostra la barra de copyright\n            const ccSpan = $('<span style=\"padding:4px;font-size:70%;color:whitesmoke;\"><em>pyQuizz</em> by Josep Mulet (c) 2021-22</span>');\n            copyrightPanel.append(ccSpan);\n            $eg.append(copyrightPanel);\n        }\n        createDynamicMathquill();\n    });\n}\nexports.findPyGenerators = findPyGenerators;\n;\n","\"use strict\";\nObject.defineProperty(exports, \"__esModule\", { value: true });\nexports.sharedContext = exports.sharedDlg = exports.shared = exports.MathField = exports.StaticMath = exports.cfg = void 0;\nconst utils_1 = require(\"./utils\");\n/**\n * Extracts useful information from the current Moodle page\n * @returns\n */\nconst parseUrlParams = function (url) {\n    const params = {};\n    const parts = url.substring(1).split('&');\n    for (let i = 0; i < parts.length; i++) {\n        const nv = parts[i].trim().split('=');\n        if (!nv[0])\n            continue;\n        if (nv.length == 1) {\n            params[nv[0]] = '1';\n        }\n        else {\n            params[nv[0]] = nv[1];\n        }\n    }\n    return params;\n};\n// Change june2020: Allow guest user detection\n// Change july2020: isTeacher, chapterid --> boost detection\nconst loadPageInfo = function () {\n    var _a, _b;\n    if (!document.querySelector) {\n        return {};\n    }\n    // Get current user information\n    let userId = -1;\n    let userFullname = \"Usuari convidat\";\n    const dataUserId = document.querySelector('[data-userid]');\n    if (dataUserId) {\n        userId = parseInt(dataUserId.getAttribute('data-userid') || '-1');\n    }\n    const userText = document.querySelector(\".usertext\");\n    if (userText) {\n        userFullname = userText.innerText;\n    }\n    // Get information about book id and chapter id (from the current url)\n    let params = {};\n    if (location.search) {\n        params = parseUrlParams(location.search);\n    }\n    let chapterId = params[\"chapterid\"];\n    if (!chapterId) {\n        // On first page, chapterid might not appear\n        // Case on boost\n        const ele = document.querySelector('input[name=\"chapterid\"]');\n        if (ele) {\n            chapterId = ele.value;\n        }\n    }\n    let bookId = params.id;\n    if (!bookId) {\n        const ele = document.querySelector('div.singlebutton > form > input[name=\"id\"]');\n        if (ele) {\n            bookId = ele.value;\n        }\n    }\n    // Get cookie for MoodleSession\n    //const moodleSession = (document.cookie || \"\").split(\"MoodleSession=\")[1];\n    //moodleSession = moodleSession.split(\";\")[0];\n    let cookie = (document.cookie || \"\");\n    let eq_cookie_pos = cookie.indexOf(\"=\");\n    let moodleSession = \"\";\n    if (eq_cookie_pos > 0) {\n        moodleSession = cookie.substr(eq_cookie_pos + 1);\n    }\n    if (moodleSession && moodleSession.indexOf(\";\") > 0) {\n        moodleSession = moodleSession.split(\";\")[0];\n    }\n    // Get information about the course\n    let courseId = \"-1\";\n    let courseName;\n    const footer = document.querySelector(\".homelink > a\");\n    if (footer) {\n        courseName = footer.innerText;\n        const hrefVal = \"?\" + (footer.href.split(\"?\")[1] || \"\");\n        courseId = parseUrlParams(hrefVal).id;\n    }\n    const isTeacher = document.querySelector('.teacherdash.nav-item.nav-link') != null ? 1 : 0;\n    const site = (location.href.split(\"?\")[0] || \"\").replace(\"/mod/book/view.php\", \"\");\n    return {\n        userId: userId,\n        userFullname: userFullname,\n        bookId: bookId,\n        chapterId: chapterId,\n        assignNum: ((_a = window.iedibAPI) === null || _a === void 0 ? void 0 : _a.lliurament.id) || 0,\n        assignName: ((_b = window.iedibAPI) === null || _b === void 0 ? void 0 : _b.lliurament.title) || \"\",\n        courseName: courseName,\n        courseId: courseId,\n        isTeacher: isTeacher,\n        site: site,\n        moodleSession: moodleSession\n    };\n};\n// Decide from where to load resources\nwindow.MQWidgets = window.MQWidgets || {};\n// Default values if not specified at initialization\n// https://piworld.es/mqwdemo/api/\nclass Cfg {\n    constructor() {\n        this.DEFAULT_ENGINE = \"sympy\";\n        this.NERDAMER_URL = \"https://cdn.jsdelivr.net/npm/nerdamer@1.1.13/all.min.js\";\n        this.BACKEND_BASEURL = \"\";\n        this.MQWIDGETS_BASEURL = \"https://iedib.github.io/mqwidgets2/dist/\";\n        this.pageInfo = loadPageInfo();\n        this.STATUS = {\n            UNMODIFIED: 100,\n            MODIFIED: 200,\n            CORRECT: 1,\n            WRONG: 0\n        };\n        this.QTYPES = {\n            S: 'simple',\n            B: 'basic',\n            C: 'cloze',\n            P: 'panel',\n            M: 'mchoice',\n            Ms: 'mchoice*' // multiple choice radio, checkbox\n        };\n        this.HAS_IAPACE = window[\"IB\"] != null && (window[\"IB\"].iapace != null);\n        this.LANG = '';\n        this.RIGHT_ICON = 'fas fa-check'; //'far fa-smile'; //   \n        this.WRONG_ICON = 'fas fa-times'; //'far fa-dizzy'; //\n        this.MAX_ATTEMPTS = 2; // Maximum number of wrong attempts before showing right answer\n    }\n    get CAS_URL() {\n        return (0, utils_1.urlJoin)(this.BACKEND_BASEURL, \"compare\");\n    }\n    get PYGEN_URL() {\n        return (0, utils_1.urlJoin)(this.BACKEND_BASEURL, \"generate\");\n    }\n    get GETANSWER_URL() {\n        return (0, utils_1.urlJoin)(this.BACKEND_BASEURL, \"getanswer\");\n    }\n    get MATHQUILL_URL() {\n        return (0, utils_1.urlJoin)(this.MQWIDGETS_BASEURL, \"/lib/mathquill.matrix.min.js\");\n    }\n    setUserConfig(uc) {\n        if (uc.engines[0] == 'nerdamer') {\n            this.DEFAULT_ENGINE = 'nerdamer';\n        }\n        const remotes = uc.engines.filter((e) => e.trim().startsWith(\"http\"));\n        if (remotes.length) {\n            this.BACKEND_BASEURL = remotes[0];\n        }\n        if (uc.lang) {\n            this.LANG = uc.lang;\n        }\n        if (uc.mqwBaseurl) {\n            this.MQWIDGETS_BASEURL = uc.mqwBaseurl;\n        }\n    }\n    isNerdamer() {\n        return window.nerdamer != null;\n    }\n}\nexports.cfg = new Cfg();\n// Lazy load (it might no be loaded yet)\nlet MQI = {};\nfunction StaticMath(div) {\n    if (!MQI.StaticMath) {\n        MQI = window.MathQuill.getInterface(2);\n    }\n    return MQI.StaticMath(div);\n}\nexports.StaticMath = StaticMath;\nfunction MathField(div, config) {\n    if (!MQI.MathField) {\n        MQI = window.MathQuill.getInterface(2);\n    }\n    return MQI.MathField(div, config);\n}\nexports.MathField = MathField;\nexports.shared = {};\nexports.sharedDlg = {};\nexports.sharedContext = {};\n","\"use strict\";\nObject.defineProperty(exports, \"__esModule\", { value: true });\nexports.GoalChecker = void 0;\nconst globals_1 = require(\"./globals\");\nclass GoalChecker {\n    constructor(category, rules) {\n        this.category = category;\n        this.rules = rules;\n    }\n    accomplished(value) {\n        const IB = window[\"IB\"] || {};\n        if (!globals_1.cfg.HAS_IAPACE) {\n            return false;\n        }\n        //getter\n        if (!value) {\n            const frame = IB.iapace.find(this.category);\n            if (frame == null) {\n                return false;\n            }\n            return frame.d; //done flag in tree\n        }\n        //setter\n        const frame = IB.iapace.findCreate(this.category);\n        frame.d = value;\n        IB.iapace.save();\n        return value;\n    }\n    reached() {\n        const IB = window[\"IB\"] || {};\n        if (!globals_1.cfg.HAS_IAPACE) {\n            return false;\n        }\n        if (this.accomplished()) {\n            return false;\n        }\n        const frame = IB.iapace.findCreate(this.category);\n        let reach = false;\n        const nrules = this.rules.length;\n        let i = 0;\n        while (!reach && i < nrules) {\n            let partial = true;\n            const crule = this.rules[i];\n            let undecided = 0;\n            if (isNaN(crule[0])) {\n                undecided += 1;\n            }\n            else {\n                //Num. questions done on category\n                partial = partial && (frame.n >= parseInt(crule[0]));\n            }\n            if (isNaN(crule[1])) {\n                undecided += 1;\n            }\n            else {\n                //Average grade\n                let grade = 0.0;\n                if (frame.n > 0) {\n                    grade = frame.s / (1.0 * frame.n);\n                }\n                partial = partial && (grade >= parseFloat(crule[1]));\n            }\n            if (isNaN(crule[2])) {\n                undecided += 1;\n            }\n            else {\n                //current level\n                partial = partial && (IB.iapace.inference(this.category) >= parseInt(crule[2]));\n            }\n            if (undecided < 3) {\n                reach = partial;\n            }\n            i += 1;\n        }\n        if (reach) {\n            this.accomplished(true);\n        }\n        return reach;\n    }\n}\nexports.GoalChecker = GoalChecker;\n","\"use strict\";\nObject.defineProperty(exports, \"__esModule\", { value: true });\nexports.createQuillFromDataAttr = exports.processMqIni = void 0;\nconst createQuill_1 = require(\"./createQuill\");\nconst globals_1 = require(\"./globals\");\nfunction processMqIni(ini) {\n    ini = ini || '';\n    ini = ini.replace(/\\?\\d*?/g, '\\\\MathQuillMathField{}');\n    ini = ini.replace(/M\\[(\\d+)x(\\d+)\\]/g, function ($0, $1, $2) {\n        const nrows = parseInt($1);\n        const ncols = parseInt($2);\n        const mtex = [];\n        const aRow = new Array(ncols);\n        for (let i = 0; i < nrows; i++) {\n            mtex.push(aRow.join(' & '));\n        }\n        return '\\\\begin{pmatrix} ' + mtex.join(' \\\\\\\\ ') + ' \\\\end{pmatrix}';\n    });\n    return ini;\n}\nexports.processMqIni = processMqIni;\nfunction createQuillFromDataAttr($el, gid) {\n    const qtype = $el.attr(\"data-mq\") || 'simple';\n    const engine = $el.attr(\"data-mq-engine\");\n    let ans = $el.attr(\"data-mq-ans\");\n    // If not ans then it cannot be checked, so.\n    let ansType = 'ans';\n    if (!ans) {\n        ans = $el.attr(\"data-mq-anse\");\n        ansType = 'anse';\n        if (!ans) {\n            console.error(\"> MQ has no data-mq-ans/e!\");\n            return;\n        }\n    }\n    // Support arrays in answers (always as str)\n    ans = ans.trim();\n    if (ans.startsWith('[') && ans.endsWith(']')) {\n        ans = JSON.parse(ans);\n        for (let kk = 0, lenkk = ans.length; kk < lenkk; kk++) {\n            ans[kk] = '' + ans[kk];\n        }\n    }\n    const ini = processMqIni($el.attr(\"data-mq-ini\"));\n    const symbolsRaw = $el.attr(\"data-mq-symbols\"); // a := valor; b := valor;  c := valor; \n    if (qtype === globals_1.cfg.QTYPES.C && !ini) {\n        console.error(\"> MQ \", $el, \" is of type cloze but it has no data-mq-ini!\");\n        return;\n    }\n    let ra = '';\n    if ($el.attr(\"data-mq-ra\")) {\n        // Base64 conversion\n        ra = atob($el.attr(\"data-mq-ra\") || '');\n    }\n    const symbols = [];\n    if (symbolsRaw) {\n        const parts = symbolsRaw.split(\";\");\n        for (let r = 0, lenr = parts.length; r < lenr; r++) {\n            const epart = parts[r];\n            if (epart.trim()) {\n                symbols.push(epart.trim());\n            }\n        }\n    }\n    const rulesRaw = $el.attr(\"data-mq-rules\");\n    let rules = [];\n    if (rulesRaw) {\n        rules = JSON.parse(rulesRaw);\n    }\n    let palettes = [];\n    const palettesRaw = $el.attr(\"data-mq-palettes\");\n    if (palettesRaw) {\n        const parts = palettesRaw.split(\",\");\n        parts.forEach(function (e) {\n            palettes.push(e.trim());\n        });\n    }\n    const obj = {\n        engine: engine,\n        editor: qtype,\n        symbols: symbols,\n        right_answer: ra,\n        initial_latex: ini,\n        rules: rules,\n        palettes: palettes,\n        ans: ans,\n        ansType: ansType\n    };\n    if ($el.attr(\"data-mq-formulation\")) {\n        obj.formulation = $el.attr(\"data-mq-formulation\");\n    }\n    (0, createQuill_1.createQuillFromObject)($el, gid, obj);\n}\nexports.createQuillFromDataAttr = createQuillFromDataAttr;\n;\n","\"use strict\";\nObject.defineProperty(exports, \"__esModule\", { value: true });\nexports.findQuillGroups = void 0;\nconst actions_1 = require(\"./actions\");\nconst createQuill_1 = require(\"./createQuill\");\nconst globals_1 = require(\"./globals\");\nconst mq_parsing_1 = require(\"./mq-parsing\");\nconst utils_1 = require(\"./utils\");\nconst keysDef = [\"editor\",\n    \"engine\",\n    \"formulation\",\n    \"initial_latex\",\n    \"ansType\",\n    \"ans\",\n    \"anse\",\n    \"right_answer\",\n    \"symbols\",\n    \"rules\",\n    \"palettes\"];\nconst findQuills = function ($eg, gid, widgets) {\n    // Precedence of the widgets defined throught the init method\n    if (widgets) {\n        (0, utils_1.items)(widgets, function (id, b64) {\n            //check if 'id' is found\n            const $el = $('#' + id);\n            if ($el.length) {\n                // ignore the mq attribute that might include in sucsessive parsing\n                $el.removeAttr(\"data-mq\");\n                try {\n                    const json_raw = atob(b64);\n                    const json_obj = JSON.parse(json_raw);\n                    //Make sure to process initial_latex attribute\n                    json_obj.initial_latex = (0, mq_parsing_1.processMqIni)(json_obj.initial_latex || '');\n                    (0, createQuill_1.createQuillFromObject)($el, gid, json_obj);\n                }\n                catch (ex) {\n                    console.error(\"Invalid or corrupted MQ definition:: \", b64);\n                    console.error(ex);\n                }\n            }\n            else {\n                console.error(\"The element with id=\" + id + \" does not exist.\");\n            }\n        });\n    }\n    $eg.find(\"[data-mq]\").each(function (i, el) {\n        const $el = $(el);\n        const qtype = $(el).attr(\"data-mq\") || 'simple'; //s=simple, b=basic, p=panel, c=cloze (requires data-mq-ini)\n        if ((0, utils_1.hasValue)(globals_1.cfg.QTYPES, qtype)) {\n            //create from data-attributes\n            console.error(\"Definition via data-attributes in deprecated since version 2.0. \"\n                + \"Please encode the definition in a single data-mq field.\");\n            (0, mq_parsing_1.createQuillFromDataAttr)($el, gid);\n        }\n        else {\n            // Assume that everything is encoded in data-mq atribute\n            // Use the MQ-editor online\n            try {\n                const json_raw = atob(qtype);\n                let json_obj = {};\n                const parsedDef = JSON.parse(json_raw);\n                // if json_obj is an array, then we should parse it to an object\n                if (Array.isArray(parsedDef)) {\n                    if (parsedDef.length < keysDef.length) {\n                        console.error(\"The definition does not contain all the fields. Is it corrupted?\");\n                    }\n                    (0, utils_1.zip)(keysDef, parsedDef).forEach((pair) => {\n                        const [key, value] = pair;\n                        json_obj[key] = value;\n                    });\n                }\n                else {\n                    json_obj = parsedDef;\n                }\n                //Make sure to process initial_latex attribute\n                json_obj.initial_latex = (0, mq_parsing_1.processMqIni)(json_obj.initial_latex || '');\n                (0, createQuill_1.createQuillFromObject)($el, gid, json_obj);\n            }\n            catch (ex) {\n                console.error(\"Invalid or corrupted MQ definition:: \", qtype);\n                console.error(ex);\n            }\n        }\n    });\n};\nfunction parseContext($eg, gid) {\n    const ctx = {}; // Hold the context of this group\n    //TODO with other properties of a group\n    globals_1.sharedContext[gid] = ctx;\n}\nfunction findQuillGroups(widgets, parent) {\n    parent = parent || $('body');\n    parent.find(\".pw-mq-group\").each(function (j, eg) {\n        const $eg = $(eg);\n        if ($eg.hasClass(\"pw-mq-done\")) {\n            return;\n        }\n        //Prevent reprocessing\n        $eg.addClass(\"pw-mq-done\");\n        let gid = $eg.attr(\"id\");\n        if (!gid) {\n            gid = 'g_' + Math.random().toString(32).substring(2);\n            $eg.attr(\"id\", gid);\n        }\n        globals_1.shared[gid] = {}; //Hold all the editors\n        parseContext($eg, gid);\n        findQuills($eg, gid, widgets);\n        const check_btn = (0, actions_1.createSubmitButtonForGroup)(gid);\n        $eg.append(check_btn);\n        // solve problem of display by redrawing\n        if (parent == null) {\n            window.setTimeout(function () {\n                (0, utils_1.items)(globals_1.shared, function (gid, groupContainer) {\n                    (0, utils_1.items)(groupContainer, function (qid, editor) {\n                        editor.reflow && editor.reflow();\n                    });\n                });\n            }, 800);\n        }\n    });\n}\nexports.findQuillGroups = findQuillGroups;\n;\n","\"use strict\";\nObject.defineProperty(exports, \"__esModule\", { value: true });\nexports.applyPolyfills = void 0;\nfunction applyPolyfills() {\n    if (!Array.prototype.forEach) {\n        Array.prototype.forEach = function forEach(callback, thisArg) {\n            if (typeof callback !== 'function') {\n                throw new TypeError(callback + ' is not a function');\n            }\n            var array = this;\n            thisArg = thisArg || this;\n            for (var i = 0, l = array.length; i !== l; ++i) {\n                callback.call(thisArg, array[i], i, array);\n            }\n        };\n    }\n    if (!Array.prototype.map) {\n        Array.prototype.map = function (callback) {\n            if (typeof callback !== 'function') {\n                throw new TypeError(callback + ' is not a function');\n            }\n            var arr = [];\n            for (var i = 0; i < this.length; i++) {\n                arr.push(callback(this[i], i, this));\n            }\n            return arr;\n        };\n    }\n    if (!Array.prototype.filter) {\n        Array.prototype.filter = function (callback) {\n            if (typeof callback !== 'function') {\n                throw new TypeError(callback + ' is not a function');\n            }\n            var arr = [];\n            for (var i = 0; i < this.length; i++) {\n                if (callback.call(this, this[i], i, this)) {\n                    arr.push(this[i]);\n                }\n            }\n            return arr;\n        };\n    }\n    if (!Array.isArray) {\n        Array.isArray = function (arg) {\n            return Object.prototype.toString.call(arg) === '[object Array]';\n        };\n    }\n    !(typeof Number.isNaN == 'function') ||\n        (Number.isNaN = function (value) {\n            return value !== null // Number(null) => 0\n                && (value != value // NaN != NaN\n                    || +value != value // Number(falsy) => 0 && falsy == 0...\n                );\n        });\n}\nexports.applyPolyfills = applyPolyfills;\n","\"use strict\";\nObject.defineProperty(exports, \"__esModule\", { value: true });\nexports.SeqBasic = void 0;\nclass SeqBasic {\n    constructor(lpygens) {\n        this.lpygens = lpygens;\n    }\n    next() {\n        return this.lpygens[0];\n    }\n}\nexports.SeqBasic = SeqBasic;\n","\"use strict\";\nObject.defineProperty(exports, \"__esModule\", { value: true });\nexports.SeqRandomWeighted = void 0;\nconst utils_1 = require(\"../utils\");\nconst seqBasic_1 = require(\"./seqBasic\");\nclass SeqRandomWeighted extends seqBasic_1.SeqBasic {\n    constructor(lpygens, definition) {\n        super(lpygens);\n        definition = (definition || \"random\").trim().toLowerCase();\n        this.definition = definition;\n        let weights = [];\n        if (definition.startsWith(\"weighted:\")) {\n            definition = definition.replace(\"weighted:\", \"\");\n            const parts = definition.split(\",\");\n            weights = parts.map(function (e) { return parseFloat(e); });\n        }\n        else {\n            //Assume equally distributed\n            const vran = 1.0 / lpygens.length;\n            for (let i = 0, len = lpygens.length; i < len; i++) {\n                weights.push(vran);\n            }\n        }\n        this.lpygens = lpygens;\n        //fix the problem of wrong length\n        if (this.lpygens.length > weights.length) {\n            console.log(\"SeqRandomWeighted:: lpygens and weights have different length\");\n            while (this.lpygens != weights.length) {\n                weights.push(1.0);\n            }\n        }\n        while (weights.length > lpygens.length) {\n            weights.pop();\n        }\n        //Normalize and aggregate weigths\n        const total = (0, utils_1.sum)(weights);\n        let old = 0.0;\n        weights.forEach(function (w, i) {\n            w = w / total;\n            old = w + old;\n            weights[i] = old;\n        });\n        this.weights = weights;\n    }\n    ;\n    next() {\n        //Optimization\n        if (this.definition == 'random') {\n            const pos = Math.floor(Math.random() * this.lpygens.length);\n            return this.lpygens[pos];\n        }\n        const rnd = Math.random();\n        let pos = 0;\n        let val = this.weights[pos];\n        while (val < rnd) {\n            pos += 1;\n            val = this.weights[pos];\n        }\n        return this.lpygens[pos];\n    }\n}\nexports.SeqRandomWeighted = SeqRandomWeighted;\n","\"use strict\";\nObject.defineProperty(exports, \"__esModule\", { value: true });\nexports.SeqSequence = void 0;\nconst utils_1 = require(\"../utils\");\nconst seqBasic_1 = require(\"./seqBasic\");\nconst seqRandomWeighted_1 = require(\"./seqRandomWeighted\");\nclass SeqSequence extends seqBasic_1.SeqBasic {\n    constructor(lpygens, definition) {\n        super(lpygens);\n        this.lpygens = lpygens;\n        definition = definition.replace(\"sequence:\", \"\").trim().toLowerCase();\n        this.positions = [];\n        this.terminalGen = undefined;\n        const placeholders = definition.split(\",\");\n        const self = this;\n        placeholders.forEach(function (p, i) {\n            if ((0, utils_1.isNumeric)(p) && self.terminalGen == null) {\n                const e = parseInt(p);\n                for (let k = 0; k < e; k++) {\n                    self.positions.push(i);\n                }\n            }\n            else if (p.startsWith('*') && self.terminalGen == null) {\n                //all the remaining lpygens are *\n                //Apply weights!!!!\n                const remainingLpygens = lpygens.slice(i);\n                const def2 = [];\n                let isWeighted = false;\n                for (let k = i; k < placeholders.length; k++) {\n                    let e2 = placeholders[k];\n                    if (e2.indexOf(\"*\") >= 0 && e2.indexOf(\"(\") > 0) {\n                        e2 = e2.replace(\"*\", \"\").replace(\"(\", \"\").replace(\")\", \"\");\n                        def2.push(parseFloat(e2));\n                        isWeighted = true;\n                    }\n                    else {\n                        def2.push(1);\n                    }\n                }\n                let typeRan = \"random\";\n                if (isWeighted) {\n                    typeRan = \"weighted: \" + def2.join(\",\");\n                }\n                self.terminalGen = new seqRandomWeighted_1.SeqRandomWeighted(remainingLpygens, typeRan);\n            }\n        });\n        this.pointer = 0;\n    }\n    ;\n    next() {\n        if (this.pointer >= this.positions.length && this.terminalGen) {\n            return this.terminalGen.next();\n        }\n        this.pointer = this.pointer % this.positions.length;\n        const indx = this.positions[this.pointer];\n        this.pointer += 1;\n        return this.lpygens[indx];\n    }\n}\nexports.SeqSequence = SeqSequence;\n","\"use strict\";\nObject.defineProperty(exports, \"__esModule\", { value: true });\nexports.urlJoin = exports.isNumeric = exports.createLinkSheet = exports.createStyleSheet = exports.insertScript = exports.MD5 = exports.copyPropsFromTo = exports.hasValue = exports.zip = exports.items = exports.sum = exports.sanitizeLaTeX = exports.reflowLatex = void 0;\nfunction reflowLatex() {\n    if (window.MathJax) {\n        window.MathJax.typesetPromise && window.MathJax.typesetPromise();\n        window.MathJax.Hub && window.MathJax.Hub.Queue && window.MathJax.Hub.Queue([\"Typeset\", MathJax.Hub]);\n    }\n}\nexports.reflowLatex = reflowLatex;\nfunction sanitizeLaTeX(tex) {\n    return tex.replace(/·/g, '*');\n}\nexports.sanitizeLaTeX = sanitizeLaTeX;\nfunction sum(iter) {\n    let total = 0;\n    for (let i = 0, len = iter.length; i < len; i++) {\n        total += iter[i];\n    }\n    return total;\n}\nexports.sum = sum;\n;\nfunction items(obj, cb) {\n    if (Array.isArray(obj)) {\n        for (var i = 0, len = obj.length; i < len; i++) {\n            cb(i, obj[i]);\n        }\n    }\n    else {\n        var keys = Object.keys(obj);\n        for (var i = 0, len = keys.length; i < len; i++) {\n            var key = keys[i];\n            cb(key, obj[key]);\n        }\n    }\n}\nexports.items = items;\nfunction zip(l1, l2) {\n    const n = Math.min(l1.length, l2.length);\n    const l = [];\n    for (let i = 0; i < n; i++) {\n        l.push([l1[i], l2[i]]);\n    }\n    return l;\n}\nexports.zip = zip;\nfunction hasValue(dict, target) {\n    let found = false;\n    const keys = Object.keys(dict);\n    let i = 0;\n    while (!found && i < keys.length) {\n        const k = keys[i];\n        found = (dict[k] == target);\n        i++;\n    }\n    return found;\n}\nexports.hasValue = hasValue;\nfunction copyPropsFromTo(source, target) {\n    var props = Object.keys(source);\n    for (var i = 0, len = props.length; i < len; i++) {\n        var prop = props[i];\n        target[prop] = source[prop];\n    }\n}\nexports.copyPropsFromTo = copyPropsFromTo;\nfunction MD5(d) { var r = M(V(Y(X(d), 8 * d.length))); return r.toLowerCase(); }\nexports.MD5 = MD5;\n;\nfunction M(d) { for (var _, m = \"0123456789ABCDEF\", f = \"\", r = 0; r < d.length; r++)\n    _ = d.charCodeAt(r), f += m.charAt(_ >>> 4 & 15) + m.charAt(15 & _); return f; }\nfunction X(d) { for (var _ = Array(d.length >> 2), m = 0; m < _.length; m++)\n    _[m] = 0; for (m = 0; m < 8 * d.length; m += 8)\n    _[m >> 5] |= (255 & d.charCodeAt(m / 8)) << m % 32; return _; }\nfunction V(d) { for (var _ = \"\", m = 0; m < 32 * d.length; m += 8)\n    _ += String.fromCharCode(d[m >> 5] >>> m % 32 & 255); return _; }\nfunction Y(d, _) { d[_ >> 5] |= 128 << _ % 32, d[14 + (_ + 64 >>> 9 << 4)] = _; for (var m = 1732584193, f = -271733879, r = -1732584194, i = 271733878, n = 0; n < d.length; n += 16) {\n    var h = m, t = f, g = r, e = i;\n    f = md5_ii(f = md5_ii(f = md5_ii(f = md5_ii(f = md5_hh(f = md5_hh(f = md5_hh(f = md5_hh(f = md5_gg(f = md5_gg(f = md5_gg(f = md5_gg(f = md5_ff(f = md5_ff(f = md5_ff(f = md5_ff(f, r = md5_ff(r, i = md5_ff(i, m = md5_ff(m, f, r, i, d[n + 0], 7, -680876936), f, r, d[n + 1], 12, -389564586), m, f, d[n + 2], 17, 606105819), i, m, d[n + 3], 22, -1044525330), r = md5_ff(r, i = md5_ff(i, m = md5_ff(m, f, r, i, d[n + 4], 7, -176418897), f, r, d[n + 5], 12, 1200080426), m, f, d[n + 6], 17, -1473231341), i, m, d[n + 7], 22, -45705983), r = md5_ff(r, i = md5_ff(i, m = md5_ff(m, f, r, i, d[n + 8], 7, 1770035416), f, r, d[n + 9], 12, -1958414417), m, f, d[n + 10], 17, -42063), i, m, d[n + 11], 22, -1990404162), r = md5_ff(r, i = md5_ff(i, m = md5_ff(m, f, r, i, d[n + 12], 7, 1804603682), f, r, d[n + 13], 12, -40341101), m, f, d[n + 14], 17, -1502002290), i, m, d[n + 15], 22, 1236535329), r = md5_gg(r, i = md5_gg(i, m = md5_gg(m, f, r, i, d[n + 1], 5, -165796510), f, r, d[n + 6], 9, -1069501632), m, f, d[n + 11], 14, 643717713), i, m, d[n + 0], 20, -373897302), r = md5_gg(r, i = md5_gg(i, m = md5_gg(m, f, r, i, d[n + 5], 5, -701558691), f, r, d[n + 10], 9, 38016083), m, f, d[n + 15], 14, -660478335), i, m, d[n + 4], 20, -405537848), r = md5_gg(r, i = md5_gg(i, m = md5_gg(m, f, r, i, d[n + 9], 5, 568446438), f, r, d[n + 14], 9, -1019803690), m, f, d[n + 3], 14, -187363961), i, m, d[n + 8], 20, 1163531501), r = md5_gg(r, i = md5_gg(i, m = md5_gg(m, f, r, i, d[n + 13], 5, -1444681467), f, r, d[n + 2], 9, -51403784), m, f, d[n + 7], 14, 1735328473), i, m, d[n + 12], 20, -1926607734), r = md5_hh(r, i = md5_hh(i, m = md5_hh(m, f, r, i, d[n + 5], 4, -378558), f, r, d[n + 8], 11, -2022574463), m, f, d[n + 11], 16, 1839030562), i, m, d[n + 14], 23, -35309556), r = md5_hh(r, i = md5_hh(i, m = md5_hh(m, f, r, i, d[n + 1], 4, -1530992060), f, r, d[n + 4], 11, 1272893353), m, f, d[n + 7], 16, -155497632), i, m, d[n + 10], 23, -1094730640), r = md5_hh(r, i = md5_hh(i, m = md5_hh(m, f, r, i, d[n + 13], 4, 681279174), f, r, d[n + 0], 11, -358537222), m, f, d[n + 3], 16, -722521979), i, m, d[n + 6], 23, 76029189), r = md5_hh(r, i = md5_hh(i, m = md5_hh(m, f, r, i, d[n + 9], 4, -640364487), f, r, d[n + 12], 11, -421815835), m, f, d[n + 15], 16, 530742520), i, m, d[n + 2], 23, -995338651), r = md5_ii(r, i = md5_ii(i, m = md5_ii(m, f, r, i, d[n + 0], 6, -198630844), f, r, d[n + 7], 10, 1126891415), m, f, d[n + 14], 15, -1416354905), i, m, d[n + 5], 21, -57434055), r = md5_ii(r, i = md5_ii(i, m = md5_ii(m, f, r, i, d[n + 12], 6, 1700485571), f, r, d[n + 3], 10, -1894986606), m, f, d[n + 10], 15, -1051523), i, m, d[n + 1], 21, -2054922799), r = md5_ii(r, i = md5_ii(i, m = md5_ii(m, f, r, i, d[n + 8], 6, 1873313359), f, r, d[n + 15], 10, -30611744), m, f, d[n + 6], 15, -1560198380), i, m, d[n + 13], 21, 1309151649), r = md5_ii(r, i = md5_ii(i, m = md5_ii(m, f, r, i, d[n + 4], 6, -145523070), f, r, d[n + 11], 10, -1120210379), m, f, d[n + 2], 15, 718787259), i, m, d[n + 9], 21, -343485551), m = safe_add(m, h), f = safe_add(f, t), r = safe_add(r, g), i = safe_add(i, e);\n} return Array(m, f, r, i); }\nfunction md5_cmn(d, _, m, f, r, i) { return safe_add(bit_rol(safe_add(safe_add(_, d), safe_add(f, i)), r), m); }\nfunction md5_ff(d, _, m, f, r, i, n) { return md5_cmn(_ & m | ~_ & f, d, _, r, i, n); }\nfunction md5_gg(d, _, m, f, r, i, n) { return md5_cmn(_ & f | m & ~f, d, _, r, i, n); }\nfunction md5_hh(d, _, m, f, r, i, n) { return md5_cmn(_ ^ m ^ f, d, _, r, i, n); }\nfunction md5_ii(d, _, m, f, r, i, n) { return md5_cmn(m ^ (_ | ~f), d, _, r, i, n); }\nfunction safe_add(d, _) { var m = (65535 & d) + (65535 & _); return (d >> 16) + (_ >> 16) + (m >> 16) << 16 | 65535 & m; }\nfunction bit_rol(d, _) { return d << _ | d >>> 32 - _; }\nfunction insertScript(url) {\n    var tag = document.createElement('script');\n    tag.src = url;\n    tag.type = \"text/javascript\";\n    tag.async = true;\n    const p = new Promise((resolve, reject) => {\n        tag.onload = function () {\n            resolve();\n        };\n        tag.onerror = function () {\n            reject();\n        };\n        tag.onabort = function () {\n            reject();\n        };\n    });\n    document.head.appendChild(tag);\n    return p;\n}\nexports.insertScript = insertScript;\nfunction createStyleSheet(src, id) {\n    if (id && document.getElementById(id)) {\n        return;\n    }\n    var style = document.createElement('style');\n    style.innerHTML = src;\n    if (id) {\n        style.id = id;\n    }\n    document.getElementsByTagName('head')[0].appendChild(style);\n}\nexports.createStyleSheet = createStyleSheet;\nfunction createLinkSheet(href, id) {\n    var link = document.createElement('link');\n    link.rel = 'stylesheet';\n    link.type = 'text/css';\n    link.href = href;\n    document.getElementsByTagName('head')[0].appendChild(link);\n}\nexports.createLinkSheet = createLinkSheet;\nfunction isNumeric(str) {\n    return (str || '').replace(/\\s+/g, '').match(/^[+\\-]?[0-9]+\\.?[0-9]*$/) != null;\n}\nexports.isNumeric = isNumeric;\nfunction urlJoin(url1, url2) {\n    url1 = url1.trim();\n    url2 = url2.trim();\n    if (!url1.endsWith('/')) {\n        url1 += '/';\n    }\n    if (url2.startsWith('/')) {\n        url2 = url2.substring(1);\n    }\n    return url1 + url2;\n}\nexports.urlJoin = urlJoin;\n","// The module cache\nvar __webpack_module_cache__ = {};\n\n// The require function\nfunction __webpack_require__(moduleId) {\n\t// Check if module is in cache\n\tvar cachedModule = __webpack_module_cache__[moduleId];\n\tif (cachedModule !== undefined) {\n\t\treturn cachedModule.exports;\n\t}\n\t// Create a new module (and put it into the cache)\n\tvar module = __webpack_module_cache__[moduleId] = {\n\t\t// no module.id needed\n\t\t// no module.loaded needed\n\t\texports: {}\n\t};\n\n\t// Execute the module function\n\t__webpack_modules__[moduleId].call(module.exports, module, module.exports, __webpack_require__);\n\n\t// Return the exports of the module\n\treturn module.exports;\n}\n\n","\"use strict\";\n// Requires jquery\n// Other required assets are automatically inserted into page\nObject.defineProperty(exports, \"__esModule\", { value: true });\n/**\n * Mathquill groups are marked with the class pw-mq-group\n * All data-mq inserted within a group will only have one submit button,\n * so all answers will be sent to the check server at once\n */\n/**\n * DATA-MQ ELEMENT\n * It is used to generate questions client-side\n *\n * SYNTAX on elem being p or span or div\n * <elem data-mq=\"qtype\" data-mq-ans=\"a+b\" data-mq-symbols=\"a:=1;b:=2;\" data-mq-ini=\"?^?\"\n *        data-mq-rules='{\"key\":\"value\"}' data-mq-formulation=\"...\">\n *    Text that contains the formulation...\n * </elem>\n *\n * ATTRIBUTES\n * data-mq: can either define a type (simple, basic, cloze, panel, mchoice, mchoice*) or\n *         a base64 encoded definition of the whole activity. This last option is used to offuscate answers.\n *         In the last case, an activity generator can be used.\n * data-mq-ans: sympy representation of the answer. It can be a boolean to assert if it is true\n *              it can be an array [\"\",\"\",\"\"...] in cloze question types (it requires data-mq-ini)\n *\n * data-mq-symbols: Define symbols and default values, use := to assign values and ; to separate symbol definitions.\n *               In cloze questions an special variable called ua[i], i the index of the placeholder, is the answer\n *               that the user introduced at placeholder i. This can be used to construct a custom evaluator which\n *               returns a boolean value in data-mq-ans.\n *               Note that data-mq-ans can use any of the defined symbols. By default \"x\", \"y\", \"z\" are already defined\n *               as sympy symbols. No need to add them to data-mq-symbols.\n *               Define options for mchoice, mchoice* separated by comma.\n *\n * data-mq-ini: Initial latex, e.g. ?+? on every ? is a placeholder for cloze questions or\n *              an initial matrix of a given size M[3x3]\n *\n * data-mq-rules: is a map which contains the options that must be passed to the evaluator\n *    \"factor\": true  --> the answer must be factorized\n *    \"expanded\": true --> the answer must be expanded\n *    \"precision\": 1e-3 --> precission of numeric answers\n *    \"comma_as_decimal\": true --> The comma symbol in the answer will be interpreted as decimal part separator.\n *\n * data-mq-formulation (optional): Text that will be appended to the end of the formulation.\n */\n/**\n * DATA-PYGEN ELEMENT\n * The questions are generated server-side by a generator in pygen server. After the question is generated and rendered\n * the validation process i equivalent to the one in DATA-MQ\n *\n * <div data-pygen=\"path.to.generator.fn1[r=5,complexity=1];path.to.generator.fn2;path.to.generator.fn3;\"\n *      data-pygen-category=\"algebra.monomials\" data-pygen-order=\"weighted:0.2,0.7,0.1\"\n *      data-pygen-goal=\"5,6,4;10,5,*\" data-pygen-celebrate=\"none|confetti\"\n * ></div>\n *\n * data-pygen:\n *    The generator paths are the same as the ones defined in pygen.\n *    Several generators can be used by separating them with ;.\n *    Generators can be configured by setting parameters values within brackets [].\n *\n *  data-pygen-category:\n *    The category in iapace tree where the activity of the user will be stored\n *    Only if this parameter is set, a level indicador is shown in the activity\n *\n *  data-pygen-order=\"random\"  //default\n *    This options is discarded if only one generator is defined in data-pygen.\n *    By default one activity from the ones defined in data-pygen is taken at random.\n *    However other behaviours can be defined as ordering. Assume 3 generators:\n *\n *    weighted: 0.2,0.6,0.2  Random but setting the probability at which every generator is used. Values must add 1.\n *                           In this example, most likely to generate a question from 2nd generator.\n *\n *    sequence: 3,5,8  1st generator 3 questions, 2nd generator 5 questions, 3rd generator 8 questions\n *                     and repeat in cicles if more than 3+5+8 questions are created\n *    sequence: 3,5,* 1st generator 3 questions, 2nd generator 5 questions, 3rd generator remaining questions\n *    sequence: 3,*,* start with 3 questions of the first generator and after that take at random questions from generator 2 and 3.\n *    sequence: 3,*(0.7),*(0.3) The same as above but with weights\n *\n *    Important:\n *      1. * are only allowed at the end of the sequence\n *      2. sequences will not be mantained over page reloads. So every time the page realoads, the sequence starts again.\n *\n *  data-pygen-goal:\n *     The condition to set the activity as completed. Many conditions can be set\n *     and if any of them is verified the goal flag is set.\n *     Different conditions are separated by ;. A condition takes 3 parameters\n *     <min_number_questions_answered>,<min_average_grade>,<current_level>\n *     \"5,6,4;10,5,*\" means\n *     5 or more questions answered, grade of 6 or more, current level 4 of more\n *     OR\n *     10 or more questions answered, grade of 5 or more, regardless of the current level\n *\n * data-pygen-celebrate=\"none|confetti\"\n *     Say whether to celebrate or not when the goal is reached!\n */\nconst polyfills_1 = require(\"./polyfills\");\nconst globals_1 = require(\"./globals\");\nconst utils_1 = require(\"./utils\");\nconst mqfy_1 = require(\"./mqfy\");\nconst findPyGenerators_1 = require(\"./findPyGenerators\");\n(0, polyfills_1.applyPolyfills)();\nfunction reflow(widgets) {\n    (0, mqfy_1.findQuillGroups)(widgets); // Groups of mquills\n    (0, findPyGenerators_1.findPyGenerators)(); // An interface for dynamic generated questions\n}\n// Inject required dependencies on the page\n// On jquery ready\nlet isInitialized = false;\nfunction init(userConfig) {\n    // Prevent multiple initializations\n    if (isInitialized) {\n        reflow(userConfig.widgets);\n        return;\n    }\n    if (!userConfig.engines) {\n        console.error(\"The engines option in the init method is required.\");\n        return;\n    }\n    if (!Array.isArray(userConfig.engines)) {\n        userConfig.engines = [userConfig.engines];\n    }\n    globals_1.cfg.setUserConfig(userConfig);\n    (0, utils_1.createLinkSheet)((0, utils_1.urlJoin)(globals_1.cfg.MQWIDGETS_BASEURL, \"mqwidgets2.css\"));\n    const dependencies = [(0, utils_1.insertScript)(globals_1.cfg.MATHQUILL_URL)];\n    if (userConfig.engines.indexOf('nerdamer') >= 0) {\n        dependencies.push((0, utils_1.insertScript)(globals_1.cfg.NERDAMER_URL));\n    }\n    Promise.all(dependencies).then(() => {\n        reflow(userConfig === null || userConfig === void 0 ? void 0 : userConfig.widgets);\n        isInitialized = true;\n    }, () => {\n        console.error(\"Unable to load the required dependencies\");\n    });\n}\nwindow.MQWidgets = window.MQWidgets || {};\nwindow.MQWidgets.init = init;\nwindow.MQWidgets.reflow = reflow;\n"],"names":["Object","defineProperty","exports","value","I18n","globals_1","require","TRANSLATIONS","ca","es","en","BROWSER_LANG","window","navigator","lang","languages","language","browserLanguage","userLanguage","systemLanguage","toLowerCase","replace","split","getBrowserLang","key","cfg","LANG","langPack","console","error","out","i","createSubmitButtonForGroup","bindSubmitActionButton","checking_1","I18n_1","engineCAS_1","utils_1","LAST_AJAX","Date","getTime","gid","check_btn","extraActions","groupContainer","shared","qids","keys","map","e","parseInt","off","on","ev","preventDefault","now","k","len","length","qid","editor","getStatus","STATUS","MODIFIED","ual","latex","has_empty_answers","checkMsg","getDefinition","right_answer","getWrong_attemps","MAX_ATTEMPTS","isPigen","showAnswer","getQType","QTYPES","M","Ms","score10","isComodiUsed","ans","increment_wrong","postObj","anse","atob","isNumeric","pfual","parseFloat","difference","maxError","rules","precision","Math","abs","copyPropsFromTo","pageInfo","getHash","setHash","MD5","formulation","bookId","chapterId","hash","engineCAS","compare","then","datos","correct","msg","errors","$","extractMatrices","regexMatrices","tex","matrices","m","mat","forEach","alinia","linia","push","exec","has_empty_elements","matrix","rows","arow","cols","j","v","trim","lenmat","LevelIndicator","numLevels","this","container","levelIcons","elem","append","n","css","attr","removeAttr","visible","PwDialog","title","width","height","id","random","toString","substring","topBar","headerTitle","closeBtn","self","currentX","currentY","initialX","initialY","active","xOffset","yOffset","dragStart","type","touches","clientX","clientY","target","dragEnd","setTranslate","xPos","yPos","el","style","transform","drag","addEventListener","element","remove","removeEventListener","EditorDialog","editorPanel_1","qtype","P","editorPanel","EditorPanel","controlButtons","acceptBtn","cancelBtn","acceptFn","close","cancelFn","sanitizeLaTeX","focus","dispose","find","reflow","def","setDefinition","EditorBase","parent","status","UNMODIFIED","wrong_attemps","isAnswerShown","pigen","comodi","ansType","EditorCloze","dialog_1","ini","dlg_btn_el","quill_el_container","quill_el","check_el","mathInput","StaticMath","innerFields","__controller","textarea","html","removeClass","parts","lenv","msg2","addClass","revert","sharedDlg","dlg","answerHolder","prop","reflowLatex","show","EditorInput","editorDialog_1","quill_blocker","isBtn","S","MathField","handlers","edit","self2","RIGHT_ICON","WRONG_ICON","rescueBtn","evt","getAnswer","EditorMChoice","options","selectedIndex","floor","btn_group","btn_action","dropdown_menu","opt","dropdown_item","EditorMChoiceCheckbox","multipleAnswers","symbols","radios_group","radiosGroupId","allRadios","radioId","radio_wrapper","radio_item","radio_label","wsel","join","__importDefault","mod","__esModule","pwTabMenu_1","createToolbarButton_1","toolbar_config_1","editorBase_1","standalone","panel","palettes","PwTabMenu","spanMathInput","feedback_el","items","default","button_meta","name","btnInfo","tabName","default_toolbar_tabs","tab","addTab","aButton","createToolbarButton","addContentsToTab","setVisible","indexOf","setTab","firstSelected","num_visible","found","_a","setEnabled","btn_meta","btn","icon","panell","controls","lenk","vars","varObj","minmax","min","max","control","val","alab","okButtton","varsmap","$c","real_latex","write","moveto","keystroke","panell_shown","$panel","tabs","currentTab","tabsPanel","contentsPanel","contents","visibility","enabled","children","default_toolbar_buttons","movefor","lat","latrow","keyboard_keys","createQuillFromObject","editorCloze_1","editorInput_1","editorMChoice_1","editorMChoiceCheckbox_1","$el","obj","created","spanEl","C","initial_latex","Array","isArray","B","get_qid","setStatus","nerdamerCAS_1","sympyCAS_1","payload","engine","DEFAULT_ENGINE","sympyCAS","nerdamerCAS","parseLatex_1","is_set","expr","elements","firstElem","is_matrix","txt","text","startsWith","nerdamer","NerdamerCAS","JSON","parse","stringify","str","p","rules_checks","latex_code","fo_symb","un_sym","match","RegExp","cas","clone","Promise","resolve","reject","flush","clearVars","getCore","Symbol","scope","checkRules","user_sympy","parseLatex","filter","x","ex","setVar","symb","pos","symb_name","symb_raw","ans_sympy","decrypt","msgs","zip","pair","ans_obj","parsed_input","dims1","dims2","toDecimal","delta","subtract","isZero","each","is_zero_matrix","eq","simplify","isPolynomial","unt","coeffs","nexpect","expand","nterms_diff","err","ra","btoa","pmatrix_re","mcount","$0","$1","row","col","varName","convertFromLaTeX","SympyCAS","ajax","url","CAS_URL","data","dataType","success","GETANSWER_URL","findPyGenerators","actions_1","LevelIndicator_1","createQuill_1","goalChecker_1","mq_parsing_1","seqBasic_1","seqRandomWeighted_1","seqSequence_1","IB","eg","$eg","topPanel","centralPanel","bottomPanel","copyrightPanel","levelIndicator","category","HAS_IAPACE","currentLevel","iapace","inference","setLevel","goalChecker","goalRules","GoalChecker","accomplished","rawDataPygens","dataPygen","z","lenz","genpart","genname","genparams","paramspart","t","lent","aparm","param_parts","sequenciador","SeqBasic","order","SeqRandomWeighted","SeqSequence","checkBtn","comodiBtn","currentDatos","currentEditor","createDynamicMathquill","nextButton","showmeBtn","nextGenerator","next","PYGEN_URL","pregunta","json_raw","mq64","json_obj","frame","findCreate","sum","h","processMqIni","r","lenr","epart","addScore","save","reached","Confetti","play","CORRECT","lin","comodiUsed","ccSpan","sharedContext","parseUrlParams","params","nv","MQWidgets","Cfg","NERDAMER_URL","BACKEND_BASEURL","MQWIDGETS_BASEURL","_b","document","querySelector","userId","userFullname","dataUserId","getAttribute","userText","innerText","location","search","ele","cookie","eq_cookie_pos","moodleSession","substr","courseName","courseId","footer","hrefVal","href","isTeacher","site","assignNum","iedibAPI","lliurament","assignName","loadPageInfo","WRONG","urlJoin","uc","engines","remotes","mqwBaseurl","MQI","div","MathQuill","getInterface","config","d","reach","nrules","partial","crule","undecided","isNaN","grade","s","createQuillFromDataAttr","$2","nrows","ncols","mtex","aRow","endsWith","kk","lenkk","symbolsRaw","rulesRaw","palettesRaw","findQuillGroups","keysDef","widgets","hasClass","parseContext","b64","hasValue","parsedDef","findQuills","setTimeout","applyPolyfills","prototype","callback","thisArg","TypeError","array","l","call","arr","arg","Number","lpygens","definition","weights","vran","pop","total","old","w","rnd","positions","terminalGen","undefined","placeholders","remainingLpygens","slice","def2","isWeighted","e2","typeRan","pointer","indx","md5_cmn","_","f","safe_add","bit_rol","md5_ff","md5_gg","md5_hh","md5_ii","createLinkSheet","createStyleSheet","insertScript","MathJax","typesetPromise","Hub","Queue","iter","cb","l1","l2","dict","source","props","charCodeAt","charAt","String","fromCharCode","V","g","Y","X","tag","createElement","src","async","onload","onerror","onabort","head","appendChild","getElementById","innerHTML","getElementsByTagName","link","rel","url1","url2","__webpack_module_cache__","__webpack_require__","moduleId","cachedModule","module","__webpack_modules__","polyfills_1","mqfy_1","findPyGenerators_1","isInitialized","init","userConfig","setUserConfig","dependencies","MATHQUILL_URL","all"],"sourceRoot":""}